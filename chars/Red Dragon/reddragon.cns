;Vars:
; Head:
;	0  = temp var
;	1  = temp var
;	2  = superarmour state no.
;	3  = state timer
;	4  = facing
;	5  = ctrl

;	10 = explosion snd
;	11 = explosion snd pan
;	12 = prev life
;	13 = prev gethitvar(damage)
;	14 = stun resistance
;	15 = meteor hit snd
;	16 = meteor hit snd pan
;	17 = stun duration setting
;	18 = pre-breath rockfall setting
;	19 = lifebar setting
;	20 = AI breath usage setting
;	21 = skeleton numbers
;	22 = skeleton life
;	23 = skel hit snd
;	24 = skel hit snd pan
;	25 = scorching sphere count
;	26 = text dialogue setting

;	49 = AI skeleton timer
;	50 = AI next summon
;	51 = breath stage
;	52 = previous round lost (-1 won, lost earlier round, 0 won, no loss, 1, lost, ko, 2, lost, time)
;	53 = p2distance velocity offset
;	54 = p2distance tolerance
;	55 = ideal p2distance
;	56 = movement timer
;	57 = (Winane) GameTime var, for pause and custom state check
;	58 = AI action select
;	59 = (Winane) AI
; Hand:
;	3  = transition timer override

;FVars:
;	0  = temp var
;	1  = temp var
;	2  = logical x pos
;	3  = logical Y pos
;	4  = superarmor x pos
;	5  = superarmor y pos
;	6  = stun guage
;	7  = stun recovery

;	10 = AI Aggression


;Notes:
;	explods with id = 0 will be removed during flinch

; Constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

[Data]
life = 2100			;Amount of life to start with
attack = 105		;attack power (more is stronger)
defence = 100		;defensive power (more is stronger)
power = 1
fall.defence_up = 50	;Percentage to increase defense everytime player is knocked down
liedown.time = 60		;Time which player lies down for, before getting up
airjuggle = 15		;Number of points for juggling
sparkno = 2			;Default hit spark number for HitDefs
guard.sparkno = 40	;Default guard spark number
KO.echo = 0			;1 to enable echo on KO
volume = 200			;Volume offset (negative for softer)
IntPersistIndex = 52	;Variables with this index and above will not have their values
FloatPersistIndex = 40  ;reset to 0 between rounds or matches. There are 60 int variables,
  				;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
  				;If omitted, then it defaults to 60 and 40 for integer and float
  				;variables repectively, meaning that none are persistent, i.e. all
  				;are reset. If you want your variables to persist between matches,
  				;you need to override state 5900 from common1.cns.


[Size]
xscale=0.83333333333333333333333333333333
yscale=1.0714285714285714285714285714286
ground.back = 15		;Player width (back, ground)
ground.front = 15		;Player width (front, ground)
air.back = 15		;Player width (back, air)
air.front = 15		;Player width (front, air)
height = 30			;Height of player (for opponent to jump over)
attack.dist = 0		;Default attack distance
proj.attack.dist = 0	;Default attack distance for projectiles
proj.doscale = 1		;Set to 1 to scale projectiles too   
head.pos = 0, 0	;Approximate position of head
mid.pos = 0, 0		;Approximate position of midsection
shadowoffset = 0		;Number of pixels to vertically offset the shadow
draw.offset = 0,0		;Player drawing offset in pixels (x, y)

[Velocity]
walk.fwd  = 2.4		;Walk forward
walk.back = -2.2		;Walk backward
run.fwd  = 4.6, 0		;Run forward (x, y)
run.back = -4.5,-3.8	;Hop backward (x, y)
jump.neu = 0,-8.4		;Neutral jumping velocity (x, y)
jump.back = -2.55		;Jump back Speed (x, y)
jump.fwd = 2.5		;Jump forward Speed (x, y)
runjump.back = -2.55,-8.1;Running jump speeds (opt)
runjump.fwd = 4,-8.1	;.
airjump.neu = 0,-8.1	;.
airjump.back = -2.55	;Air jump speeds (opt)
airjump.fwd = 2.5		;.

[Movement]
airjump.num = 1		;Number of air jumps allowed (opt)
airjump.height = 35	;Minimum distance from ground before you can air jump (opt)
yaccel = .536		;Vertical acceleration
stand.friction = .85	;Friction coefficient when standing
crouch.friction = .82	;Friction coefficient when crouching

;---------------------------------------------------------------------------
; Stand
;
[Statedef 0]
type = A
movetype = I
physics = N
sprpriority = -2
poweradd = 1

[State 0, DestroySelf]
type = DestroySelf
trigger1 = ishelper

[State 0, ChangeAnim]
type = ChangeAnim
triggerall = anim
trigger1 = animtime >= 0
value = 0

[State 0, VarSet]
type = VarSet
trigger1 = !time
trigger1 = !var(1)
var(1) = 40

[State 0, Intro]
type = AssertSpecial
triggerall = time < var(1)
trigger1 = prevstateno = [180, 189]
trigger2 = prevstateno = [10180, 10189]
flag = RoundNotOver

[State 0, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = ifelse(var(1), 1.0/var(1), 1)

[State 0, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 -cos(var(0)*pi/60.0)*10

[State 0, PosSet]
type = PosSet
trigger1 = !numhelper(3)
trigger2 = !pos y
x = 0
y = fvar(3)

[State 0, Helper]
type = Helper
trigger1 = !numhelper(3)
name = "b"
id = 3
stateno = 3
pos = 0, 0
ownpal = 1

[State 0, VarSet]
type = VarSet
trigger1 = ctrl
trigger1 = roundstate < 3
trigger2 = var(5) != -1
trigger2 = prevstateno != [180, 199]
trigger2 = prevstateno != [10180, 10199]
trigger2 = prevstateno != 5900
trigger2 = prevstateno
trigger2 = var(3)*4 > var(1)
var(5) = 1
persistent = 0

[State 0, CtrlSet]
type = CtrlSet
trigger1 = ctrl
trigger1 = roundstate < 3
value = 0

[State 0, CtrlSet]
type = CtrlSet
trigger1 = roundstate > 2
trigger1 = var(3)*4 > var(1)
value = 1

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = roundstate > 2
trigger1 = var(3)*4 > var(1)
statetype = S

[State 0, VarSet]
type = VarSet
triggerall = var(5) = -1
trigger1 = !numhelper(1)
trigger1 = !numhelper(2)
trigger2 = numhelper(1)
trigger2 = numhelper(2)
trigger2 = helper(1), stateno = 1
trigger2 = helper(2), stateno = 1
trigger2 = helper(1), var(3) > 20
trigger2 = helper(2), var(3) > 20
trigger3 = numhelper(1)
trigger3 = !numhelper(2)
trigger3 = helper(1), stateno = 1
trigger3 = helper(1), var(3) > 20
trigger4 = !numhelper(1)
trigger4 = numhelper(2)
trigger4 = helper(2), stateno = 1
trigger4 = helper(2), var(3) > 20
var(5) = 1
persistent = 0

[State 0, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x < ((command = "holdfwd") - (command = "holdback"))*4*(var(5) != 0)
trigger2 = var(59) > 0
trigger2 = vel x < ((p2dist x > var(55)+var(54)+var(53)) - (p2dist x < var(55)-var(54)+var(53)))*4*(var(5) != 0)
x = 0.2

[State 0, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x > ((command = "holdfwd") - (command = "holdback"))*4*(var(5) != 0)
trigger2 = var(59) > 0
trigger2 = vel x > ((p2dist x > var(55)+var(54)+var(53)) - (p2dist x < var(55)-var(54)+var(53)))*4*(var(5) != 0)
x = -0.2

[State 0, VelSet]
type = VelSet
triggerall = abs(vel x) < 0.2
trigger1 = var(59) < 1
trigger1 = !((command = "holdfwd") - (command = "holdback"))
trigger2 = var(59) > 0
trigger2 = !((p2dist x > var(55)+var(54)+var(53)) - (p2dist x < var(55)-var(54)+var(53)))
x = 0

[State 0, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 0, VarAdd]
type = VarAdd
trigger1 = 1
var(0) = 1

[State 0, VarSet]
type = VarSet
triggerall = numhelper(3)
trigger1 = prevstateno != [9100, 9105]
trigger2 = var(3) != [1, var(1)]
fvar(2) = pos x*0.95 + helper(3), pos x*0.05

[State 0, VarSet]
type = VarSet
triggerall = numhelper(3)
trigger1 = prevstateno = [9100, 9105]
trigger1 = var(3) = [1, var(1)]
fvar(2) = (pos x*(1 - var(3)*fvar(0)) + helper(3), pos x*var(3)*fvar(0))*(1 - var(3)*fvar(0)) + (pos x*0.95 + helper(3), pos x*0.05)*var(3)*fvar(0)

[State 0, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > var(1)
y = fvar(3)

[State 0, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, var(1)]
x = fvar(2);pos x*0.95 + helper(3), pos x*0.05
y = pos y*(1 - var(3)*fvar(0)) + fvar(3)*var(3)*fvar(0)

[Statedef 1]
ctrl = 0
type = A
physics = N
movetype = I
sprpriority = -2

[State 1, VarSet]
type = VarSet
trigger1 = !time
var(3) = ifelse(prevstateno = 1001 && anim = 1001, 0, root, var(3))

[State 1, PosAdd]
type = PosAdd
trigger1 = anim = 201
trigger1 = animtime = 0
x = 24
y = 12

[State 1, ChangeAnim]
type = ChangeAnim
triggerall = anim != 1
trigger1 = animtime > 0
trigger1 = root, var(3) = 3
trigger2 = animtime = 0
trigger3 = anim%5 != 1
value = 1

[State 1, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 0
value = root, stateno + 1

[State 1, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = !numhelper(3)
trigger2 = var(3) > root, var(1)
trigger3 = !time
trigger3 = !prevstateno
x = root, pos x - 105.5*facing
y = -270.5 - cos((root, var(0) + 30)*pi/120.0)*10

[State 1, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = var(3) = [1, (root, var(1))]
x = pos x*(1 - var(3)*root, fvar(0)) + (root, pos x - 105.5*facing)*var(3)*root, fvar(0)
y = pos y*(1 - var(3)*root, fvar(0)) - (270.5 + cos((root, var(0) + 30)*pi/120.0)*10)*var(3)*root, fvar(0)

[State 1, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 1, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = (root, var(0) + 30)%240 = [10, 110]
trigger1 = !prevstateno || var(3) > root, var(1)
y = -cos(root, var(0)*pi/3.0)*0.5

[State 1, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[Statedef 3]
ctrl = 0
anim = 3
sprpriority = -5

[State 3, VarSet]
type = VarSet
trigger1 = !time
trigger1 = root, var(1)
fvar(0) = 0.2/root, var(1)

[State 3, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 0
value = root, stateno + 3

[State 3, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > root, var(1)
trigger2 = !time
trigger2 = !prevstateno
x = pos x*0.8 + root, pos x*0.2

[State 3, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, (root, var(1))]
x = pos x*(1 - root, var(3)*fvar(0)) + root, pos x*root, var(3)*fvar(0)

[State 3, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > root, var(1)*5
trigger2 = !time
trigger2 = !prevstateno
y = -180 - cos((root, var(0) + 10)*pi/60.0)*5

[State 3, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, (root, var(1))*5]
y = pos y*(1 - root, var(3)*root, fvar(0)*0.2) - (180 + cos((root, var(0) + 10)*pi/60.0)*5)*root, var(3)*root, fvar(0)*0.2

[State 3, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
[Statedef 170]
type = A
movetype = I
physics = N
anim = 180
sprpriority = -2
ctrl = 0

[State 170, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 170, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0

[State 170, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 170, VarSet]
type = VarSet
trigger1 = !time
var(0) = 0

[State 170, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -50

[State 170, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 170, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 170, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 170, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 170, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 50]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 170, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 50
y = fvar(3)

[State 170, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 50]
x = pos x*(1 - var(3)*0.02) + fvar(2)*var(3)*0.02
y = pos y*(1 - var(3)*0.02) + fvar(3)*var(3)*0.02

[Statedef 171]
ctrl = 0
sprpriority = -2

[State 171, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 171, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 171, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 170
value = root, stateno + 1

[State 171, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 40
x = root, pos x - 110*facing + root, vel x*root, facing
y = -240

[State 171, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.025) + (root, fvar(2) - 110*facing)*root, var(3)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.025) - 240*root, var(3)*0.025

[State 171, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 173]
ctrl = 0
anim = 3
sprpriority = -5

[State 173, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 170
value = root, stateno + 3

[State 173, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing + root, vel x*root, facing
y = -170

[State 173, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + root, fvar(2)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 170*root, var(3)*0.05

[State 173, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;---------------------------------------------------------------------------
; Win

[Statedef 180]
type = A
movetype = I
physics = N
anim = 800
sprpriority = -2
ctrl = 0

[State 180, ChangeState]
type = ChangeState
triggerall = !time
trigger1 = random%2
trigger2 = var(26)
trigger2 = matchover
value = 10180

[State 180, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 180, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 - ifelse(var(3) < 20, var(3)*1.2, 20.4)

[State 180, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0

[State 180, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 180, Intro]
type = AssertSpecial
trigger1 = 1
flag = RoundNotOver

[State 180, VelAdd]
type = VelAdd
trigger1 = vel x < 4
trigger1 = frontedgedist > backedgedist + 64
trigger2 = vel x < 0
trigger2 = frontedgedist >= backedgedist - 64
x = 0.2

[State 180, VelAdd]
type = VelAdd
triggerall = vel x > -4
trigger1 = frontedgedist < backedgedist - 64
trigger2 = vel x > 0
trigger2 = frontedgedist <= backedgedist + 64
x = -0.2

[State 180, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 180, 5]
type = ChangeState
trigger1 = var(3) >= 20
trigger1 = vel x = [-1, 1]
trigger1 = var(3) := 0 || 1
value = 185

[State 180, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 180, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 50]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 180, PosSet]
type =  PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 51
y = fvar(3)

[State 180, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [2, 51]
x = pos x*(1 - (var(3)-1)*0.02) + fvar(2)*(var(3)-1)*0.02
y = pos y*(1 - (var(3)-1)*0.02) + fvar(3)*(var(3)-1)*0.02

[Statedef 181]
ctrl = 0
sprpriority = -2

[State 181, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 181, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 181, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 180
value = root, stateno + 1

[State 181, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 50
x = root, pos x - 115*facing + root, vel x*root, facing
y = -300.5 - root, var(3)*0.4

[State 181, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 50]
x = pos x*(1 - root, var(3)*0.02) + (root, fvar(2) - 115*facing)*root, var(3)*0.02 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.02) - (300.5 + root, var(3)*0.4)*root, var(3)*0.02

[State 181, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 183]
ctrl = 0
anim = 3
sprpriority = -5

[State 183, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 180
value = root, stateno + 3

[State 183, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 50
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*0.3

[State 183, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 50]
x = pos x*(1 - root, var(3)*0.02) + root, fvar(2)*root, var(3)*0.02 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.02) - (180 + root, var(3)*0.3)*root, var(3)*0.02

[State 183, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 185]
type = A
movetype = I
physics = N
anim = 2000
sprpriority = -2
ctrl = 0

[State 185, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 185, VarSet]
type = VarSet
trigger1 = !time
var(3) = 0

[State 185, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = -1

[State 185, 5]
type = ChangeState
trigger1 = var(3) = 40
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 90
value = 0

[State 185, Intro]
type = AssertSpecial
trigger1 = time < 60
flag = RoundNotOver

[State 185, PlaySnd]
type = PlaySnd
trigger1 = !var(3)
value = 11, 0
channel = 1
persistent = 0

[State 185, VarSet]
type = VarSet
trigger1 = !time
var(0) = 0

[State 185, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -50

[State 185, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 185, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 185, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 185, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 185, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 185, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 20
y = fvar(3)

[State 185, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
x = pos x*(1 - var(3)*0.05) + fvar(2)*var(3)*0.05
y = pos y*(1 - var(3)*0.05) + fvar(3)*var(3)*0.05

[State 185, PosAdd]
type = PosAdd
trigger1 = var(3) > 10
y = -cos(var(3)*pi/1.5)*1.5

[Statedef 186]
ctrl = 0
sprpriority = -2

[State 186, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 186, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 186, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 185
value = root, stateno + 1

[State 186, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
x = root, pos x - 125*facing + root, vel x*root, facing
y = -280

[State 186, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + (root, fvar(2) - 125*facing)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 280*root, var(3)*0.05

[State 186, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 188]
ctrl = 0
anim = 3
sprpriority = -5

[State 188, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 185
value = root, stateno + 3

[State 188, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing + root, vel x*root, facing
y = -170

[State 188, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + root, fvar(2)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 170*root, var(3)*0.05

[State 188, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105


[Statedef 10180]
type = S
movetype = I
physics = N
sprpriority = -2
anim = 180

[State 10180, ChangeAnim]
type = ChangeAnim
trigger1 = !time
trigger1 = var(26)
trigger1 = matchover
value = 0

[State 10180, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 10180, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 10180, Intro]
type = AssertSpecial
trigger1 = time < 120
trigger2 = !anim
trigger2 = pos x != (-40, 40)
flag = RoundNotOver

[State 10180, VarSet]
type = VarSet
trigger1 = !time
trigger1 = !var(1)
var(1) = 40

[State 10180, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = ifelse(var(1), 1.0/var(1), 1)

[State 10180, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 -cos(var(0)*pi/60.0)*10

[State 10180, PosSet]
type = PosSet
trigger1 = !numhelper(3)
trigger2 = !pos y
x = 0
y = fvar(3)

[State 10180, Helper]
type = Helper
trigger1 = !numhelper(3)
name = "b"
id = 3
stateno = 3
pos = 0, 0
ownpal = 1

[State 10180, VelAdd]
type = VelAdd
trigger1 = vel x < 4
trigger1 = frontedgedist > backedgedist + 64
trigger2 = vel x < 0
trigger2 = frontedgedist >= backedgedist - 64
x = 0.2

[State 10180, VelAdd]
type = VelAdd
triggerall = vel x > -4
trigger1 = frontedgedist < backedgedist - 64
trigger2 = vel x > 0
trigger2 = frontedgedist <= backedgedist + 64
x = -0.2

[State 10180, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 10180, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 10180, VarAdd]
type = VarAdd
trigger1 = 1
var(0) = 1

[State 10180, VarSet]
type = VarSet
triggerall = numhelper(3)
trigger1 = prevstateno != [9100, 9105]
trigger2 = var(3) != [1, var(1)]
fvar(2) = pos x*0.95 + helper(3), pos x*0.05

[State 10180, VarSet]
type = VarSet
triggerall = numhelper(3)
trigger1 = prevstateno = [9100, 9105]
trigger1 = var(3) = [1, var(1)]
fvar(2) = (pos x*(1 - var(3)*fvar(0)) + helper(3), pos x*var(3)*fvar(0))*(1 - var(3)*fvar(0)) + (pos x*0.95 + helper(3), pos x*0.05)*var(3)*fvar(0)

[State 10180, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > var(1)
y = fvar(3)

[State 10180, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, var(1)]
x = fvar(2);pos x*0.95 + helper(3), pos x*0.05
y = pos y*(1 - var(3)*fvar(0)) + fvar(3)*var(3)*fvar(0)

[State 10180, Helper]
type = Helper
trigger1 = !anim
trigger1 = !numhelper(20000)
trigger1 = pos x = [-40, 40]
trigger1 = roundstate = [3, 4]
name = "t"
id = 20000
stateno = 20000
ownpal = 1
persistent = 0

[State 10180, PosAdd]
type = PosAdd
trigger1 = anim
trigger1 = time > 16
y = -cos((time - 16)*pi/6.0)

[State 10180, PlaySnd]
type = PlaySnd
trigger1 = anim
trigger1 = time = 16
value = 180, 0
channel = 1
persistent = 0

[Statedef 10181]
ctrl = 0
type = A
physics = N
movetype = I
sprpriority = -2

[State 10181, VarSet]
type = VarSet
trigger1 = !time
var(3) = ifelse(prevstateno = 1001 && anim = 1001, 0, root, var(3))

[State 10181, PosAdd]
type = PosAdd
trigger1 = anim = 201
trigger1 = animtime = 0
x = 24
y = 12

[State 10181, ChangeAnim]
type = ChangeAnim
triggerall = anim != 1
trigger1 = animtime > 0
trigger1 = root, var(3) = 3
trigger2 = animtime = 0
trigger3 = anim%5 != 1
value = 1

[State 10181, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 10180
value = root, stateno + 1

[State 10181, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = !numhelper(3)
trigger2 = var(3) > root, var(1)
trigger3 = !time
trigger3 = !prevstateno
x = root, pos x - 105.5*facing
y = -270.5 - cos((root, var(0) + 30)*pi/120.0)*10

[State 10181, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = var(3) = [1, (root, var(1))]
x = pos x*(1 - var(3)*root, fvar(0)) + (root, pos x - 105.5*facing)*var(3)*root, fvar(0)
y = pos y*(1 - var(3)*root, fvar(0)) - (270.5 + cos((root, var(0) + 30)*pi/120.0)*10)*var(3)*root, fvar(0)

[State 10181, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 10181, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[Statedef 10183]
ctrl = 0
anim = 3
sprpriority = -5

[State 10183, VarSet]
type = VarSet
trigger1 = !time
trigger1 = root, var(1)
fvar(0) = 0.2/root, var(1)

[State 10183, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 10180
value = root, stateno + 3

[State 10183, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > root, var(1)
trigger2 = !time
trigger2 = !prevstateno
x = pos x*0.8 + root, pos x*0.2

[State 10183, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, (root, var(1))]
x = pos x*(1 - root, var(3)*fvar(0)) + root, pos x*root, var(3)*fvar(0)

[State 10183, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > root, var(1)*5
trigger2 = !time
trigger2 = !prevstateno
y = -180 - cos((root, var(0) + 10)*pi/60.0)*5

[State 10183, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, (root, var(1))*5]
y = pos y*(1 - root, var(3)*root, fvar(0)*0.2) - (180 + cos((root, var(0) + 10)*pi/60.0)*5)*root, var(3)*root, fvar(0)*0.2

[State 10183, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;---------------------------------------------------------------------------
; Introduction

[Statedef 190]
type = A
movetype = I
physics = N
anim = 605
sprpriority = -2
velset = 0, 0
ctrl = 0
poweradd = 1

[State 190, ChangeState]
type = ChangeState
trigger1 = roundno = 1
trigger1 = prevstateno != 10190
value = 10190

[State 190, ChangeState]
type = ChangeState
trigger1 = var(52) != 1
trigger1 = prevstateno != 10190
value = 0

[State 190, Helper]
type = Helper
trigger1 = var(26)
trigger1 = !numhelper(20000)
trigger1 = prevstateno = 10190
trigger1 = var(3) > 50
trigger1 = roundstate < 2
name = "t"
id = 20000
stateno = 20000
ownpal = 1

[State 190, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 190, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 190, Helper]
type = Helper
trigger1 = !numhelper(1)
name = "l"
id = 1
stateno = 191
pos = 0, 0
facing = -1
ownpal = 1

[State 190, Helper]
type = Helper
trigger1 = !numhelper(2)
name = "r"
id = 2
stateno = 191
pos = 0, 0
ownpal = 1

[State 190, Helper]
type = Helper
trigger1 = !numhelper(3)
name = "b"
id = 3
stateno = 193
pos = 0, 0
ownpal = 1

[State 190, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 190, PosSet]
type = PosSet
trigger1 = !time
x = 0
y = -435

[State 190, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -40

[State 190, 5]
type = ChangeState
trigger1 = var(3) = 60
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 240
value = 0

[State 190, VarAdd]
type = VarAdd
trigger1 = roundstate
var(3) = 1

[State 190, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 190, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 400
y = fvar(3)

[State 190, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
x = pos x*(1 - var(3)*0.0025) + fvar(2)*var(3)*0.0025
y = pos y*(1 - var(3)*0.0025) + fvar(3)*var(3)*0.0025

[Statedef 191]
ctrl = 0
anim = 1
sprpriority = -2

[State 191, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 190
value = root, stateno + 1

[State 191, PosSet]
type = PosSet
trigger1 = !time
x = root, pos x - 105.5*facing + root, vel x*root, facing
y = -795.5

[State 191, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 400
x = root, pos x - 120*facing
y = -240

[State 191, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + (root, fvar(2) - 120*facing)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 240*root, var(3)*0.0025

[State 191, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 193]
ctrl = 0
anim = 3
sprpriority = -5

[State 193, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 190
value = root, stateno + 3

[State 193, PosSet]
type = PosSet
trigger1 = !time
x = root, pos x + root, vel x*root, facing
y = ifelse(prevstateno = 10193, -1265, -885)

[State 193, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
x = root, pos x + root, vel x*root, facing
y = -170

[State 193, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + root, fvar(2)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 170*root, var(3)*0.0025

[State 193, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 10190]
type = A
movetype = I
physics = N
anim = 190
sprpriority = -5
velset = 0, 0
ctrl = 0
poweradd = 1

[State 10190, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 10190, ChangeState]
type = ChangeState
trigger1 = var(3) = 210
trigger1 = var(3) := 0 || 1
value = 190

[State 10190, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro
flag2 = NoShadow

[State 10190, PosSet]
type = PosSet
trigger1 = !time
trigger1 = var(3) := 0 || 1
x = 0
y = 400

[State 10190, Helper]
type = Helper
trigger1 = !numhelper(1)
name = "l"
id = 1
stateno = 10191
pos = 0, 0
facing = -1
ownpal = 1

[State 10190, Helper]
type = Helper
trigger1 = !numhelper(2)
name = "r"
id = 2
stateno = 10191
pos = 0, 0
ownpal = 1

[State 10190, Helper]
type = Helper
trigger1 = !numhelper(3)
name = "b"
id = 3
stateno = 10193
pos = 0, 0
ownpal = 1

[State 10190, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 10190, VarAdd]
type = VarAdd
trigger1 = roundstate
var(3) = 1

[State 10190, VelSet]
type = VelSet
trigger1 = var(3) = 1
y = -8

[State 10190, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 20
value = 190, 1

[Statedef 10191]
ctrl = 0
anim = 9999
sprpriority = -2

[State 10191, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 10190
value = root, stateno + 1

[Statedef 10193]
ctrl = 0
anim = 9999
sprpriority = -5

[State 10193, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 10190
value = root, stateno + 3

[Statedef 10195]
ctrl = 0
anim = 10195
sprpriority = 5

[State 10195, Trans]
type = Trans
trigger1 = 1
trans = addalpha
alpha = 256 - time*2, time*2

[State 10195, DestroySelf]
type = DestroySelf
trigger1 = time = 128

;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing Light Punch
; CNS difficulty: easy
[Statedef 200]
type = A
movetype = I
physics = N
anim = 0
sprpriority = -2
ctrl = 0

[State 200, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 200, VarSet]
type = VarSet
trigger1 = var(3) = 0
trigger1 = numhelper(3)
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 200, VarSet]
type = VarSet
trigger1 = var(3) = 0
trigger1 = !numhelper(3)
fvar(2) = pos x

[State 200, VarSet]
type = VarSet
trigger1 = var(3) = 0
fvar(2) = fvar(2) - helper(6000), pos x - 50*facing*var(0)

[State 200, 5]
type = ChangeState
trigger1 = var(3) = 25
trigger1 = var(3) := 0 || 1
value = 205

[State 200, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 200, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 200, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 200, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 200, PosSet]
type = PosSet
trigger1 = var(3) = [1, 40]
x = pos x*(1 - var(3)*0.015) + (helper(6000), pos x + fvar(2))*var(3)*0.015
y = pos y*(1 - var(3)*0.015) - 70*var(3)*0.015

[Statedef 201]
ctrl = 0
sprpriority = -2

[State 201, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 201, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = ifelse(facing = root, facing*root, var(0), 1, 202)

[State 201, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 200
value = root, stateno + 1

[State 201, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
trigger1 = facing = root, facing*root, var(0)
x = pos x*(1 - root, var(3)*0.025) + (helper(6000), pos x + root, fvar(2) - 125*facing)*root, var(3)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.025) - 228*root, var(3)*0.025

[State 201, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
trigger1 = facing != root, facing*root, var(0)
x = pos x*(1 - root, var(3)*0.015) + (helper(6000), pos x + root, fvar(2) - 105.5*facing)*root, var(3)*0.015 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.015) - 280*root, var(3)*0.015

[Statedef 203]
ctrl = 0
anim = 3
sprpriority = -5

[State 203, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 200
value = root, stateno + 3

[State 203, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.015) + (helper(6000), pos x + root, fvar(2) + 30*root, facing*root, var(0))*root, var(3)*0.015 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.015) - 170*root, var(3)*0.015

[Statedef 205]
type = A
movetype = I
physics = N
anim = 0
sprpriority = -2
ctrl = 0
velset = 0, 0

[State 205, VarSet]
type = VarSet
trigger1 = var(3) = 0
trigger1 = numhelper(3)
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 205, VarSet]
type = VarSet
trigger1 = var(3) = 0
trigger1 = !numhelper(3)
fvar(2) = pos x

[State 205, VarSet]
type = VarSet
trigger1 = var(3) = 0
fvar(2) = fvar(2) - helper(6000), pos x + 200*facing*var(0)

[State 205, 5]
type = ChangeState
trigger1 = var(3) = 35
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 60
trigger1 = var(1) := 40
value = 0

[State 205, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 205, PosSet]
type = PosSet
trigger1 = var(3) = [1, 100]
x = pos x*(1 - var(3)*0.01) + (helper(6000), pos x + fvar(2))*var(3)*0.01
y = pos y*(1 - var(3)*0.01) - 70*var(3)*0.01

[Statedef 206]
ctrl = 0
anim = ifelse(facing = root, facing*root, var(0), 201, 202)
sprpriority = -2
movetype = A

[State 206, PosAdd]
type = PosAdd
trigger1 = !time
trigger1 = anim = 201
x = -8
y = -12

[State 206, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 201
value = 201

[State 206, ChangeState]
type = ChangeState
triggerall = root, stateno != [9000, 9001]
triggerall = root, stateno != 5030
trigger1 = root, stateno != 205
value = root, stateno + 1

[State 206, PosSet]
type = PosSet
triggerall = root, stateno != [9000, 9001]
trigger1 = root, var(3) = [1, 100]
trigger1 = facing = root, facing*root, var(0)
x = pos x*(1 - root, var(3)*0.01) + (helper(6000), pos x + root, fvar(2) - 95*facing)*root, var(3)*0.01
y = pos y*(1 - root, var(3)*0.01) - 240*root, var(3)*0.01

[State 206, PosSet]
type = PosSet
triggerall = root, stateno != [9000, 9001]
trigger1 = root, var(3) = [1, 100]
trigger1 = facing != root, facing*root, var(0)
x = pos x*(1 - root, var(3)*0.01) + (helper(6000), pos x + root, fvar(2) - 105.5*facing)*root, var(3)*0.01
y = pos y*(1 - root, var(3)*0.01) - 280*root, var(3)*0.01

[State 206, Explod]
type = Explod
triggerall = facing = root, facing*root, var(0)
triggerall = root, var(3) < 25
trigger1 = root, var(3)%3 = 2
anim = F120
ownpal = 1
sprpriority = -2
pos = 5, -floor(pos y)
facing = -1

[State 206, HitDef]
type = HitDef
trigger1 = root, var(3) = [3, 20)
trigger1 = facing = root, facing*root, var(0)
trigger1 = !movehit || numtarget(206)
id = 206
attr = S, SA
animtype  = Heavy
damage    = 120
priority  = 0
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = 3
sparkxy = -20,floor(const(size.yscale)*175)
hitsound   = S200,1
p2facing = 1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -12.5 + root, var(3)/3, -1
ground.cornerpush.veloff = 0
air.type = Low
air.velocity = -12.5 + root, var(3)/3, 1
fall = 1
fall.animtype = Heavy
fall.recover = 0
sprpriority = -2

[State 206, HitDef]
type = HitDef
trigger1 = root, var(3) = 20
trigger1 = facing = root, facing*root, var(0)
damage    = 0
numhits = 0
hitflag = 
guardflag = 

[State 206, PlaySnd]
type = PlaySnd
trigger1 = !time
trigger1 = facing = root, facing*root, var(0)
value = 200, 0

[Statedef 208]
ctrl = 0
anim = 3
sprpriority = -5

[State 208, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 205
value = root, stateno + 3

[State 208, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 100]
x = pos x*(1 - root, var(3)*0.01) + (helper(6000), pos x + root, fvar(2) - 30*root, facing*root, var(0))*root, var(3)*0.01
y = pos y*(1 - root, var(3)*0.01) - 170*root, var(3)*0.01

;---------------------------------------------------------------------------
; Deadfall
;
[Statedef 600]
type = A
movetype = I
physics = N
anim = 600
sprpriority = -2
ctrl = 0

[State 600, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 600, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 0
value = 600, 0
persistent = 0

[State 600, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 90
value = 600, 1
persistent = 0

[State 600, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -120 - var(3)*10

[State 600, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 600, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 600, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.4
x = 0

[State 600, 5]
type = ChangeState
trigger1 = var(3) = 120
trigger1 = var(3) := 0 || 1
value = 605

[State 600, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 600, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 40]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 600, VarSet]
type = VarSet
trigger1 = !numhelper(3)
trigger1 = var(3) = [1, 40]
fvar(2) = pos x

[State 600, PosSet]
type = PosSet
trigger1 = var(3) > 40
x = fvar(2)
y = fvar(3)

[State 600, PosSet]
type = PosSet
trigger1 = var(3) = [1, 40]
x = pos x*(1 - var(3)*0.025) + fvar(2)*var(3)*0.025
y = pos y*(1 - var(3)*0.025) + fvar(3)*var(3)*0.025

[State 600, Helper]
type = Helper
triggerall = var(3) = [60, 84]
trigger1 = var(3)%3 = 0
trigger2 = var(3)%5 = 0
name = "m"
id = 2270
stateno = 2270
facing = -1
pos = ifelse(random%2, 1, -1)*(random%200), random%60
ownpal = 1

[Statedef 601]
ctrl = 0
sprpriority = -2

[State 601, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 601, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 601, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 600
value = root, stateno + 1

[State 601, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 40
x = root, pos x - 105.5*facing + root, vel x*root, facing
y = -270.5 - root, var(3)*10

[State 601, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.025) + (root, fvar(2) - 105.5*facing)*root, var(3)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.025) - (270.5 + root, var(3)*10)*root, var(3)*0.025

[State 601, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 603]
ctrl = 0
anim = 3
sprpriority = -5

[State 603, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 600
value = root, stateno + 3

[State 603, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*10

[State 603, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
x = pos x*(1 - root, var(3)*0.005) + root, fvar(2)*root, var(3)*0.005 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.005) - (180 + root, var(3)*10)*root, var(3)*0.005

[State 603, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 605]
type = A
movetype = I
physics = N
anim = 605
sprpriority = -2
velset = 0, 0
ctrl = 0

[State 605, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 605, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -40

[State 605, 5]
type = ChangeState
trigger1 = var(3) = 60
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 60
value = 0

[State 605, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 605, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 605, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 400
y = fvar(3)

[State 605, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
x = pos x*(1 - var(3)*0.0025) + fvar(2)*var(3)*0.0025
y = pos y*(1 - var(3)*0.0025) + fvar(3)*var(3)*0.0025

[Statedef 606]
ctrl = 0
anim = 1
sprpriority = -2

[State 606, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 605
value = root, stateno + 1

[State 606, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 400
x = root, pos x - 120*facing
y = -240

[State 606, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + (root, fvar(2) - 120*facing)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 240*root, var(3)*0.0025

[State 606, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 608]
ctrl = 0
anim = 3
sprpriority = -5

[State 608, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 605
value = root, stateno + 3

[State 608, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 400
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -170

[State 608, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + root, fvar(2)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 170*root, var(3)*0.0025

[State 608, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;---------------------------------------------------------------------------
; Burning Rock
;
[Statedef 610]
ctrl = 0
type = A
physics = N
movetype = A
anim = 610
sprpriority = 3

[State 610, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = ifelse(random%2, 1, -1)*random*0.02 - 8

[State 610, VarSet]
type = VarSet
trigger1 = !time
var(0) = ifelse(fvar(0) < -8, ifelse(fvar(0) < -18, -2, -1), ifelse(fvar(0) < 2, 2, 3))

[State 610, SprPriority]
type = SprPriority
trigger1 = !time
value = var(0)

[State 610, VelSet]
type = VelSet
trigger1 = !time
y = 8

[State 610, Burn]
type = TargetState
trigger1 = movehit = 1
trigger1 = numtarget(1050)
value = 5400

[State 610, Flame Helpers]
type = Helper
triggerall = movehit = 1
trigger1 = numtarget(1050) = 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = target(1050), facing
pos = floor(target(1050), pos x), floor(target(1050), pos y)
ownpal = 1
ignorehitpause = 1

[State 610, Flame Helpers]
type = Helper
triggerall = movehit = 1
trigger1 = numtarget(1050) > 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = enemy(0), facing
pos = floor(enemy(0), pos x), floor(enemy(0), pos y)
ownpal = 1
ignorehitpause = 1

[State 610, Flame Helpers]
type = Helper
triggerall = movehit = 1
trigger1 = numtarget(1050) > 1
trigger1 = numenemy > 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = enemy(1), facing
pos = floor(enemy(1), pos x), floor(enemy(1), pos y)
ownpal = 1
ignorehitpause = 1

[State 610, Burn]
type = TargetDrop
trigger1 = movehit = 1

[State 610, ChangeState]
type = ChangeState
trigger1 = pos y + vel y >= fvar(0)
value = 615

[State 610, HitDef]
type = HitDef
trigger1 = !movehit
trigger1 = !movereversed
id = 1050
attr = A, SP
animtype  = Heavy
damage    = 180
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
ground.cornerpush.veloff = 0
air.type = Low
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 2
sprpriority = var(0)

[State 610, ParentVarSet]
type = ParentVarSet
trigger1 = movehit = 1
var(15) = 1

[State 610, ParentVarSet]
type = ParentVarSet
trigger1 = movehit = 1
var(16) = floor(pos x)

[Statedef 615]
ctrl = 0
type = A
physics = N
movetype = A
anim = 1050
velset = 0, 0
sprpriority = 3

[State 615, PosSet]
type = PosSet
trigger1 = !time
y = fvar(0) + 8

[State 615, StopSnd]
type = StopSnd
trigger1 = !time
channel = 1

[State 615, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(10) = 1

[State 615, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(11) = floor(pos x)

[State 615, Projectile]
type = Projectile
trigger1 = !time
projid = 1050
projanim = 1051
projremovetime = 8
projmisstime = 8
projhits = 2
projpriority = 9999
id = 1050
attr = C, SP
animtype  = Heavy
damage    = 180
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Trip
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 3
p2stateno = 5400

[State 615, EnvShake]
type = EnvShake
trigger1 = !time
time = 10
freq = 50
ampl = 5
phase = 270
persistent = 0

[State 615, DestroySelf]
type = DestroySelf
trigger1 = animtime = 0

;---------------------------------------------------------------------------
; Bite
;
[Statedef 800]
type = A
movetype = I
physics = N
anim = 800
sprpriority = -2
ctrl = 0

[State 800, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 800, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 - var(3)*1.2

[State 800, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x < ((command = "holdfwd") - (command = "holdback"))*4
trigger2 = var(59) > 0
trigger2 = vel x < ((p2dist x > var(53)) - (p2dist x < var(53)))*4
x = 0.2

[State 800, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x > ((command = "holdfwd") - (command = "holdback"))*4
trigger2 = var(59) > 0
trigger2 = vel x > ((p2dist x > var(53)) - (p2dist x < var(53)))*4
x = -0.2

[State 800, VelSet]
type = VelSet
triggerall = abs(vel x) < 0.2
trigger1 = var(59) < 1
trigger1 = !((command = "holdfwd") - (command = "holdback"))
trigger2 = var(59) > 0
trigger2 = !((p2dist x > var(53)) - (p2dist x < var(53)))
x = 0

[State 800, 5]
type = ChangeState
trigger1 = var(3) = 60
trigger1 = var(3) := 0 || 1
value = 805

[State 800, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 800, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 200]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 800, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 200
y = fvar(3)

[State 800, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 200]
x = pos x*(1 - var(3)*0.005) + fvar(2)*var(3)*0.005
y = pos y*(1 - var(3)*0.005) + fvar(3)*var(3)*0.005

[Statedef 801]
ctrl = 0
sprpriority = -2

[State 801, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 801, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 801

[State 801, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 800
value = root, stateno + 1

[State 801, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
x = root, pos x - 115*facing + root, vel x*root, facing
y = -300.5 - root, var(3)*0.4

[State 801, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
x = pos x*(1 - root, var(3)*0.005) + (root, fvar(2) - 115*facing)*root, var(3)*0.005 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.005) - (300.5 + root, var(3)*0.4)*root, var(3)*0.005

[State 801, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 803]
ctrl = 0
anim = 3
sprpriority = -5

[State 803, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 800
value = root, stateno + 3

[State 803, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*0.3

[State 803, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
x = pos x*(1 - root, var(3)*0.005) + root, fvar(2)*root, var(3)*0.005 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.005) - (180 + root, var(3)*0.3)*root, var(3)*0.005

[State 803, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 805]
type = A
movetype = A
physics = N
sprpriority = 2
ctrl = 0

[State 805, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 805, VarSet]
type = VarSet
trigger1 = !time
var(0) = 0

[State 805, ChangeAnim]
type = ChangeAnim
trigger1 = !var(3)
value = 805

[State 805, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 0
value = 800, 0
persistent = 0

[State 805, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -30 - var(3)*0.1

[State 805, 5]
type = ChangeState
trigger1 = var(3) = 15
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 40
value = 0

[State 805, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 805, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 805, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 805, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 805, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 805, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 20
y = fvar(3)

[State 805, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
x = pos x*(1 - var(3)*0.05) + fvar(2)*var(3)*0.05
y = pos y*(1 - var(3)*0.05) + fvar(3)*var(3)*0.05

[State 805, VarSet]
type = VarSet
trigger1 = var(3) < 12
var(1) = 0

[State 805, VarSet]
type = VarSet
trigger1 = var(3) = [3, 10]
trigger1 = p2bodydist x < -8
trigger1 = p2dist y > 20
var(1) = 1

[State 805, Turn]
type = Turn
trigger1 = var(3) = [3, 10]

[State 805, VarSet]
type = VarSet
trigger1 = var(3) = [3, 10]
trigger1 = p2bodydist x < -8
trigger1 = p2dist y > 10
var(1) = 1

[State 805, Turn]
type = Turn
trigger1 = var(3) = [3, 10]

[State 805, Projectile]
type = Projectile
trigger1 = var(1)
projid = 808
projanim = 808
projremovetime = 1
projmisstime = 1
projpriority = 9999
offset = 0, var(3)*10 - 50
id = 808
attr = A, ST
damage    = 0
priority = 1, Miss
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.velocity = 0
air.type = Low
air.velocity = 0,0
fall = 1
fall.recover = 0
p1stateno = 810
p2stateno = 820

[Statedef 806]
ctrl = 0
sprpriority = -2

[State 806, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = 806

[State 806, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 805
value = root, stateno + 1

[State 806, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
x = root, pos x - 125*facing + root, vel x*root, facing
y = -(280 + root, var(3)*0.2)

[State 806, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + (root, fvar(2) - 125*facing)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - (280 + root, var(3)*0.2)*root, var(3)*0.05

[State 806, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 808]
ctrl = 0
anim = 3
sprpriority = -5

[State 808, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 805
value = root, stateno + 3

[State 808, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing + root, vel x*root, facing
y = -170

[State 808, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + root, fvar(2)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 170*root, var(3)*0.05

[State 808, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 810]
type = A
movetype = A
physics = N
sprpriority = 2
ctrl = 0

[State 810, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 810, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -30 - var(3)*0.1

[State 810, 5]
type = ChangeAnim
trigger1 = !var(0)
value = 810

[State 810, 5]
type = ChangeAnim
trigger1 = var(0) = 120 || !numtarget(808)
value = 815

[State 810, PlaySnd]
type = PlaySnd
trigger1 = var(0)%12 = 0
value = 800, 1
channel = 3
volume = 64

[State 810, 5]
type = ChangeState
trigger1 = var(0) = 120 || !numtarget(808)
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 60
value = 0

[State 810, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 810, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 810, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 810, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 810, VarAdd]
type = VarAdd
trigger1 = 1
var(0) = 1

[State 810, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 810, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 20
y = fvar(3)

[State 810, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
x = pos x*(1 - var(3)*0.05) + fvar(2)*var(3)*0.05
y = pos y*(1 - var(3)*0.05) + fvar(3)*var(3)*0.05

[State 810, TargetBind]
type = TargetBind
trigger1 = numtarget(808)
id = 808
pos = 0, -floor(target(808), const(size.head.pos.y)*0.3)

[State 810, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = var(0) = 1
trigger1 = numtarget(808)
id = 808
value = (-90*const(data.attack))/100

[State 810, TargetLifeAdd]
type = TargetLifeAdd
trigger1 = var(0) > 1
trigger1 = var(0)%8 = 1
trigger1 = numtarget(808)
id = 808
value = (-5*const(data.attack))/100

[Statedef 811]
ctrl = 0
sprpriority = -2

[State 811, VarSet]
type = VarSet
trigger1 = !time
var(3) = root, var(3)

[State 811, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = 806

[State 811, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 810
value = root, stateno + 1

[State 811, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
x = root, pos x - 125*facing + root, vel x*root, facing
y = -(280 + root, var(3)*0.2)

[State 811, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + (root, fvar(2) - 125*facing)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - (280 + root, var(3)*0.2)*root, var(3)*0.05

[State 811, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 811, PosAdd]
type = PosAdd
trigger1 = root, stateno != 9000
y = -cos((root, var(3)-var(3))*pi/3.0)*0.5

[Statedef 813]
ctrl = 0
anim = 3
sprpriority = -5

[State 813, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 810
value = root, stateno + 3

[State 813, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing + root, vel x*root, facing
y = -170

[State 813, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + root, fvar(2)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 170*root, var(3)*0.05

[State 813, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 820]
ctrl = 0
sprpriority = -3
type = A
movetype = H
physics = N

[State 820, SprPriority]
type = SprPriority
trigger1 = !gethitvar(isbound)
value = 0

[State 820, SelfState]
type = SelfState
trigger1 = !gethitvar(isbound)
value = 5050

[State 820, ChangeAnim2]
type = ChangeAnim2
trigger1 = !time
value = 820

;---------------------------------------------------------------------------
; Fireball
;
[Statedef 1000]
type = A
movetype = I
physics = N
anim = 0
sprpriority = -2

[State 1000, VarSet]
type = VarSet
trigger1 = !time
trigger1 = var(2)
trigger1 = var(2) != 1000
var(3) = 0

[State 1000, VarSet]
type = VarSet
trigger1 = !time
trigger1 = var(2) != 1000
fvar(1) = 0

[State 1000, VarSet]
type = VarSet
trigger1 = !time
trigger1 = var(1) > 8
trigger1 = var(1) := var(1) - 10 || 1
fvar(1) = 1

[State 1000, VarSet]
type = VarSet
trigger1 = !time
var(5) = -1

[State 1000, ChangeState]
type = ChangeState
trigger1 = !fvar(1)
trigger1 = fvar(0) = 65
trigger1 = var(5) := -1 || 1
trigger1 = var(1) := 40
value = 0

[State 1000, ChangeState]
type = ChangeState
trigger1 = fvar(1)
trigger1 = fvar(0) = 85
trigger1 = var(5) := -1 || 1
trigger1 = var(1) := 40
value = 0

[State 1000, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 -cos(var(0)*pi/60.0)*10

[State 1000, PosSet]
type = PosSet
trigger1 = !numhelper(3)
trigger2 = !pos y
x = 0
y = fvar(3)

[State 1000, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x < ((command = "holdfwd") - (command = "holdback"))*4*(var(1) != 0)
trigger2 = var(59) > 0
trigger2 = vel x < ((p2dist x > var(55)+var(54)+var(53)) - (p2dist x < var(55)-var(54)+var(53)))*4*(var(1) != 0)
x = 0.2

[State 1000, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x > ((command = "holdfwd") - (command = "holdback"))*4*(var(1) != 0)
trigger2 = var(59) > 0
trigger2 = vel x > ((p2dist x > var(55)+var(54)+var(53)) - (p2dist x < var(55)-var(54)+var(53)))*4*(var(1) != 0)
x = -0.2

[State 1000, VelSet]
type = VelSet
triggerall = abs(vel x) < 0.2
trigger1 = var(59) < 1
trigger1 = !((command = "holdfwd") - (command = "holdback")) || (var(1) = 0)
trigger2 = var(59) > 0
trigger2 = !((p2dist x > var(55)+var(54)+var(53)) - (p2dist x < var(55)-var(54)+var(53)))
x = 0

[State 1000, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 1000, VarAdd]
type = VarAdd
trigger1 = 1
var(0) = 1

[State 1000, VarAdd]
type = VarAdd
trigger1 = 1
fvar(0) = 1

[State 1000, VarSet]
type = VarSet
triggerall = numhelper(3)
trigger1 = prevstateno != [9100, 9105]
trigger2 = var(3) != [1, 40]
fvar(2) = pos x*0.95 + helper(3), pos x*0.05

[State 1000, VarSet]
type = VarSet
triggerall = numhelper(3)
trigger1 = prevstateno = [9100, 9105]
trigger1 = var(3) = [1, 40]
fvar(2) = (pos x*(1 - var(3)*0.025) + helper(3), pos x*var(3)*0.025)*(1 - var(3)*0.025) + (pos x*0.95 + helper(3), pos x*0.05)*var(3)*0.025

[State 1000, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 40
y = fvar(3)

[State 1000, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 40]
x = fvar(2)
y = pos y*(1 - var(3)*0.025) + fvar(3)*var(3)*0.025

[State 1000, Helper]
type = Helper
trigger1 = fvar(0) = 25
trigger1 = !fvar(1)
trigger1 = numhelper(1)
trigger1 = helper(1), anim = 1001
id = 1020
stateno = 1020
pos = 115, floor(helper(1), pos y - pos y + 156*const(size.yscale))
facing = -1
ownpal = 1
persistent = 0

[State 1000, Helper]
type = Helper
trigger1 = fvar(0) = 25
trigger1 = !fvar(1)
trigger1 = numhelper(2)
trigger1 = helper(2), anim = 1001
id = 1020
stateno = 1020
pos = -115, floor(helper(2), pos y - pos y + 156*const(size.yscale))
facing = 1
ownpal = 1
persistent = 0

[State 1000, Helper]
type = Helper
trigger1 = fvar(0) = 25
trigger1 = fvar(1)
trigger1 = numhelper(1)
trigger1 = helper(1), anim = 1001
id = 1250
stateno = 1250
pos = 115, floor(helper(1), pos y - pos y + 156*const(size.yscale))
facing = -1
ownpal = 1
persistent = 0

[State 1000, Helper]
type = Helper
trigger1 = fvar(0) = 25
trigger1 = fvar(1)
trigger1 = numhelper(2)
trigger1 = helper(2), anim = 1001
id = 1250
stateno = 1250
pos = -115, floor(helper(2), pos y - pos y + 156*const(size.yscale))
facing = 1
ownpal = 1
persistent = 0

[State 1000, PlaySnd]
type = PlaySnd
trigger1 = fvar(0) = 45
trigger1 = !var(1)
trigger1 = !fvar(1)
value = 1020, 0
persistent = 0

[State 1000, PlaySnd]
type = PlaySnd
trigger1 = fvar(0) = 45
trigger1 = !var(1)
trigger1 = !fvar(1)
value = 1070, 0
persistent = 0

[State 1000, PlaySnd]
type = PlaySnd
trigger1 = fvar(0) = 65
trigger1 = !var(1)
trigger1 = fvar(1)
value = 1200, 1
persistent = 0

[Statedef 1001]
ctrl = 0
sprpriority = -2

[State 1001, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 1001, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = ifelse(root, var(1) != -facing*root, facing, 1001, 1)

[State 1001, ChangeAnim]
type = ChangeAnim
trigger1 = animelemno(0) = 3
value = 1001
elem = 3

[State 1001, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1000
value = root, stateno + 1

[State 1001, PosSet]
type = PosSet
triggerall = root, stateno != 9000
triggerall = root, var(1) != -facing*root, facing
trigger1 = !numhelper(3)
trigger2 = root, fvar(0) > 40
trigger3 = !time
trigger3 = !prevstateno
x = root, fvar(2) - 115*facing + root, vel x*root, facing
y = -315

[State 1001, PosSet]
type = PosSet
triggerall = root, stateno != 9000
triggerall = root, var(1) = -facing*root, facing
trigger1 = !numhelper(3)
trigger2 = root, var(3) > 40
trigger3 = !time
trigger3 = !prevstateno
x = root, pos x - 105.5*facing
y = -270.5 - cos((root, var(0) + 30)*pi/120.0)*10

[State 1001, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, fvar(0) = [1, 40]
trigger1 = root, var(1) != -facing*root, facing
x = pos x*(1 - root, fvar(0)*0.025) + (root, fvar(2) - 115*facing)*root, fvar(0)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, fvar(0)*0.025) - 315*root, fvar(0)*0.025

[State 1001, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
trigger1 = root, var(1) = -facing*root, facing
x = pos x*(1 - root, var(3)*0.025) + (root, pos x - 105.5*facing)*root, var(3)*0.025
y = pos y*(1 - root, var(3)*0.025) - (270.5 + cos((root, var(0) + 30)*pi/120.0)*10)*root, var(3)*0.025

[State 1001, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 1001, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(1) = -facing*root, facing
trigger1 = (root, var(0) + 30)%240 = [10, 110]
trigger1 = prevstateno < 200 || root, var(3) > 40
y = -cos(root, var(0)*pi/3.0)*0.5

[State 1001, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
triggerall = root, fvar(0) = [45, 75]
triggerall = !root, fvar(1)
trigger1 = root, var(1) != -facing*root, facing
x = -sin((root, fvar(0)-45)*pi/20.0)*3
y = -sin((root, fvar(0)-45)*pi/20.0)*24

[State 1001, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
triggerall = root, fvar(0) = [65, 95]
triggerall = root, fvar(1)
trigger1 = root, var(1) != -facing*root, facing
x = -sin((root, fvar(0)-65)*pi/20.0)*9
y = -sin((root, fvar(0)-65)*pi/20.0)*24

[State 1001, Explod]
type = Explod
triggerall = root, var(1) != -facing*root, facing
trigger1 = root, fvar(0) = 45
trigger1 = !root, fvar(1)
trigger2 = root, fvar(0) = 65
trigger2 = root, fvar(1)
anim = 1010
id = 0
sprpriority = -1
scale = const(size.xscale), const(size.yscale)
bindtime = -1
ownpal = 1
persistent = 0

[State 1001, PlaySnd]
type = PlaySnd
triggerall = root, var(1) = facing*root, facing
trigger1 = root, fvar(0) = 45
trigger1 = !root, fvar(1)
value = 1020, 0
persistent = 0

[State 1001, PlaySnd]
type = PlaySnd
triggerall = root, var(1) = facing*root, facing
trigger1 = root, fvar(0) = 45
trigger1 = !root, fvar(1)
value = 1070, 0
persistent = 0

[State 1001, PlaySnd]
type = PlaySnd
triggerall = root, var(1) = facing*root, facing
trigger1 = root, fvar(0) = 65
trigger1 = root, fvar(1)
value = 1200, 0
persistent = 0

[Statedef 1003]
ctrl = 0
anim = 3
sprpriority = -5

[State 1003, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1000
value = root, stateno + 3

[State 1003, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 40
trigger2 = !time
trigger2 = !prevstateno
x = pos x*0.8 + root, pos x*0.2

[State 1003, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.005) + root, pos x*root, var(3)*0.005

[State 1003, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
trigger2 = !time
trigger2 = !prevstateno
y = -180 - cos((root, var(0) + 10)*pi/60.0)*5

[State 1003, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
y = pos y*(1 - root, var(3)*0.005) - (180 + cos((root, var(0) + 10)*pi/60.0)*5)*root, var(3)*0.005

[State 1003, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;
[Statedef 1020]
ctrl = 0
type = A
physics = N
movetype = A
sprpriority = 3
anim = 4020

[State 1020, VarSet]
type = VarSet
trigger1 = !time
var(0) = facing*root, facing

[State 1020, BindToParent]
type = BindToParent
trigger1 = var(0) = -1
pos = -116*facing*root, facing, floor(helper(1), pos y - root, pos y + 164*const(size.yscale))

[State 1020, BindToParent]
type = BindToParent
trigger1 = var(0) = 1
pos = -116*facing*root, facing, floor(helper(2), pos y - root, pos y + 164*const(size.yscale))

[State 1020, ChangeState]
type = ChangeState
trigger1 = animtime = 0
value = 1021

[Statedef 1021]
ctrl = 0
type = A
physics = N
movetype = A
sprpriority = 3
anim = 4021

[State 1021, VelSet]
type = VelSet
trigger1 = time = 1
y = 4

[State 1021, ChangeState]
type = ChangeState
trigger1 = pos y + vel y >= -8*const(size.yscale)
value = 1025

[Statedef 1025]
ctrl = 0
type = S
physics = N
movetype = A
anim = 9999
velset = 0, 0

[State 1025, PosSet]
type = PosSet
trigger1 = !time
y = -8*const(size.yscale)

[State 1025, ParentVarSet]
type = ParentVarSet
trigger1 = time < 61
trigger1 = time%15 = 0
var(11) = ifelse(parent, var(10) = 1, floor((pos x + parent, var(11)))/2, floor(pos x))

[State 1025, ParentVarSet]
type = ParentVarSet
trigger1 = time < 61
trigger1 = time%15 = 0
var(10) = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4031
id = 6
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = 72, 0
bindtime = -1
ownpal = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4030
id = 5
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = 60, 0
bindtime = -1
ownpal = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4029
id = 4
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = 48, 0
bindtime = -1
ownpal = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4028
id = 3
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = 36, 0
bindtime = -1
ownpal = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4027
id = 2
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = 24, 0
bindtime = -1
ownpal = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4026
id = 1
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = 15, 0
bindtime = -1
ownpal = 1

[State 1025, Explod]
type = Explod
trigger1 = !time
anim = 4025
id = 0
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
bindtime = -1
ownpal = 1

[State 1025, Projectile]
type = Projectile
trigger1 = time < 61
trigger1 = time%10 = 0
projid = 1050
projanim = 4035
projremovetime = 12
projmisstime = 12
projhits = 2
projpriority = 9999
projedgebound = 320
projstagebound = 320
projheightbound = -480, 240
offset = 12*time/10, 0
id = 1050
attr = S, SP
animtype  = Heavy
damage    = 120
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Low
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 2
fall.animtype = Heavy
p2stateno = 5400

[State 1025, DestroySelf]
type = DestroySelf
trigger1 = time = 95

;---------------------------------------------------------------------------
; Flaming Wisps

[Statedef 1100]
type = A
movetype = I
physics = N
anim = 1100
sprpriority = -2
ctrl = 0

[State 1100, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 1100, VarSet]
type = VarSet
trigger1 = !var(3)
var(0) = ifelse(random%2, -1, 1)

[State 1100, VarSet]
type = VarSet
trigger1 = !var(3)
var(1) = random%3

[State 1100, Helper]
type = Helper
trigger1 = var(3) = 20
name = "c"
id = 1155
stateno = 1155
postype = left
pos = floor(screenpos x), -75
facing = var(0)
ownpal = 1

[State 1100, VarSet]
type = VarSet
trigger1 = numhelper(3)
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 1100, VarSet]
type = VarSet
trigger1 = !numhelper(3)
fvar(2) = pos x

[State 1100, 5]
type = ChangeState
trigger1 = var(3) = 80
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 360
trigger1 = var(1) := 60
value = 0

[State 1100, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 1100, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 1100, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 1100, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 1100, PosSet]
type = PosSet
trigger1 = var(3) = [1, 40]
x = pos x*(1 - var(3)*0.025) + fvar(2)*var(3)*0.025

[State 1100, PosSet]
type = PosSet
trigger1 = var(3) = [1, 200]
y = pos y*(1 - var(3)*0.005) - 95*var(3)*0.005

[Statedef 1101]
ctrl = 0
sprpriority = -2

[State 1101, PosAdd]
type = PosAdd
trigger1 = !time
trigger1 = anim != 201
x = -24
y = -12

[State 1101, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = 201

[State 1101, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1100
value = root, stateno + 1

[State 1101, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.025) + (root, fvar(2) - 100*facing)*root, var(3)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.025) - 260*root, var(3)*0.025

[State 1101, PosAdd]
type = PosAdd
trigger1 = root, stateno != 9000
y = -cos(root, var(3)*pi/3.0)*0.5

[Statedef 1103]
ctrl = 0
anim = 3
sprpriority = -5

[State 1103, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1100
value = root, stateno + 3

[State 1103, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
x = pos x*(1 - root, var(3)*0.005) + root, fvar(2)*root, var(3)*0.005 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.005) - 180*root, var(3)*0.005


[Statedef 1150]
ctrl = 0

[State 1150, ChangeState]
type = ChangeState
trigger1 = parent, anim = 1156
value = 1153

[State 1150, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1020
elem = random%5 + 1

[State 1150, VarSet]
type = VarSet
trigger1 = !time
var(0) = facing*parent, facing

[State 1150, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = helper(6000), pos x - parent, pos x

[State 1150, VarSet]
type = VarSet
trigger1 = !time
fvar(1) = (parent, pos x - pos x)*facing

[State 1150, VarSet]
type = VarSet
trigger1 = !time
fvar(2) = pos y

[State 1150, VarSet]
type = VarSet
trigger1 = !time
var(3) = parent, var(1)%3

[State 1150, VarSet]
type = VarSet
trigger1 = !time
fvar(3) = 20*var(3)

[State 1150, VarAdd]
type = VarAdd
trigger1 = time
fvar(3) = 1

[State 1150, ParentVarAdd]
type = ParentVarAdd
trigger1 = !time
var(1) = 1

[State 1150, PosSet]
type = PosSet
trigger1 = 1
x = helper(6000), pos x - fvar(0)
y = fvar(2)

[State 1150, ChangeState]
type = ChangeState
trigger1 = var(2) = 40 + 60*var(3)
value = 1151

[State 1150, VarAdd]
type = VarAdd
trigger1 = var(2)
var(2) = 1

[State 1150, VarSet]
type = VarSet
trigger1 = !var(2)
trigger1 = root, var(3) > 59
var(2) = 1

[State 1150, PosAdd]
type = PosAdd
trigger1 = !var(2)
x = cos(fvar(3)*pi/30.0)*(60 - (root, var(3) - 20))
y = sin(fvar(3)*pi/30.0)*(15 - 0.2*(root, var(3) - 20)*var(0))

[State 1150, PosAdd]
type = PosAdd
trigger1 = var(2) = [1, 39]
x = cos(fvar(3)*pi/30.0)*(20 + var(2)*0.5)
y = sin(fvar(3)*pi/30.0)*(5 + var(2)*0.125)*var(0)

[State 1150, PosAdd]
type = PosAdd
trigger1 = var(2) > 39
x = cos(fvar(3)*pi/30.0)*40
y = sin(fvar(3)*pi/30.0)*10*var(0)

[State 1150, SprPriority]
type = SprPriority
trigger1 = pos y < fvar(2)
value = -1

[State 1150, SprPriority]
type = SprPriority
trigger1 = pos y > fvar(2)
value = 0

[State 1150, VarSet]
type = VarSet
trigger1 = !var(2)
trigger1 = root, var(3) < 40
fvar(10) = 0.03*(root, var(3) - 20)

[State 1150, VarSet]
type = VarSet
trigger1 = var(2)
trigger2 = root, var(3) > 39
fvar(10) = 0.6

[State 1150, AngleDraw]
type = AngleDraw
trigger1 = 1
scale = fvar(10), fvar(10)

[Statedef 1151]
ctrl = 0

[State 1151, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 1020, 1

[State 1151, VarSet]
type = VarSet
trigger1 = !time
trigger1 = fvar(4) := p2dist x || 1
fvar(5) = enemynear, pos x - pos x

[State 1151, Turn]
type = Turn
trigger1 = !time

[State 1151, VarSet]
type = VarSet
trigger1 = !time
trigger1 = abs(p2dist x) < abs(fvar(4))
fvar(5) = enemynear, pos x - pos x

[State 1151, Turn]
type = Turn
trigger1 = !time

[State 1151, VarAdd]
type = VarAdd
trigger1 = !time
fvar(2) = 16

[State 1151, VarAdd]
type = VarAdd
trigger1 = 1
fvar(3) = 1

[State 1151, VarSet]
type = VarSet
trigger1 = !time
fvar(6) = -fvar(2)

[State 1151, VarSet]
type = VarSet
trigger1 = !time
trigger1 = fvar(6)
fvar(7) = atan(fvar(5)/fvar(6)) + ifelse(fvar(6) < 0, ifelse(fvar(5) < 0, -pi, pi), 0)
ignorehitpause = 1

[State 1151, VarSet]
type = VarSet
trigger1 = !time
trigger1 = fvar(6) = 0
fvar(7) = ifelse(fvar(5) < 0, -0.5*pi, 0.5*pi)
ignorehitpause = 1

[State 1151, VarSet]
type = VarSet
trigger1 = !time
fvar(8) = 0.2*sin(fvar(7))

[State 1151, VarSet]
type = VarSet
trigger1 = !time
fvar(9) = 0.2*cos(fvar(7))

[State 1151, VarAdd]
type = VarAdd
trigger1 = time
fvar(8) = 0.1*sin(fvar(7))

[State 1151, VarAdd]
type = VarAdd
trigger1 = time
fvar(9) = 0.1*cos(fvar(7))

[State 1151, PosSet]
type = PosSet
trigger1 = 1
x = helper(6000), pos x - fvar(0) + fvar(8)*time
y = fvar(2) - 16 + fvar(9)*time

[State 1151, ChangeState]
type = ChangeState
trigger1 = pos y >= -16
value = 1152

[State 1151, PosAdd]
type = PosAdd
trigger1 = time < 40
x = cos(fvar(3)*pi/30.0)*(40 - time)
y = sin(fvar(3)*pi/30.0)*(10 - time*0.2)*var(0)

[State 1151, SprPriority]
type = SprPriority
trigger1 = pos y < fvar(2) - 16 + fvar(9)*time
trigger1 = time < 5
value = -1

[State 1151, SprPriority]
type = SprPriority
trigger1 = pos y > fvar(2) - 16 + fvar(9)*time
trigger1 = time < 5
value = 0

[State 1151, SprPriority]
type = SprPriority
trigger1 = time = 5
value = 0

[State 1151, VarSet]
type = VarSet
trigger1 = time < 40
fvar(10) = 0.6 + 0.01*time

[State 1150, AngleDraw]
type = AngleDraw
trigger1 = time < 40
scale = fvar(10), fvar(10)

[Statedef 1152]
ctrl = 0
movetype = I
sprpriority = 3
anim = 1050
velset = 0, 0

[State 1152, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 1050, 0

[State 1152, Projectile]
type = Projectile
trigger1 = !time
projid = 1050
projanim = 1051
projremovetime = 8
projmisstime = 8
projhits = 2
projpriority = 9999
id = 1050
attr = C, SP
animtype  = Heavy
damage    = 120
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Trip
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 3
fall.animtype = Heavy
p2stateno = 5400

[State 1152, PosSet]
type = PosSet
trigger1 = !time
y = 0

[State 1152, EnvShake]
type = EnvShake
trigger1 = !time
time = 5
freq = 50
ampl = 3
phase = 270
persistent = 0

[State 1152, DestroySelf]
type = DestroySelf
trigger1 = !animtime

[Statedef 1153]
ctrl = 0
movetype = I

[State 1153, VarAdd]
type = VarAdd
trigger1 = 1
fvar(10) = -0.02

[State 1153, DestroySelf]
type = DestroySelf
trigger1 = fvar(10) <= 0

[State 1153, AngleDraw]
type = AngleDraw
trigger1 = 1
scale = fvar(10), fvar(10)

[Statedef 1154]
ctrl = 0

[State 1154, ChangeState]
type = ChangeState
trigger1 = parent, anim = 1156
value = 1153

[State 1154, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1020
elem = random%5 + 1

[State 1154, VarSet]
type = VarSet
trigger1 = !time
var(0) = facing*parent, facing

[State 1154, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = helper(6000), pos x - parent, pos x

[State 1154, VarSet]
type = VarSet
trigger1 = !time
fvar(1) = (parent, pos x - pos x)*facing

[State 1154, VarSet]
type = VarSet
trigger1 = !time
fvar(2) = pos y

[State 1154, VarSet]
type = VarSet
trigger1 = !time
var(3) = parent, var(1)%3

[State 1154, VarSet]
type = VarSet
trigger1 = !time
fvar(3) = 20*var(3)

[State 1154, VarAdd]
type = VarAdd
trigger1 = time
fvar(3) = 1

[State 1154, ParentVarAdd]
type = ParentVarAdd
trigger1 = !time
var(1) = 1

[State 1154, PosSet]
type = PosSet
trigger1 = 1
x = helper(6000), pos x - fvar(0)
y = fvar(2)

[State 1154, ChangeState]
type = ChangeState
trigger1 = var(2) = 40 + 60*var(3)
value = 1151

[State 1154, VarAdd]
type = VarAdd
trigger1 = var(2)
var(2) = 1

[State 1154, VarSet]
type = VarSet
trigger1 = !var(2)
trigger1 = parent, var(3) > 59
var(2) = 1

[State 1154, PosAdd]
type = PosAdd
trigger1 = !var(2)
x = cos(fvar(3)*pi/30.0)*(60 - (parent, var(3) - 20))
y = sin(fvar(3)*pi/30.0)*(15 - 0.2*(parent, var(3) - 20)*var(0))

[State 1154, PosAdd]
type = PosAdd
trigger1 = var(2) = [1, 39]
x = cos(fvar(3)*pi/30.0)*(20 + var(2)*0.5)
y = sin(fvar(3)*pi/30.0)*(5 + var(2)*0.125)*var(0)

[State 1154, PosAdd]
type = PosAdd
trigger1 = var(2) > 39
x = cos(fvar(3)*pi/30.0)*40
y = sin(fvar(3)*pi/30.0)*10*var(0)

[State 1154, SprPriority]
type = SprPriority
trigger1 = pos y < fvar(2)
value = -1

[State 1154, SprPriority]
type = SprPriority
trigger1 = pos y > fvar(2)
value = 0

[State 1154, VarSet]
type = VarSet
trigger1 = !var(2)
trigger1 = parent, var(3) < 40
fvar(10) = 0.03*(parent, var(3) - 20)

[State 1154, VarSet]
type = VarSet
trigger1 = var(2)
trigger2 = parent, var(3) > 39
fvar(10) = 0.6

[State 1154, AngleDraw]
type = AngleDraw
trigger1 = 1
scale = fvar(10), fvar(10)

[Statedef 1155]
ctrl = 0
sprpriority = -1

[State 1155, Invisible]
type = AssertSpecial
trigger1 = 1
flag = invisible

[State 1155, PlaySnd]
type = PlaySnd
trigger1 = !time
trigger2 = var(2) > 100
trigger2 = (var(2)+60)%330 = 0
value = 1070, 0

[State 1155, Helper]
type = Helper
trigger1 = !time
name = "a"
id = 1150
stateno = 1150
ownpal = 1

[State 1155, Helper]
type = Helper
trigger1 = !time
name = "a"
id = 1151
stateno = 1150
ownpal = 1

[State 1155, Helper]
type = Helper
trigger1 = !time
name = "a"
id = 1152
stateno = 1150
ownpal = 1

[State 1155, VarSet]
type = VarSet
trigger1 = var(2) > 100
trigger1 = (var(2)+60)%330 = 0
var(1) = 0

[State 1155, VarSet]
type = VarSet
trigger1 = var(2) > 100
trigger1 = (var(2)+60)%330 = 0
var(3) = 20

[State 1155, Helper]
type = Helper
trigger1 = var(2) > 100
trigger1 = (var(2)+60)%330 = 0
name = "a"
id = 1150
stateno = 1154
ownpal = 1

[State 1155, Helper]
type = Helper
trigger1 = var(2) > 100
trigger1 = (var(2)+60)%330 = 0
name = "a"
id = 1151
stateno = 1154
ownpal = 1

[State 1155, Helper]
type = Helper
trigger1 = var(2) > 100
trigger1 = (var(2)+60)%330 = 0
name = "a"
id = 1152
stateno = 1154
ownpal = 1

[State 1155, DestroySelf]
type = DestroySelf
trigger1 = anim = 1156
trigger1 = !animtime

[State 1155, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1155
elem = random%4 + 1

[State 1155, ChangeAnim]
type = ChangeAnim
triggerall = anim != 1156
trigger1 = var(2) = 330*(root, var(25)-1) + 180
trigger2 = !root, alive
trigger3 = root, var(2) = 1100
trigger3 = root, var(3) = [10, 19]
trigger4 = root, var(2) = 1405
trigger5 = root, var(2) = [2000, 3000)
trigger6 = roundstate > 2
value = 1156

[State 1155, ChangeAnim]
type = ChangeAnim
triggerall = !var(2)
triggerall = anim != 1156
trigger1 = root, stateno = 9100
trigger2 = root, var(2) = 9100
value = 1156

[State 1155, VarAdd]
type = VarAdd
trigger1 = var(2)
var(2) = 1

[State 1155, VarAdd]
type = VarAdd
trigger1 = var(2)
var(3) = 1

[State 1155, VarSet]
type = VarSet
trigger1 = !var(2)
trigger1 = root, var(3) > 59
var(2) = 1

[State 1155, VarSet]
type = VarSet
trigger1 = !var(2)
trigger1 = root, var(3) < 40
trigger1 = anim = 1155
fvar(10) = 0.05*(root, var(3) - 20)

[State 1155, Explod]
type = Explod
trigger1 = anim = 1155
trigger1 = !numexplod(1155)
anim = 1155
id = 1155
sprpriority = 0
scale = 0, 0
bindtime = -1
removetime = -1

[State 1155, ModifyExplod]
type = ModifyExplod
trigger1 = anim = 1155
trigger1 = fvar(10) < 1
scale = fvar(10)*const(size.xscale), fvar(10)*const(size.yscale)

[State 1155, ModifyExplod]
type = ModifyExplod
trigger1 = anim = 1155
trigger1 = fvar(10) >= 1
scale = const(size.xscale), const(size.yscale)

[State 1155, RemoveExplod]
type = RemoveExplod
trigger1 = anim = 1156
id = 1155
persistent = 0

[State 1155, Explod]
type = Explod
trigger1 = anim = 1156
anim = 1156
id = 1156
sprpriority = 0
scale = const(size.xscale), const(size.yscale)
bindtime = 1
persistent = 0

;---------------------------------------------------------------------------
; Fire Bolt

[Statedef 1250]
ctrl = 0
anim = 1250
sprpriority = -1

[State 1250, DestroySelf]
type = DestroySelf
trigger1 = root, stateno = 9100
trigger2 = !root, alive

[State 1250, VarSet]
type = VarSet
trigger1 = !time
var(0) = facing*root, facing

[State 1250, BindToParent]
type = BindToParent
trigger1 = var(0) = -1
pos = -116*facing*root, facing, floor(helper(1), pos y - root, pos y + 164*const(size.yscale))

[State 1250, BindToParent]
type = BindToParent
trigger1 = var(0) = 1
pos = -116*facing*root, facing, floor(helper(2), pos y - root, pos y + 164*const(size.yscale))

[State 1250, AngleDraw]
type = AngleDraw
trigger1 = root, fvar(0) < 65
scale = 0.025*(root, fvar(0) - 25), 0.025*(root, fvar(0) - 25)

[State 1250, ChangeState]
type = ChangeState
trigger1 = root, fvar(0) = 65
trigger1 = var(0) := 0 || 1
value = 1251

[Statedef 1251]
ctrl = 0

[State 1251, PlaySnd]
type = PlaySnd
trigger1 = 1
value = 1200, 0

[State 1251, Turn]
type = Turn
trigger1 = p2dist x < 0

[State 1251, VarSet]
type = VarSet
trigger1 = 1
fvar(0) = const(size.xscale)*p2dist x
ignorehitpause = 1

[State 1251, VarSet]
type = VarSet
trigger1 = p2statetype = C || p2statetype = L
fvar(1) = const(size.yscale)*(p2dist y + 0.5*enemynear, const(size.mid.pos.y))
ignorehitpause = 1

[State 1251, VarSet]
type = VarSet
trigger1 = p2statetype = S
fvar(1) = const(size.yscale)*(p2dist y + enemynear, const(size.head.pos.y)*0.8)
ignorehitpause = 1

[State 1251, VarSet]
type = VarSet
trigger1 = p2statetype = A
fvar(1) = const(size.yscale)*(p2dist y + enemynear, const(size.mid.pos.y))
ignorehitpause = 1

[State 1251, VarSet]
type = VarSet
trigger1 = fvar(1)
fvar(2) = atan(fvar(0)/fvar(1)) + ifelse(fvar(1) < 0, ifelse(fvar(0) < 0, -pi, pi), 0)
ignorehitpause = 1

[State 1251, VarSet]
type = VarSet
trigger1 = fvar(1) = 0
fvar(2) = ifelse(fvar(0) < 0, -0.5*pi, 0.5*pi)
ignorehitpause = 1

[State 1251, VelSet]
type = VelSet
trigger1 = 1
x = 6*sin(fvar(2))
y = 6*cos(fvar(2))

[State 1251, ChangeState]
type = ChangeState
trigger1 = 1
value = 1252

[Statedef 1252]
ctrl = 0
movetype = A
sprpriority = 3

[State 1252, Explod]
type = Explod
trigger1 = !var(0)
trigger1 = !time
anim = 1251
id = 0
sprpriority = 3
scale = const(size.xscale)*.833, const(size.yscale)*.833
pos = floor(-2*vel x), floor(-2*vel y)
bindtime = -1
removetime = -1
ownpal = 1
persistent = 0

[State 1252, Explod]
type = Explod
trigger1 = !var(0)
trigger1 = !time
anim = 1252
id = 1
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = floor(-4*vel x), floor(-4*vel y)
bindtime = -1
removetime = -1
ownpal = 1
persistent = 0

[State 1252, Explod]
type = Explod
trigger1 = !var(0)
trigger1 = !time
anim = 1253
id = 2
sprpriority = 3
scale = const(size.xscale)*.833, const(size.yscale)*.833
pos = floor(-6*vel x), floor(-6*vel y)
bindtime = -1
removetime = -1
ownpal = 1
persistent = 0

[State 1252, Explod]
type = Explod
trigger1 = !var(0)
trigger1 = !time
anim = 1254
id = 3
sprpriority = 3
scale = const(size.xscale), const(size.yscale)
pos = floor(-8*vel x), floor(-8*vel y)
bindtime = -1
removetime = -1
ownpal = 1
persistent = 0

[State 1252, Explod]
type = Explod
trigger1 = !var(0)
trigger1 = !time
anim = 1255
id = 4
sprpriority = 3
scale = const(size.xscale)*.833, const(size.yscale)*.833
pos = floor(-10*vel x), floor(-10*vel y)
bindtime = -1
removetime = -1
ownpal = 1
persistent = 0

[State 1252, DestroySelf]
type = DestroySelf
trigger1 = var(0)

[State 1252, Burn]
type = TargetState
trigger1 = movehit = 1
trigger1 = numtarget(1050)
value = 5400

[State 1252, Flame Helpers]
type = Helper
triggerall = movehit = 1
trigger1 = numtarget(1050) = 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = target(1050), facing
pos = floor(target(1050), pos x), floor(target(1050), pos y)
ownpal = 1
ignorehitpause = 1

[State 1252, Flame Helpers]
type = Helper
triggerall = movehit = 1
trigger1 = numtarget(1050) > 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = enemy(0), facing
pos = floor(enemy(0), pos x), floor(enemy(0), pos y)
ownpal = 1
ignorehitpause = 1

[State 1252, Flame Helpers]
type = Helper
triggerall = movehit = 1
trigger1 = numtarget(1050) > 1
trigger1 = numenemy > 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = enemy(1), facing
pos = floor(enemy(1), pos x), floor(enemy(1), pos y)
ownpal = 1
ignorehitpause = 1

[State 1252, Burn]
type = TargetDrop
trigger1 = movehit = 1

[State 1252, ChangeState]
type = ChangeState
trigger1 = movecontact = 1
trigger2 = movereversed = 1
trigger3 = pos y > 0
value = 1253

[State 1252, VarSet]
type = VarSet
trigger1 = screenpos x < -50
trigger1 = vel x*facing < 0
trigger2 = screenpos x > 370
trigger2 = vel x*facing > 0
trigger3 = screenpos y < -50
trigger3 = vel y < 0
var(0) = 1

[State 1252, RemoveExplod]
type = RemoveExplod
trigger1 = var(0)

[State 1252, HitDef]
type = HitDef
trigger1 = !movehit
trigger1 = !movereversed
id = 1050
attr = A, SP
animtype  = Heavy
damage    = 100, 20
priority  = 5
numhits = 0
hitflag = MAF
guardflag = MA
pausetime = 0,0
guard.pausetime = 0, 11
sparkno = 2
sparkxy = -10, 0
hitsound   = -1
guardsound = -1
ground.type = High
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
ground.cornerpush.veloff = 0
guard.velocity = -5
air.type = Low
air.velocity = -2.5, -5
airguard.velocity = -3, -5
fall = 1
fall.animtype = Heavy
fall.recover = 0
fall.recovertime = 1

[Statedef 1253]
ctrl = 0
movetype = A
anim = 9999

[State 1253, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(10) = 1

[State 1253, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(11) = floor(pos x)

[State 1253, Explod]
type = Explod
trigger1 = !time
anim = 1256
id = 5
sprpriority = 4
scale = const(size.xscale), const(size.yscale)
bindtime = 1
vel = -2, 2
ownpal = 1
persistent = 0

[State 1253, Explod]
type = Explod
trigger1 = !time
anim = 1256
id = 5
sprpriority = 4
scale = const(size.xscale), const(size.yscale)
bindtime = 1
vel = 2, 2
ownpal = 1
persistent = 0

[State 1253, Explod]
type = Explod
trigger1 = !time
anim = 1256
id = 5
sprpriority = 4
scale = const(size.xscale), const(size.yscale)
bindtime = 1
vel = -2, -2
ownpal = 1
persistent = 0

[State 1253, Explod]
type = Explod
trigger1 = !time
anim = 1256
id = 5
sprpriority = 4
scale = const(size.xscale), const(size.yscale)
bindtime = 1
vel = 2, -2
ownpal = 1
persistent = 0

[State 1253, RemoveExplod]
type = RemoveExplod
trigger1 = time = 2
id = 0

[State 1253, RemoveExplod]
type = RemoveExplod
trigger1 = time = 4
id = 1

[State 1253, RemoveExplod]
type = RemoveExplod
trigger1 = time = 6
id = 2

[State 1253, RemoveExplod]
type = RemoveExplod
trigger1 = time = 8
id = 3

[State 1253, RemoveExplod]
type = RemoveExplod
trigger1 = time = 10
id = 4

[State 1253, DestroySelf]
type = DestroySelf
trigger1 = time = 16

;---------------------------------------------------------------------------
; Slam

[Statedef 1300]
type = A
movetype = I
physics = N
anim = 1100
sprpriority = -2
ctrl = 0

[State 1300, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 1300, VarSet]
type = VarSet
trigger1 = numhelper(3)
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 1300, VarSet]
type = VarSet
trigger1 = !numhelper(3)
fvar(2) = pos x

[State 1300, 5]
type = ChangeState
trigger1 = var(3) = ifelse(!var(1), 30, 20)
trigger1 = var(3) := 0 || 1
value = 1305

[State 1300, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 1300, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 1300, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 1300, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 1300, PosSet]
type = PosSet
trigger1 = var(3) = [1, 100]
x = pos x*(1 - var(3)*0.01) + fvar(2)*var(3)*0.01
y = pos y*(1 - var(3)*0.01) - (95 + 0.1*var(3))*var(3)*0.01

[Statedef 1301]
ctrl = 0
sprpriority = -2

[State 1301, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1300
value = root, stateno + 1

[State 1301, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 1301, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = ifelse(root, var(1) = -facing*root, facing, 202, 1301)

[State 1301, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 100]
trigger1 = root, var(1) != -facing*root, facing
x = pos x*(1 - root, var(3)*0.01) + (root, fvar(2) - 110*facing)*root, var(3)*0.01 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.01) - (290 + 1.5*root, var(3))*root, var(3)*0.01

[State 1301, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 100]
trigger1 = root, var(1) = -facing*root, facing
x = pos x*(1 - root, var(3)*0.01) + (root, fvar(2) - 110*facing)*root, var(3)*0.01 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.01) - (275 - 0.15*root, var(3))*root, var(3)*0.01

[Statedef 1303]
ctrl = 0
anim = 3
sprpriority = -5

[State 1303, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1300
value = root, stateno + 3

[State 1303, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 500]
x = pos x*(1 - root, var(3)*0.002) + root, fvar(2)*root, var(3)*0.002 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.002) - (180 + 0.1)*root, var(3)*0.002

[Statedef 1305]
type = A
movetype = I
physics = N
anim = 1100
sprpriority = -2
ctrl = 0
velset = 0, 0

[State 1305, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 1305, VarSet]
type = VarSet
trigger1 = numhelper(3)
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 1305, VarSet]
type = VarSet
trigger1 = !numhelper(3)
fvar(2) = pos x

[State 1305, 5]
type = ChangeState
trigger1 = var(3) = ifelse(!var(1), 50, 40)
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 90
trigger1 = var(1) := 60
value = 0

[State 1305, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 1305, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 1305, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 1305, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 1305, PosSet]
type = PosSet
trigger1 = var(3) = [1, 100]
x = pos x*(1 - var(3)*0.01) + fvar(2)*var(3)*0.01
y = pos y*(1 - var(3)*0.01) - (50 + 0.5*var(3))*var(3)*0.01

[State 1305, PlaySnd]
type = PlaySnd
trigger1 = !var(1)
trigger1 = numhelper(1)
trigger1 = numhelper(2)
trigger1 = !helper(1), var(0) || !helper(2), var(0)
trigger1 = (helper(1), screenpos y + helper(2), screenpos y)*0.5 + var(3)**1.5 > 15*const(size.yscale)
value = 1300, 0

[Statedef 1306]
ctrl = 0
movetype = I
sprpriority = -2

[State 1306, ChangeState]
type = ChangeState
triggerall = root, stateno != [9000, 9001]
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1305
value = root, stateno + 1

[State 1306, VarSet]
type = VarSet
trigger1 = !time
var(0) = 0

[State 1306, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = ifelse(root, var(1) = -facing*root, facing, 202, 1306)

[State 1306, PosSet]
type = PosSet
triggerall = root, stateno != [9000, 9001]
trigger1 = var(0)
trigger1 = root, var(3) = [var(0) + 2, var(0) + 42]
trigger1 = root, var(1) != -facing*root, facing
y = pos y*(1 - (root, var(3)-var(0)-2)*0.01) - 230*(root, var(3)-var(0)-2)*0.01

[State 1306, PosAdd]
type = PosAdd
triggerall = root, stateno != [9000, 9001]
trigger1 = !var(0)
trigger1 = root, var(1) != -facing*root, facing
x = -(root, var(3) - 1)

[State 1306, PosSet]
type = PosSet
triggerall = root, stateno != [9000, 9001]
trigger1 = !var(0)
trigger1 = root, var(3) = [1, 20]
trigger1 = root, var(1) != -facing*root, facing
x = pos x*(1 - root, var(3)*0.05) + (root, fvar(2) - 90*facing)*root, var(3)*0.05 + root, vel x*root, facing

[State 1306, PosAdd]
type = PosAdd
triggerall = root, stateno != [9000, 9001]
trigger1 = !var(0)
trigger1 = root, var(1) != -facing*root, facing
y = root, var(3)**1.5

[State 1306, PlaySnd]
type = PlaySnd
trigger1 = !var(0)
trigger1 = root, var(1) = facing*root, facing
trigger1 = screenpos y > 15*const(size.yscale)
value = 1300, 0

[State 1306, EnvShake]
type = EnvShake
trigger1 = !var(0)
trigger1 = root, var(1) != -facing*root, facing
trigger1 = screenpos y > 15*const(size.yscale)
time = ifelse(root, var(1), 15, 18)
freq = 50
ampl = ifelse(root, var(1), 5, 8)
phase = 270

[State 1306, Explod]
type = Explod
trigger1 = !var(0)
trigger1 = root, var(1) != -facing*root, facing
trigger1 = screenpos y > 15*const(size.yscale)
anim = F61
bindtime = 1
ownpal = 1
sprpriority = -3
pos = -4, 185

[State 1306, Projectile]
type = Projectile
trigger1 = !var(0)
trigger1 = root, var(1) = facing*root, facing
trigger1 = screenpos y > 15*const(size.yscale)
projid = 1350
projanim = 1350
projremovetime = 2
projhits = 1
projpriority = 9999
projedgebound = 9999
projstagebound = 9999
projheightbound = -480, 240
offset = 0, floor(205 - screenpos y)
trigger1 = 1
id = 1350
attr = C, ST
animtype  = Back
damage    = 90
priority  = 5
numhits = 0
hitflag = M
guardflag = 
pausetime = 0,3
sparkno = -1
hitsound   = -1
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = 0, -5
air.type = Trip
air.velocity = 0, -5
fall = 1
fall.recover = 0

[State 1306, Projectile]
type = Projectile
trigger1 = !var(0)
trigger1 = !root, var(1)
trigger1 = facing = 1
trigger1 = screenpos y > 15*const(size.yscale)
projid = 1350
projanim = 1355
projremovetime = 2
projhits = 1
projpriority = 9999
projedgebound = 9999
projstagebound = 9999
projheightbound = -480, 240
offset = 0, floor(205 - screenpos y)
trigger1 = 1
id = 1350
attr = C, ST
animtype  = Back
damage    = 120
priority  = 5
numhits = 0
hitflag = M
guardflag = 
pausetime = 0,3
sparkno = -1
hitsound   = -1
ground.type = Trip
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = 0, -7.5
air.type = Trip
air.velocity = 0, -7.5
fall = 1
fall.recover = 0

[State 1306, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = !var(0)
trigger1 = screenpos y > 15*const(size.yscale)
trigger1 = var(0) := root, var(3) || 1
y = 15*const(size.yscale) - screenpos y

[State 1306, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 50]
trigger1 = root, var(1) = -facing*root, facing
x = pos x*(1 - root, var(3)*0.02) + (root, fvar(2) - 100*facing)*root, var(3)*0.02 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.02) - 290*root, var(3)*0.02

[Statedef 1308]
ctrl = 0
anim = 3
sprpriority = -5

[State 1308, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1305
value = root, stateno + 3

[State 1308, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 500]
x = pos x*(1 - root, var(3)*0.002) + root, fvar(2)*root, var(3)*0.002 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.002) - (150 + 0.5*root, var(3))*root, var(3)*0.002

;---------------------------------------------------------------------------
; Undead Summoning

[Statedef 1400]
type = A
movetype = I
physics = N
anim = 800
sprpriority = -2
ctrl = 0

[State 1400, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 1400, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 - ifelse(var(3) < 20, var(3)*1.2, 20.4)

[State 1400, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 1400, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 1400, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 1400, 5]
type = ChangeState
trigger1 = var(3) >= 20
trigger1 = vel x = [-1, 1]
trigger1 = var(3) := 0 || 1
value = 1405

[State 1400, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 1400, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 50]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 1400, PosSet]
type =  PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 51
y = fvar(3)

[State 1400, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [2, 51]
x = pos x*(1 - (var(3)-1)*0.02) + fvar(2)*(var(3)-1)*0.02
y = pos y*(1 - (var(3)-1)*0.02) + fvar(3)*(var(3)-1)*0.02

[Statedef 1401]
ctrl = 0
sprpriority = -2

[State 1401, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 1401, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = 1001

[State 1401, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1400
value = root, stateno + 1

[State 1401, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 50
x = root, pos x - 115*facing + root, vel x*root, facing
y = -300.5 - root, var(3)*0.4

[State 1401, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 50]
x = pos x*(1 - root, var(3)*0.02) + (root, fvar(2) - 115*facing)*root, var(3)*0.02 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.02) - (300.5 + root, var(3)*0.4)*root, var(3)*0.02

[State 1401, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 1403]
ctrl = 0
anim = 3
sprpriority = -5

[State 1403, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1400
value = root, stateno + 3

[State 1403, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 50
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*0.3

[State 1403, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 50]
x = pos x*(1 - root, var(3)*0.02) + root, fvar(2)*root, var(3)*0.02 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.02) - (180 + root, var(3)*0.3)*root, var(3)*0.02

[State 1403, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 1405]
type = A
movetype = I
physics = N
anim = 2000
sprpriority = -2
ctrl = 0

[State 1405, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 1405, VarSet]
type = VarSet
trigger1 = !var(3)
var(49) = 12000

[State 1405, Helper]
type = Helper
trigger1 = !var(3)
trigger1 = var(21) > 0
name = "sk"
id = 4000
stateno = 4019
postype = left
pos = floor(screenpos x) - 50 + random%100, 0
ownpal = 1
facing = ifelse(var(21) = 1, ifelse(random%2, -1, 1), 1)
size.xscale = const(size.xscale)*1.25
size.yscale = const(size.yscale)*1.25

[State 1405, Helper]
type = Helper
trigger1 = !var(3)
trigger1 = var(21) > 1
name = "sk"
id = 4000
stateno = 4019
postype = left
pos = floor(screenpos x) - 50 + random%100, 0
ownpal = 1
facing = -1
size.xscale = const(size.xscale)*1.25
size.yscale = const(size.yscale)*1.25

[State 1405, Helper]
type = Helper
trigger1 = !var(3)
trigger1 = var(21) > 2
name = "sk"
id = 4000
stateno = 4019
postype = left
pos = floor(screenpos x) - 50 + random%100, 0
ownpal = 1
facing = ifelse(var(21) = 3, ifelse(random%2, -1, 1), 1)
size.xscale = const(size.xscale)*1.25
size.yscale = const(size.yscale)*1.25

[State 1405, Helper]
type = Helper
trigger1 = !var(3)
trigger1 = var(21) > 3
name = "sk"
id = 4000
stateno = 4019
postype = left
pos = floor(screenpos x) - 50 + random%100, 0
ownpal = 1
facing = -1
size.xscale = const(size.xscale)*1.25
size.yscale = const(size.yscale)*1.25

[State 1405, Helper]
type = Helper
trigger1 = !var(3)
trigger1 = var(21) > 4
name = "sk"
id = 4000
stateno = 4019
postype = left
pos = floor(screenpos x) - 50 + random%100, 0
ownpal = 1
facing = ifelse(var(21) = 5, ifelse(random%2, -1, 1), 1)
size.xscale = const(size.xscale)*1.25
size.yscale = const(size.yscale)*1.25

[State 1405, Helper]
type = Helper
trigger1 = !var(3)
trigger1 = var(21) > 5
name = "sk"
id = 4000
stateno = 4019
postype = left
pos = floor(screenpos x) - 50 + random%100, 0
ownpal = 1
facing = -1
size.xscale = const(size.xscale)*1.25
size.yscale = const(size.yscale)*1.25

[State 1405, 5]
type = ChangeState
trigger1 = var(3) = 40
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 90
value = 0

[State 1405, PlaySnd]
type = PlaySnd
trigger1 = !var(3)
value = 11, 0
channel = 1
persistent = 0

[State 1405, VarSet]
type = VarSet
trigger1 = !time
var(0) = 0

[State 1405, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -50

[State 1405, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 1405, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 1405, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 1405, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 1405, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 1405, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 20
y = fvar(3)

[State 1405, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
x = pos x*(1 - var(3)*0.05) + fvar(2)*var(3)*0.05
y = pos y*(1 - var(3)*0.05) + fvar(3)*var(3)*0.05

[State 1405, PosAdd]
type = PosAdd
trigger1 = var(3) > 10
y = -cos(var(3)*pi/1.5)

[Statedef 1406]
ctrl = 0
sprpriority = -2

[State 1406, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1001
elem = 2

[State 1406, ChangeAnim]
type = ChangeAnim
trigger1 = animelemno(0) = 3
value = 1001
elem = 3

[State 1406, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1405
value = root, stateno + 1

[State 1406, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
x = root, pos x - 125*facing + root, vel x*root, facing
y = -280

[State 1406, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + (root, fvar(2) - 125*facing)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 280*root, var(3)*0.05

[State 1406, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 1408]
ctrl = 0
anim = 3
sprpriority = -5

[State 1408, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 1405
value = root, stateno + 3

[State 1408, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing + root, vel x*root, facing
y = -170

[State 1408, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + root, fvar(2)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - 170*root, var(3)*0.05

[State 1408, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105


;---------------------------------------------------------------------------
; Breath (top-down)
;
[Statedef 2000]
type = A
movetype = I
physics = N
anim = 2000
sprpriority = -2
ctrl = 0

[State 2000, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2000, Helper]
type = Helper
trigger1 = !numhelper(6100)
name = "p1"
id = 6100
stateno = 6100
facing = facing
ownpal = 1
size.xscale = 1
size.yscale = 1
size.height = 999

[State 2000, Helper]
type = Helper
trigger1 = !numhelper(6101)
trigger1 = numenemy > 1
name = "p2"
id = 6101
stateno = 6101
facing = facing
ownpal = 1
size.xscale = 1
size.yscale = 1
size.height = 999

[State 2000, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -80 - var(3)*0.3

[State 2000, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x < ((command = "holdfwd") - (command = "holdback"))
trigger2 = var(59) > 0
trigger2 = vel x < ((p2dist x > var(53)) - (p2dist x < var(53)))
x = 0.2

[State 2000, VelAdd]
type = VelAdd
trigger1 = var(59) < 1
trigger1 = vel x > ((command = "holdfwd") - (command = "holdback"))
trigger2 = var(59) > 0
trigger2 = vel x > ((p2dist x > var(53)) - (p2dist x < var(53)))
x = -0.2

[State 2000, VelSet]
type = VelSet
triggerall = abs(vel x) < 0.2
trigger1 = var(59) < 1
trigger1 = !((command = "holdfwd") - (command = "holdback"))
trigger2 = var(59) > 0
trigger2 = !((p2dist x > var(53)) - (p2dist x < var(53)))
x = 0

[State 2000, PlaySnd]
type = PlaySnd
trigger1 = !var(3)
value = 2000, 0
channel = 1
persistent = 0

[State 2000, 5]
type = ChangeState
trigger1 = var(3) = 180
trigger1 = var(3) := 0 || 1
trigger1 = var(1) := 1
value = 2005

[State 2000, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 2000, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 500]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 2000, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 500
y = fvar(3)

[State 2000, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 500]
x = pos x*(1 - var(3)*0.002) + fvar(2)*var(3)*0.002
y = pos y*(1 - var(3)*0.002) + fvar(3)*var(3)*0.002

[State 2000, PosAdd]
type = PosAdd
trigger1 = 1
y = -cos(var(3)*pi/1.5)*1.5

[Statedef 2001]
ctrl = 0
sprpriority = -2

[State 2001, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 2001, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 2001, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2000
value = root, stateno + 1

[State 2001, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 500
x = root, pos x - (105.5 + root, var(3)*0.1)*facing + root, vel x*root, facing
y = -290.5 - root, var(3)*0.2

[State 2001, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 500]
x = pos x*(1 - root, var(3)*0.002) + (root, fvar(2) - (105.5 + root, var(3)*0.1)*facing)*root, var(3)*0.002 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.002) - (290.5 + root, var(3)*0.2)*root, var(3)*0.002

[State 2001, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 2001, PosAdd]
type = PosAdd
trigger1 = root, stateno = 2000
y = -cos(root, var(3)*pi/1.5)*1.5

[Statedef 2003]
ctrl = 0
anim = 3
sprpriority = -5

[State 2003, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2000
value = root, stateno + 3

[State 2003, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 500
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*0.1

[State 2003, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 500]
x = pos x*(1 - root, var(3)*0.002) + root, fvar(2)*root, var(3)*0.002 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.002) - (180 + root, var(3)*0.1)*root, var(3)*0.002

[State 2003, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[State 2003, PosAdd]
type = PosAdd
trigger1 = root, stateno = 2000
y = -cos(root, var(3)*pi/1.5)*1.0

[State 2003, VarSet]
type = VarSet
trigger1 = !time
var(0) = ifelse(random%2, -1, 1)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 8
anim = 6500
id = 6500
sprpriority = -2
postype = left
facing = facing
pos = floor(root, screenpos x + 120*var(0)), 190
random = 100, 0
vel = -2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 0
anim = 6500
id = 6500
sprpriority = -1
postype = left
facing = facing
pos = floor(root, screenpos x + 120*var(0)), 200
random = 100, 0
vel = -2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 4
anim = 6500
id = 6500
sprpriority = 2
postype = left
facing = facing
pos = floor(root, screenpos x + 120*var(0)), 220
random = 100, 0
vel = -2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 12
anim = 6500
id = 6500
sprpriority = 3
postype = left
facing = facing
pos = floor(root, screenpos x + 120*var(0)), 230
random = 100, 0
vel = -2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 2
anim = 6500
id = 6500
sprpriority = -2
postype = left
facing = -facing
pos = floor(root, screenpos x - 120*var(0)), 190
random = 100, 0
vel = 2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 10
anim = 6500
id = 6500
sprpriority = -1
postype = left
facing = -facing
pos = floor(root, screenpos x - 120*var(0)), 200
random = 100, 0
vel = 2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 14
anim = 6500
id = 6500
sprpriority = 2
postype = left
facing = -facing
pos = floor(root, screenpos x - 120*var(0)), 220
random = 100, 0
vel = 2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2003, Explod]
type = Explod
trigger1 = time%16 = 6
anim = 6500
id = 6500
sprpriority = 3
postype = left
facing = -facing
pos = floor(root, screenpos x - 120*var(0)), 230
random = 100, 0
vel = 2.4*var(0), -0.3
accel = 0, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[Statedef 2005]
type = A
movetype = I
physics = N
anim = 800
sprpriority = 3
ctrl = 0

[State 2005, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2005, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -60 - var(3)*0.2

[State 2005, RemoveExplod]
type = RemoveExplod
trigger1 = var(3) = 256
id = 0

[State 2005, RemoveExplod]
type = RemoveExplod
trigger1 = var(3) = 256
id = 2055

[State 2005, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 5
value = 2000, 1
channel = 2
persistent = 0

[State 2005, ChangeAnim]
type = ChangeAnim
trigger1 = var(3) = 256
value = 2010

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 256
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(screenpos x), 190
random = 48, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 256
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(screenpos x), 200
random = 48, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 256
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(screenpos x), 220
random = 56, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 256
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(screenpos x), 220
random = 64, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 256
anim = 2260
id = 2260
sprpriority = 4
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(screenpos x), 230
random = 64, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 256
anim = 2260
id = 2260
sprpriority = 4
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(screenpos x), 230
random = 72, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2005, 5]
type = ChangeState
trigger1 = var(3) = 256
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 220
trigger1 = var(1) := 120
value = 0

[State 2005, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 2005, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 2005, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 2005, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.2
x = 0

[State 2005, ChangeAnim]
type = ChangeAnim
trigger1 = var(3) = 16
value = 2005

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 16
anim = 2051
id = 0
sprpriority = 1
removetime = 300
scale = const(size.xscale), const(size.yscale)
bindtime = -1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 16
anim = 2052
id = 0
sprpriority = 3
removetime = 300
scale = const(size.xscale), const(size.yscale)
bindtime = -1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) = 16
anim = 2053
id = 0
sprpriority = 3
removetime = 300
scale = const(size.xscale), const(size.yscale)
bindtime = -1
ownpal = 1
persistent = 0

[State 2005, Explod]
type = Explod
trigger1 = var(3) > 17
trigger1 = (var(3)-18)%10 = 0
anim = 2055
id = 2055
sprpriority = 4
scale = const(size.xscale), const(size.yscale)
bindtime = -1
ownpal = 1

[State 2005, ModifyExplod]
type = ModifyExplod
trigger1 = animelemno(-1) = 5
id = 0
sprpriority = 3

[State 2005, ModifyExplod]
type = ModifyExplod
trigger1 = animelem = 5
id = 0
sprpriority = -1

[State 2005, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 2005, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 2005, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 20
y = fvar(3)

[State 2005, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 20]
x = pos x*(1 - var(3)*0.05) + fvar(2)*var(3)*0.05
y = pos y*(1 - var(3)*0.05) + fvar(3)*var(3)*0.05

[State 2005, PosAdd]
type = PosAdd
trigger1 = var(3) > 10
y = -cos(var(3)*pi/1.5)*2.0

[State 2005, Projectile]
type = Projectile
trigger1 = var(3) > 18
trigger1 = var(3)%2 = 0
projid = 1050
projanim = 2054
projremovetime = 1
projmisstime = 1
projpriority = 9999
id = 1050
attr = A, HP
animtype  = Heavy
damage    = 10000
givepower = 0,0
getpower = 0,0
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Low
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 2
p2stateno = 5400

[State 2005, Projectile]
type = Projectile
trigger1 = var(3) > 18
trigger1 = var(3)%2
projid = 1050
projanim = 2054
projremovetime = 1
projmisstime = 1
projpriority = 9999
id = 1050
attr = A, HT
animtype  = Heavy
damage    = 10000
givepower = 0,0
getpower = 0,0
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Low
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 2
p2stateno = 5400

[Statedef 2006]
ctrl = 0
sprpriority = -2

[State 2006, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = 1;806

[State 2006, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2005
value = root, stateno + 1

[State 2006, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
x = root, pos x - 125*facing + root, vel x*root, facing
y = -280 - root, var(3)*0.18

[State 2006, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + (root, fvar(2) - 125*facing)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - (280 + root, var(3)*0.18)*root, var(3)*0.05

[State 2006, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 2006, PosAdd]
type = PosAdd
trigger1 = 1
y = -cos(root, var(3)*pi/1.5)*2.0

[Statedef 2008]
ctrl = 0
anim = 3
sprpriority = -5

[State 2008, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2005
value = root, stateno + 3

[State 2008, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 20
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing + root, vel x*root, facing
y = -170 - root, var(3)*0.1

[State 2008, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 20]
x = pos x*(1 - root, var(3)*0.05) + root, fvar(2)*root, var(3)*0.05 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.05) - (170 + root, var(3)*0.1)*root, var(3)*0.05

[State 2008, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[State 2008, PosAdd]
type = PosAdd
trigger1 = 1
y = -cos(root, var(3)*pi/1.5)*1.5

[State 2008, AllPalFx]
type = AllPalFX
trigger1 = time = 0
trigger2 = time = 2
trigger3 = time = 4
add = 256, 256, 256
time = 1

;---------------------------------------------------------------------------
; Breath (Side)
;
[Statedef 2100]
type = A
movetype = I
physics = N
anim = 0
sprpriority = -2
ctrl = 0

[State 2100, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2100, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 0
value = 600, 0
persistent = 0

[State 2100, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -120 - var(3)*10

[State 2100, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 2100, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 2100, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.4
x = 0

[State 2100, 5]
type = ChangeState
trigger1 = var(3) = 150
value = 2105

[State 2100, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 2100, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 40]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 2100, VarSet]
type = VarSet
trigger1 = !numhelper(3)
trigger1 = var(3) = [1, 40]
fvar(2) = pos x

[State 2100, PosSet]
type = PosSet
trigger1 = var(3) > 40
x = fvar(2)
y = fvar(3)

[State 2100, PosSet]
type = PosSet
trigger1 = var(3) = [1, 40]
x = pos x*(1 - var(3)*0.025) + fvar(2)*var(3)*0.025
y = pos y*(1 - var(3)*0.025) + fvar(3)*var(3)*0.025

[State 2100, Helper]
type = Helper
trigger1 = var(3) = 80
trigger1 = var(18)
name = "i"
id = 2250
stateno = 2250
postype = left
ownpal = 1

[Statedef 2101]
ctrl = 0
sprpriority = -2

[State 2101, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 2101, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 2101, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2100
value = root, stateno + 1

[State 2101, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 40
x = root, pos x - 105.5*facing + root, vel x*root, facing
y = -270.5 - root, var(3)*10

[State 2101, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.025) + (root, fvar(2) - 105.5*facing)*root, var(3)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.025) - (270.5 + root, var(3)*10)*root, var(3)*0.025

[State 2101, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[State 2101, VarSet]
type = VarSet
trigger1 = !time
var(0) = root, var(4)
persistent = 0

[Statedef 2103]
ctrl = 0
anim = 3
sprpriority = -5

[State 2103, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2100
value = root, stateno + 3

[State 2103, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*10

[State 2103, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
x = pos x*(1 - root, var(3)*0.005) + root, fvar(2)*root, var(3)*0.005 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.005) - (180 + root, var(3)*10)*root, var(3)*0.005

[State 2103, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 2105]
type = A
movetype = I
physics = N
anim = 2105
sprpriority = 1
velset = 0, 0
ctrl = 0

[State 2105, VarSet]
type = VarSet
trigger1 = !time
var(0) = ifelse(command = "holdback", -facing, ifelse(command = "holdfwd", facing, ifelse(random%2, -1, 1)))

[State 2105, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2105, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 2000, 0
channel = 1
persistent = 0

[State 2105, Helper]
type = Helper
trigger1 = time < 130
trigger1 = !numhelper(6200)
name = "p1"
id = 6200
stateno = 6200
facing = facing
ownpal = 1
size.xscale = 1
size.yscale = 1
size.height = 999

[State 2105, Helper]
type = Helper
trigger1 = time < 130
trigger1 = !numhelper(6201)
trigger1 = numenemy > 1
name = "p2"
id = 6201
stateno = 6201
facing = facing
ownpal = 1
size.xscale = 1
size.yscale = 1
size.height = 999

[State 2105, VarSet]
type = VarSet
trigger1 = time = 130
var(1) = 1

[State 2105, Turn]
type = Turn
trigger1 = !time
trigger1 = var(0) = facing
trigger1 = var(4) := -facing
persistent = 0

[State 2105, PosSet]
type = PosSet
trigger1 = !time
trigger1 = numhelper(6001)
x = helper(6001), pos x

[State 2105, PosSet]
type = PosSet
trigger1 = !time
trigger1 = !numhelper(6001)
x = 0

[State 2105, VelSet]
type = VelSet
trigger1 = !time
x = -9

[State 2105, VelSet]
type = VelSet
trigger1 = time = 120
x = 0

[State 2105, PosSet]
type = PosSet
trigger1 = time = 120
trigger1 = numhelper(6000)
x = helper(6000), pos x + ifelse(var(0) < 0, -426, 426)
y = 0
persistent = 0

[State 2105, VelSet]
type = VelSet
trigger1 = time = 140
x = 6

[State 2105, VelAdd]
type = VelAdd
trigger1 = time = (150, 170)
trigger1 = vel x
x = -0.3

[State 2105, ChangeAnim]
type = ChangeAnim
trigger1 = time < 155
value = 2105

[State 2105, VelSet]
type = VelSet
trigger1 = time = 170
x = 0

[State 2105, PlaySnd]
type = PlaySnd
trigger1 = time = 180
value = 2000, 1
channel = 2
persistent = 0

[State 2105, PosSet]
type = PosSet
trigger1 = time = 180
trigger1 = numhelper(6000)
x = helper(6000), pos x + ifelse(var(0) < 0, -304, 303)
y = 0
persistent = 0

[State 2105, Explod]
type = Explod
trigger1 = time%8 = 4
trigger1 = time < 121
anim = 6500
id = 6500
sprpriority = -2
postype = left
facing = facing
pos = 160 + 10*facing, 190
random = 320, 0
vel = -0.9*facing, -0.3
accel = -0.3*facing, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2105, Explod]
type = Explod
trigger1 = time%8 = 0
trigger1 = time < 121
anim = 6500
id = 6500
sprpriority = -1
postype = left
facing = facing
pos = 160 + 10*facing, 200
random = 320, 0
vel = -0.9*facing, -0.3
accel = -0.3*facing, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2105, Explod]
type = Explod
trigger1 = time%8 = 2
trigger1 = time < 121
anim = 6500
id = 6500
sprpriority = 2
postype = left
facing = facing
pos = 160 + 10*facing, 220
random = 320, 0
vel = -0.9*facing, -0.3
accel = -0.3*facing, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2105, Explod]
type = Explod
trigger1 = time%8 = 6
trigger1 = time < 121
anim = 6500
id = 6500
sprpriority = 3
postype = left
facing = facing
pos = 160 + 10*facing, 230
random = 320, 0
vel = -0.9*facing, -0.3
accel = -0.3*facing, -0.1
bindtime = 1
ownpal = 1
scale = const(size.xscale), const(size.yscale)

[State 2105, 5]
type = ChangeState
trigger1 = time = 190
value = 2110

[Statedef 2106]
ctrl = 0
type = A
physics = N
movetype = I
anim = 9999
sprpriority = -2

[State 2106, Turn]
type = Turn
trigger1 = var(0) != root, var(4)
persistent = 0

[State 2106, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2105
value = root, stateno + 1

[Statedef 2108]
ctrl = 0
type = A
physics = N
movetype = I
anim = 9999
sprpriority = -2

[State 2108, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2105
value = root, stateno + 3

[Statedef 2110]
type = A
movetype = I
physics = N
velset = 0, 0
ctrl = 0

[State 2110, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2110, 5]
type = ChangeState
trigger1 = time = 240
value = 2115

[State 2110, PosAdd]
type = PosAdd
trigger1 = 1
y = -sin(time*pi/30.0)*2

[State 2110, SprPriority]
type = SprPriority
trigger1 = 1
value = ifelse(pos y < -28, -2, 1)

[Statedef 2111]
ctrl = 0
type = A
physics = N
movetype = I
anim = 9999
sprpriority = -2

[State 2111, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2110
value = root, stateno + 1

[Statedef 2113]
ctrl = 0
type = A
physics = N
movetype = I
anim = 2150
sprpriority = 2

[State 2113, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2110
value = root, stateno + 3

[State 2113, BindToParent]
type = BindToParent
trigger1 = 1

[State 2113, Turn]
type = Turn
trigger1 = facing != root, facing

[State 2113, SprPriority]
type = SprPriority
trigger1 = 1
value = ifelse(root, pos y < -28, -1, 2)

[State 2113, Projectile]
type = Projectile
trigger1 = time > 4
trigger1 = time%2 = 0
projid = 1050
projanim = 2152
projremovetime = 1
projmisstime = 1
projpriority = 9999
projedgebound = 9999
projstagebound = 9999
projheightbound = -480, 240
id = 1050
attr = S, HP
animtype  = Heavy
damage    = 10000
givepower = 0,0
getpower = 0,0
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -4, -4
air.type = Low
air.velocity = -4, -2.5
fall = 1
fall.recover = 0
fall.recovertime = 2
p2stateno = 5400

[State 2113, Projectile]
type = Projectile
trigger1 = time > 4
trigger1 = time%2
projid = 1050
projanim = 2152
projremovetime = 1
projmisstime = 1
projpriority = 9999
projedgebound = 9999
projstagebound = 9999
projheightbound = -480, 240
id = 1050
attr = S, HT
animtype  = Heavy
damage    = 10000
givepower = 0,0
getpower = 0,0
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -5, -5
air.type = Low
air.velocity = -5, -2.5
fall = 1
fall.recover = 0
fall.recovertime = 2
p2stateno = 5400

[Statedef 2115]
type = A
movetype = I
physics = N
velset = 0, 0
ctrl = 0
anim = 2115

[State 2115, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2115, SprPriority]
type = SprPriority
trigger1 = 1
value = ifelse(pos y < -28, -2, 1)

[State 2115, VelAdd]
type = VelAdd
trigger1 = time = (60, 80)
x = -0.3

[State 2115, ChangeState]
type = ChangeState
trigger1 = time = 150
trigger1 = var(3) := 0 || 1
value = 2120

[Statedef 2116]
ctrl = 0
type = A
physics = N
movetype = I
anim = 9999
sprpriority = -2

[State 2116, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2115
value = root, stateno + 1

[Statedef 2118]
ctrl = 0
type = A
physics = N
movetype = I
anim = 2151
sprpriority = 2

[State 2118, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2115
value = root, stateno + 3

[State 2118, BindToParent]
type = BindToParent
trigger1 = 1

[State 2118, Turn]
type = Turn
trigger1 = facing != root, facing

[State 2118, SprPriority]
type = SprPriority
trigger1 = 1
value = ifelse(root, pos y < -28, -1, 2)

[Statedef 2120]
type = A
movetype = I
physics = N
anim = 605
sprpriority = -2
velset = 0, 0
ctrl = 0

[State 2120, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2120, PosSet]
type = PosSet
trigger1 = !time
trigger1 = prevstateno = 2115
trigger1 = numhelper(6001)
x = helper(6001), pos x
y = -435

[State 2120, PosSet]
type = PosSet
trigger1 = !time
trigger1 = prevstateno = 2115
trigger1 = !numhelper(6001)
x = 0
y = -435

[State 2120, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -40

[State 2120, 5]
type = ChangeState
trigger1 = var(3) = 60
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 120
value = 0

[State 2120, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 2120, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 2120, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 400
y = fvar(3)

[State 2120, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
x = pos x*(1 - var(3)*0.0025) + fvar(2)*var(3)*0.0025
y = pos y*(1 - var(3)*0.0025) + fvar(3)*var(3)*0.0025

[Statedef 2121]
ctrl = 0
anim = 1
sprpriority = -2

[State 2121, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2120
value = root, stateno + 1

[State 2121, PosSet]
type = PosSet
trigger1 = !time
x = root, pos x - 105.5*facing + root, vel x*root, facing
y = -795.5

[State 2121, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 400
x = root, pos x - 120*facing
y = -240

[State 2121, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + (root, fvar(2) - 120*facing)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 240*root, var(3)*0.0025

[State 2121, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 2123]
ctrl = 0
anim = 3
sprpriority = -5

[State 2123, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2120
value = root, stateno + 3

[State 2123, PosSet]
type = PosSet
trigger1 = !time
x = root, pos x + root, vel x*root, facing
y = -885

[State 2123, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
x = root, pos x + root, vel x*root, facing
y = -170

[State 2123, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + root, fvar(2)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 170*root, var(3)*0.0025

[State 2123, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;---------------------------------------------------------------------------
; Breath (Fullscreen)
;
[Statedef 2200]
type = A
movetype = I
physics = N
anim = 0
sprpriority = -2
ctrl = 0

[State 2200, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2200, PlaySnd]
type = PlaySnd
trigger1 = var(3) = 0
value = 600, 0
persistent = 0

[State 2200, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -120 - var(3)*10

[State 2200, VelAdd]
type = VelAdd
trigger1 = vel x < 0
x = 0.2

[State 2200, VelAdd]
type = VelAdd
trigger1 = vel x > 0
x = -0.2

[State 2200, VelSet]
type = VelSet
trigger1 = abs(vel x) < 0.4
x = 0

[State 2200, 5]
type = ChangeState
trigger1 = var(3) = 180
value = 2205

[State 2200, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 2200, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 40]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 2200, VarSet]
type = VarSet
trigger1 = !numhelper(3)
trigger1 = var(3) = [1, 40]
fvar(2) = pos x

[State 2200, PosSet]
type = PosSet
trigger1 = var(3) > 40
x = fvar(2)
y = fvar(3)

[State 2200, PosSet]
type = PosSet
trigger1 = var(3) = [1, 40]
x = pos x*(1 - var(3)*0.025) + fvar(2)*var(3)*0.025
y = pos y*(1 - var(3)*0.025) + fvar(3)*var(3)*0.025

[State 2200, Helper]
type = Helper
trigger1 = var(3) = 80
trigger1 = var(18)
name = "i"
id = 2250
stateno = 2250
postype = left
ownpal = 1

[Statedef 2201]
ctrl = 0
sprpriority = -2

[State 2201, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 2201, ChangeAnim]
type = ChangeAnim
trigger1 = !time
value = 1

[State 2201, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2200
value = root, stateno + 1

[State 2201, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 40
x = root, pos x - 105.5*facing + root, vel x*root, facing
y = -270.5 - root, var(3)*10

[State 2201, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 40]
x = pos x*(1 - root, var(3)*0.025) + (root, fvar(2) - 105.5*facing)*root, var(3)*0.025 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.025) - (270.5 + root, var(3)*10)*root, var(3)*0.025

[State 2201, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 2203]
ctrl = 0
anim = 3
sprpriority = -5

[State 2203, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2200
value = root, stateno + 3

[State 2203, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
trigger2 = !time
trigger2 = !prevstateno
x = root, pos x + root, vel x*root, facing
y = -180 - root, var(3)*10

[State 2203, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 200]
x = pos x*(1 - root, var(3)*0.005) + root, fvar(2)*root, var(3)*0.005 + root, vel x*root, facing
y = pos y*(1 - root, var(3)*0.005) - (180 + root, var(3)*10)*root, var(3)*0.005

[State 2203, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

[Statedef 2205]
type = A
movetype = I
physics = N
velset = 0, 0
ctrl = 0
anim = 9999

[State 2205, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2205, PosSet]
type = PosSet
trigger1 = numhelper(6001)
x = helper(6001), pos x
y = -100

[State 2205, Explod]
type = Explod
trigger1 = !time
anim = 2205
id = 0
sprpriority = -5
scale = const(size.xscale), const(size.yscale)
postype = left
pos = 160, 110
bindtime = -1
ownpal = 1
persistent = 0

[State 2205, PlaySnd]
type = PlaySnd
trigger1 = time = 88
value = 2000, 1
channel = 2
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 96
anim = 2250
id = 1
sprpriority = -4
scale = const(size.xscale), const(size.yscale)
postype = left
bindtime = -1
ownpal = 1
persistent = 0

[State 2205, ModifyExplod]
type = ModifyExplod
trigger1 = time = 120
id = 1
sprpriority = -1

[State 2205, ModifyExplod]
type = ModifyExplod
trigger1 = time = 135
id = 1
sprpriority = 5
ontop = 1

[State 2205, RemoveExplod]
type = RemoveExplod
trigger1 = time = 375
id = 0

[State 2205, RemoveExplod]
type = RemoveExplod
trigger1 = time = 375
id = 1

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2206
id = 0
sprpriority = -5
scale = const(size.xscale), const(size.yscale)
postype = left
pos = 160, 110
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 180
random = 320, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 180
random = 320, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 190
random = 360, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 190
random = 360, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 190
random = 360, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 520, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 180
random = 320, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 180
random = 320, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 190
random = 360, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 190
random = 360, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -2
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 190
random = 360, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = -1
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 200
random = 400, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 520, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Explod]
type = Explod
trigger1 = time = 375
anim = 2260
id = 2260
sprpriority = 3
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(helper(6000), screenpos x), 220
random = 440, 0
removetime = 120 + random%50
bindtime = 1
ownpal = 1
persistent = 0

[State 2205, Projectile]
type = Projectile
trigger1 = time = [180, 374]
trigger1 = time%2 = 0
projid = 1050
projanim = 2252
projremovetime = 1
projmisstime = 1
projpriority = 9999
postype = left
projedgebound = 9999
projstagebound = 9999
projheightbound = -480, 240
offset = helper(6000), screenpos x*facing, 0
id = 1050
attr = S, HT
animtype  = Heavy
damage    = 10000
givepower = 0,0
getpower = 0,0
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Low
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 2
p2stateno = 5400

[State 2205, Projectile]
type = Projectile
trigger1 = time = [180, 374]
trigger1 = time%2
projid = 1050
projanim = 2252
projremovetime = 1
projmisstime = 1
projpriority = 9999
projedgebound = 9999
projstagebound = 9999
projheightbound = -480, 240
postype = left
offset = helper(6000), screenpos x*facing, 0
id = 1050
attr = S, HP
animtype  = Heavy
damage    = 10000
givepower = 0,0
getpower = 0,0
priority  = 5
numhits = 0
hitflag = MA
guardflag = 
pausetime = 0,0
sparkno = -1
hitsound   = -1
ground.type = Low
ground.slidetime = 16
ground.hittime  = 16
ground.velocity = -2.5, -7.5
air.type = Low
air.velocity = -2.5, -5
fall = 1
fall.recover = 0
fall.recovertime = 2
p2stateno = 5400

;[State 2205, NoKoSlow]
;type = AssertSpecial
;trigger1 = time = [180, 375]
;flag = NoKoSlow

[State 2205, ChangeState]
type = ChangeState
trigger1 = time = 600
trigger1 = var(3) := 0 || 1
value = 2210

[Statedef 2206]
ctrl = 0
type = A
physics = N
movetype = I
anim = 9999
sprpriority = -2

[State 2206, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2205
value = root, stateno + 1

[Statedef 2208]
ctrl = 0
type = A
physics = N
movetype = I
anim = 9999
sprpriority = 2

[State 2208, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2205
value = root, stateno + 3

[Statedef 2210]
type = A
movetype = I
physics = N
anim = 605
sprpriority = -2
velset = 0, 0
ctrl = 0

[State 2210, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 2210, PosSet]
type = PosSet
trigger1 = !time
trigger1 = prevstateno = 2205
trigger1 = numhelper(6001)
x = helper(6001), pos x
y = -435

[State 2210, PosSet]
type = PosSet
trigger1 = !time
trigger1 = prevstateno = 2205
trigger1 = !numhelper(6001)
x = 0
y = -435

[State 2210, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -40

[State 2210, 5]
type = ChangeState
trigger1 = var(3) = 60
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 120
value = 0

[State 2210, VarAdd]
type = VarAdd
trigger1 = 1
var(3) = 1

[State 2210, VarSet]
type = VarSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
fvar(2) = pos x*0.3 + helper(3), pos x*0.7

[State 2210, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) > 400
y = fvar(3)

[State 2210, PosSet]
type = PosSet
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 400]
x = pos x*(1 - var(3)*0.0025) + fvar(2)*var(3)*0.0025
y = pos y*(1 - var(3)*0.0025) + fvar(3)*var(3)*0.0025

[Statedef 2211]
ctrl = 0
anim = 1
sprpriority = -2

[State 2211, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2210
value = root, stateno + 1

[State 2211, PosSet]
type = PosSet
trigger1 = !time
x = root, pos x - 105.5*facing + root, vel x*root, facing
y = -795.5

[State 2211, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 400
x = root, pos x - 120*facing
y = -240

[State 2211, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + (root, fvar(2) - 120*facing)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 240*root, var(3)*0.0025

[State 2211, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 2213]
ctrl = 0
anim = 3
sprpriority = -5

[State 2213, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 2210
value = root, stateno + 3

[State 2213, PosSet]
type = PosSet
trigger1 = !time
x = root, pos x + root, vel x*root, facing
y = -885

[State 2213, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 200
x = root, pos x + root, vel x*root, facing
y = -170

[State 2213, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 400]
x = pos x*(1 - root, var(3)*0.0025) + root, fvar(2)*root, var(3)*0.0025
y = pos y*(1 - root, var(3)*0.0025) - 170*root, var(3)*0.0025

[State 2213, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
y = -screenpos y + 105

;---------------------------------------------------------------------------
; Rock Dispenser
;
[Statedef 2250]
ctrl = 0
anim = 9999

[State 2250, EnvShake]
type = EnvShake
trigger1 = !time
time = 15
freq = 50
ampl = 5
phase = 90

[State 2250, PlaySnd]
type = PlaySnd
trigger1 = !time
value = 5150, 0
abspan = 0

[State 2250, PosSet]
type = PosSet
trigger1 = !time
x = helper(6000), pos x
y = -260

[State 2250, Turn]
type = Turn
trigger1 = !time
trigger1 = random%2

[State 2250, Helper]
type = Helper
triggerall = time = [10, ifelse(root, stateno < 2200, 180, 195)]
trigger1 = time%30 = 10
name = "o"
id = 2270
stateno = 2270
facing = ifelse(random%2, -1, 1)
pos = 240 + random%50, -(random%100)

[State 2250, Helper]
type = Helper
triggerall = time = [10, ifelse(root, stateno < 2200, 180, 195)]
trigger1 = time%30 = 20
name = "o"
id = 2270
stateno = 2270
facing = ifelse(random%2, -1, 1)
pos = -240 + random%50, -(random%100)

[State 2250, Helper]
type = Helper
triggerall = time = [10, ifelse(root, stateno < 2200, 180, 195)]
trigger1 = time%60 = 25
name = "o"
id = 2270
stateno = 2270
postype = left
facing = ifelse(random%2, -1, 1)
pos = 5 + floor(random*0.31), -280 - (random%50)

[State 2250, Helper]
type = Helper
triggerall = time = [10, ifelse(root, stateno < 2200, 180, 195)]
trigger1 = time%60 = 30
trigger1 = numenemy
name = "o"
id = 2270
stateno = 2270
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(enemy(0), screenpos x + random%50 - 25), -280 - (random%50)

[State 2250, Helper]
type = Helper
triggerall = time = [10, ifelse(root, stateno < 2200, 180, 195)]
trigger1 = time%60 = 0
trigger1 = numenemy > 1
name = "o"
id = 2270
stateno = 2270
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(enemy(1), screenpos x + random%50 - 25), -280 - (random%50)

[State 2250, Helper]
type = Helper
triggerall = time = [10, ifelse(root, stateno < 2200, 180, 195)]
trigger1 = time%60 = 0
trigger1 = numenemy = 1
name = "o"
id = 2270
stateno = 2270
postype = left
facing = ifelse(random%2, -1, 1)
pos = floor(enemy(0), screenpos x + ifelse(random%2, -1, 1)*(100 + random%50)), -280 - (random%50)
pos = 5 + floor(random*0.31), -280 - (random%50)

[State 2250, PlaySnd]
type = PlaySnd
trigger1 = var(10)
value = 2270, 0
abspan = var(11)
channel = ifelse((var(11) = [-160, 160]), 0, 1)
volume = ifelse((var(11) = [-160, 160]), 0, -50)

[State 2250, VarSet]
type = VarSet
trigger1 = var(10)
var(10) = 0

[State 2250, DestroySelf]
type = DestroySelf
trigger1 = time = 360

;---------------------------------------------------------------------------
; Boulder
;
[Statedef 2270]
ctrl = 0
type = A
physics = N
movetype = A
anim = 2270
sprpriority = 3

[State 2270, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = ifelse(random%2, 1, -1)*random*0.02 - 8

[State 2270, VarSet]
type = VarSet
trigger1 = !time
var(0) = ifelse(fvar(0) < -8, ifelse(fvar(0) < -18, -2, -1), ifelse(fvar(0) < 2, 2, 3))

[State 2270, SprPriority]
type = SprPriority
trigger1 = !time
value = var(0)

[State 2270, VelSet]
type = VelSet
trigger1 = !time
y = 8

[State 2270, ChangeState]
type = ChangeState
trigger1 = pos y + vel y >= fvar(0)
trigger2 = movecontact
trigger3 = movereversed
value = 2275

[State 2270, HitDef]
type = HitDef
trigger1 = !time
id = 1050
attr = A, SP
animtype  = Back
damage    = 100, ifelse(parent, ishelper, 15, 30)
priority  = 5
numhits = 0
hitflag = MA
guardflag = MA
pausetime = 0,16
sparkno = 2
sparkxy = -10, 0
hitsound   = -1
ground.type = Trip
ground.slidetime = 9
ground.hittime  = 9
ground.velocity = 0, 5
ground.cornerpush.veloff = 0
guard.dist = 0
guard.kill = 0
air.type = Trip
air.velocity = 0, 5
airguard.velocity = 0, 0
fall = 1
fall.recover = 0
sprpriority = var(0)

[Statedef 2275]
ctrl = 0
type = A
physics = N
movetype = A
anim = 9999
velset = 0, 0

[State 2275, PosAdd]
type = PosAdd
trigger1 = !time
y = 8

[State 2275, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(10) = 2

[State 2275, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(11) = floor(pos x)

[State 2275, EnvShake]
type = EnvShake
trigger1 = !time
time = 10
freq = 50
ampl = 3
phase = 270
persistent = 0

[State 2275, Explod]
type = Explod
trigger1 = !time
anim = 2275
id = 2275
bindtime = 1
accel = 0, 0.35
vel = 2.5, -3.5 - random*0.001
removetime = 25
sprpriority = var(0)
scale = const(size.xscale), const(size.yscale)

[State 2275, Explod]
type = Explod
trigger1 = !time
anim = 2275
id = 2275
bindtime = 1
accel = 0, 0.35
facing = -1
vel = -2.5, -3.5 - random*0.001
removetime = 25
sprpriority = var(0)
scale = const(size.xscale), const(size.yscale)

[State 2275, DestroySelf]
type = DestroySelf
trigger1 = time


;---------------------------------------------------------------------------
; Skeleton
; vars:
;	0 = life
;	1 = attack timer
;	2 = idle time
;	3 = attack select
;	4 = unsummon flag
;	5 = attack timer offset
; fvars:
;	0 = temp

[Statedef 4000]
ctrl = 0
type = S
physics = S
anim = 10000
movetype = I
sprpriority = 0

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, Time Over]
type = ChangeState
trigger1 = var(4)
trigger2 = !root, alive
value = 4017

[State 4000, VelSet]
type = VelSet
trigger1 = abs(vel x) < 2
trigger2 = time > 3
x = 0

[State 4000, VarSet]
type = VarSet
trigger1 = !time
trigger2 = !animtime
trigger2 = abs(p2dist x) < 240
var(2) = random%50

[State 4000, VarAdd]
type = VarAdd
trigger1 = var(2) > -1
var(2) = -1

[State 4000, VarSet]
type = VarSet
trigger1 = !time
var(3) = random%3

[State 4000, ChangeAnim]
type = ChangeAnim
trigger1 = !animtime
value = 10000

[State Skel, Time Over]
type = ChangeState
triggerall = roundstate > 2
trigger1 = anim = 10000
value = 4017

[State 4000, ChangeState]
type = ChangeState
triggerall = p2dist x < 0
trigger1 = anim = 10000
trigger2 = animelemno(0) > 7
value = 4005

[State 4000, ChangeAnim]
type = ChangeAnim
triggerall = anim = 10000
trigger1 = var(2) < 0
trigger1 = p2bodydist x > (48 + 80*(var(3) = 2))*const(size.xscale)
trigger2 = rootdist x > 0
trigger2 = p2dist x < rootdist x
trigger3 = var(1) < 120 || p2statetype = L
trigger3 = p2dist x < 0
trigger3 = random%50 = 0
trigger4 = var(1) > 180
trigger4 = p2bodydist x > 32*const(size.xscale)
trigger4 = random%25 = 0
value = 10020

[State 4000, ChangeAnim]
type = ChangeAnim
triggerall = anim = 10000
trigger1 = var(2) < 0
trigger1 = p2bodydist x < 0
trigger1 = p2dist x > rootdist x
trigger2 = rootdist x < 0
trigger2 = p2dist x < 0
trigger3 = var(1) < 120 || p2statetype = L
trigger3 = p2dist x > 0
trigger3 = random%50 = 0
value = 10021

[State 4000, VelSet]
type = VelSet
triggerall = anim = [10020, 10021]
trigger1 = animelemno(0) = [1, 3]
trigger2 = animelemno(0) = [5, 7]
x = ifelse(anim = 10020, 1.25*const(size.xscale), -1.25*const(size.xscale))

[State 4000, VarAdd]
type = VarAdd
trigger1 = anim = 10000
trigger2 = gametime%2
var(1) = 1

[State 4000, VarSet]
type = VarSet
triggerall = var(1) > 180
trigger1 = p2movetype = H
trigger2 = p2statetype = L
var(1) = 170

[State 4000, ChangeState]
type = ChangeState
triggerall = var(1) > 180
triggerall = var(3) < 2
triggerall = p2bodydist x = [0, 48*const(size.xscale)]
triggerall = p2dist x > 0
triggerall = var(2) < 0
trigger1 = p2dist x >= rootdist x
value = 4020

[State 4000, ChangeState]
type = ChangeState
triggerall = var(1) > 180
triggerall = var(3) = 2
triggerall = p2bodydist x = [-4*const(size.xscale), 160]
triggerall = p2dist x > 0
triggerall = var(2) < 0
trigger1 = p2dist x >= rootdist x
value = 4040

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[Statedef 4005]
ctrl = 0
type = S
physics = S
anim = 10005
movetype = I
sprpriority = 0
velset = 0, 0

[State 4005, PosAdd]
type = PosAdd
trigger1 = animelem = 2
trigger2 = animelem = 3
x = 4*const(size.xscale)

[State 4005, PosAdd]
type = PosAdd
trigger1 = !animtime
x = -4*const(size.xscale)

[State 4005, Turn]
type = Turn
trigger1 = animelem = 3

[State 4005, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 4000

[State 4005, VarAdd]
type = VarAdd
trigger1 = 1
var(1) = 1

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[Statedef 4017]
ctrl = 0
type = S
physics = S
movetype = I
anim = 10180
sprpriority = 0
velset = 0, 0

[State 4017, ChangeAnim]
type = ChangeAnim
triggerall = !time
trigger1 = var(0) > root, var(22)
trigger2 = !root, alive
value = 10170

[State 4017, DestroySelf]
type = DestroySelf
trigger1 = time = 108
trigger2 = anim = 10180
trigger2 = !animtime

[State 4017, ParentVarSet]
type = ParentVarSet
trigger1 = !time
trigger1 = anim = 10170
var(23) = 2

[State 4017, ParentVarSet]
type = ParentVarSet
trigger1 = !time
trigger1 = anim = 10170
var(24) = ifelse(parent, var(23) = 2, floor((parent, var(24) + pos x)/2), floor(pos x))

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[Statedef 4019]
ctrl = 0
type = S
physics = S
anim = 9999
movetype = I
sprpriority = 0

[State 4019, VarSet]
type = VarSet
trigger1 = !time
trigger1 = !prevstateno
var(1) = random%40

[State 4019, VarSet]
type = VarSet
trigger1 = !time
trigger1 = !prevstateno
var(5) = parent, var(0)*180/root, var(21)

[State 4019, ParentVarAdd]
type = ParentVarAdd
trigger1 = !time
trigger1 = !prevstateno
var(0) = 1

[State 4019, ChangeAnim]
type = ChangeAnim
trigger1 = anim = 9999
trigger1 = time > var(1)
value = 10190

[State 4019, ParentVarSet]
type = ParentVarSet
trigger1 = anim = 10190
trigger1 = parent, var(23) < 2
var(23) = 1
persistent = 0

[State 4019, ParentVarSet]
type = ParentVarSet
trigger1 = anim = 10190
trigger1 = parent, var(23) < 2
var(24) = ifelse(parent, var(23) = 1, floor((parent, var(24) + pos x)/2), floor(pos x))
persistent = 0

[State 4019, VarSet]
type = VarSet
trigger1 = time > var(1)
var(1) = var(5)
persistent = 0

[State 4019, ChangeState]
type = ChangeState
trigger1 = anim = 10190
trigger1 = !animtime
value = 4000

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
triggerall = time
trigger1 = numhelper(1155)
trigger1 = helper(1155), anim = 1155
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[Statedef 4020]
ctrl = 0
type = S
physics = S
anim = ifelse(random%2, 10200, 10220)
movetype = A
sprpriority = 2
velset = 0, 0

[State 4020, VarSet]
type = VarSet
trigger1 = animelem = 4
var(1) = ifelse(anim < 10220, 0, 60)

[State 4020, ChangeAnim]
type = ChangeAnim
triggerall = !animtime
triggerall = anim < 10210
triggerall = p2bodydist x = [0, 48*const(size.xscale)]
trigger1 = p2dist x >= rootdist x
trigger1 = p2statetype != L
trigger1 = p2movetype != H || !enemynear, gethitvar(fall)
value = anim + 10

[State 4020, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 4000

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State 4020, 1]
type = HitDef
trigger1 = anim = 10200
attr = S, NA
damage = 40, 0
numhits = 0
animtype = Medium
guardflag = MA
hitflag = MA
pausetime = 9, 9
sparkno = 1
sparkxy = -5, floor(-40*const(size.yscale))
hitsound   = s4020,1
guardsound = 6,0
ground.type = High
ground.velocity = -5
ground.hittime  = 16
ground.slidetime  = 16
guard.hittime = 15
guard.kill = 0
air.hittime = 999
airguard.ctrltime = 999
air.type = Low
air.velocity = -3, -5
persistent = 0

[State 4020, 2]
type = HitDef
trigger1 = anim = 10210
attr = S, NA
damage = 35, 0
numhits = 0
animtype = Medium
guardflag = MA
hitflag = MA
pausetime = 9, 9
sparkno = 1
sparkxy = -5, floor(-32*const(size.yscale))
hitsound   = s4020,1
guardsound = 6,0
ground.type = Low
ground.velocity = -5
ground.hittime  = 16
ground.slidetime  = 16
guard.hittime = 15
guard.kill = 0
air.hittime = 999
airguard.ctrltime = 999
air.type = Low
air.velocity = -3, -5
persistent = 0

[State 4240, 3]
type = HitDef
trigger1 = anim = 10220
attr = S, NA
damage = 45, 0
numhits = 0
animtype = Medium
guardflag = MA
hitflag = MA
pausetime = 9, 9
sparkno = 1
sparkxy = -5, floor(-38*const(size.yscale))
hitsound   = s4020,1
guardsound = 6,0
ground.type = Low
ground.velocity = -5
ground.hittime  = 16
ground.slidetime  = 16
guard.hittime = 15
guard.kill = 0
air.hittime = 999
airguard.ctrltime = 999
air.type = Low
air.velocity = -3, -5
persistent = 0

[Statedef 4040]
ctrl = 0
type = S
physics = S
anim = 10040
movetype = I
sprpriority = 0
velset = 0, 0

[State 4040, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[State 4040, VarSet]
type = VarSet
trigger1 = !time
fvar(0) = (p2bodydist x + 8*const(size.xscale))/35.0

[State 4040, VarSet]
type = VarSet
trigger1 = !time
trigger1 = fvar(0) < 0.1
fvar(0) = 0.1

[State 4040, VarSet]
type = VarSet
trigger1 = !time
trigger1 = fvar(0) > 5
fvar(0) = 5

[State 4040, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 4041

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[Statedef 4041]
ctrl = 0
type = A
physics = N
anim = 10041
movetype = I
sprpriority = 0
velset = fvar(0), -10

[State 4041, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[State 4041, Gravity]
type = Gravity
trigger1 = 1

[State 4041, ChangeAnim]
type = ChangeAnim
trigger1 = vel y > 0
trigger2 = animelemno(0) > 1
trigger2 = p2bodydist x < 96*const(size.xscale)
value = 10600
persistent = 0

[State 4041, StateTypeSet]
type = StateTypeSet
trigger1 = anim = 10600
movetype = A
persistent = 0

[State 4041, SprPriority]
type = SprPriority
trigger1 = anim = 10600
value = 2
persistent = 0

[State 4041, 1]
type = HitDef
trigger1 = anim = 10600
attr = A, NA
damage = 45, 0
numhits = 0
animtype = Medium
guardflag = HA
hitflag = MA
pausetime = 9, 9
sparkno = 1
sparkxy = -5, floor(-16*const(size.yscale))
hitsound   = s4020,1
guardsound = 6,0
ground.type = High
ground.velocity = -5
ground.hittime  = 16
ground.slidetime  = 16
guard.hittime = 15
guard.kill = 0
air.hittime = 999
airguard.ctrltime = 999
air.type = Low
air.velocity = -3, -5
persistent = 0

[State 4041, ChangeState]
type = ChangeState
trigger1 = vel y > 0
trigger1 = vel y + pos y >= 0
value = 4042

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[Statedef 4042]
ctrl = 0
type = S
physics = S
anim = 10047
movetype = I
velset = 0, 0

[State 4042, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[State 4042, PosSet]
type = PosSet
trigger1 = !time
y = 0

[State 4042, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 4000

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[Statedef 4500]
ctrl = 0
type = U
physics = N
movetype = H
sprpriority = 0
velset = 0,0

[State 4500, ChangeAnim]
type = ChangeAnim
trigger1 = statetype = S || statetype = C
value = ifelse((gethitvar(groundtype) = [2, 3]), 15010, 15000)

[State 4500, ChangeAnim]
type = ChangeAnim
trigger1 = statetype = A
value = ifelse((gethitvar(airtype) = [2, 3]), 15010, 15000)

[State 4500, ChangeState]
type = ChangeState
trigger1 = hitshakeover
trigger1 = statetype = L
trigger1 = !gethitvar(yvel)
value = 4508

[State 4500, ChangeAnim]
type = ChangeAnim
trigger1 = statetype = L
value = 15030

[State 4500, ChangeState]
type = ChangeState
trigger1 = hitshakeover
value = ifelse(statetype != A && !gethitvar(yvel) && !gethitvar(fall), 4501, 4503)

[State 4500, VarAdd]
type = VarAdd
trigger1 = !time
var(0) = gethitvar(damage)

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4501]
ctrl = 0
type = S
physics = S
movetype = H
sprpriority = 0

[State 4501, HitVelSet]
type = HitVelSet
trigger1 = !time
x = 1
persistent = 0

[State 4501, VelMul]
type = VelMul
trigger1 = time >= gethitvar(slidetime)
x = .6

[State 4501, ChangeState]
type = ChangeState
trigger1 = hitover
value = 4502

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4502]
ctrl = 0
type = S
physics = S
movetype = H
sprpriority = 0
anim = anim + 5

[State 4502, ChangeState]
type = ChangeState
trigger1 = !animtime
value = ifelse(var(0) > root, var(22), 4017, 4000)

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4503]
ctrl = 0
type = A
physics = N
movetype = H
sprpriority = 0

[State 4503, ChangeAnim]
type = ChangeAnim
trigger1 = time = 6
trigger1 = anim = 15000
trigger2 = !time
trigger2 = anim = 15100
value = 15030

[State 4503, VelAdd]
type = VelAdd
trigger1 = 1
y = gethitvar(yaccel)

[State 4503, HitVelSet]
type = HitVelSet
trigger1 = !time
x = 1
y = 1

[State 4503, ChangeState]
type = ChangeState
trigger1 = vel Y > 0
trigger1 = vel y + pos Y >= 0
value = 4510

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4508]
type    = L
movetype= H
physics = C

[State 4508, 1]
type = HitVelSet
trigger1 = Time = 0
x = 1

[State 4508, 2]
type = VelSet
trigger1 = HitOver
x = 0

[State 4508, 3] ;Don't show hit ground frame
type = VarSet
trigger1 = Time = 0
sysvar(0) = 1

[State 4508, 4]
type = ChangeState
trigger1 = HitOver
value = 4512

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4510]
type    = L
movetype= H
physics = N
anim = 15100

[State 4510, 1]
type = VelSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
trigger1 = vel x > 1
x = 1

[State 4510, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 4510, Var] ;Save fall velocity
type = VarSet
trigger1 = Time = 0
sysvar(1) = floor(vel y)

[State 4510, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 4510, 5]
type = VelSet
trigger1 = Time = 0
y = 0

[State 4510, 6] ;Reduce speed
type = VelMul
trigger1 = Time = 0
x = 0.75

[State 4510, 7]
type = ChangeState
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) = 0
value = 4511

[State 4510, 8]
type = GameMakeAnim
trigger1 = Time = 1
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 4510, 9]
type = HitFallDamage
trigger1 = Time = 3

[State 4510, 10]
type = PlaySnd
trigger1 = Time = 1
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 4510, 11]
type = PosFreeze
trigger1 = 1

[State 4510, 12]
type = ChangeState
trigger1 = AnimTime = 0
value = 4511

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4511]
type    = L
movetype= H
physics = N
anim = 15030

[State 4511, 3]
type = HitFallVel
trigger1 = Time = 0

[State 4511, 4]
type = PosSet
trigger1 = Time = 0
y = 0

[State 4511, 5] ;Acceleration
type = VelAdd
trigger1 = 1
y = .4

[State 4511, 6] ;Hit ground
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
type = ChangeState
value = 4512

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4512]
type    = L
movetype= H
physics = N
anim = 15110

[State 4512, EnvShake]
type = FallEnvShake
trigger1 = Time = 0

[State 4512, 4]
type = HitFallDamage
trigger1 = Time = 0

[State 4512, 5]
type = PosSet
trigger1 = Time = 0
y = 0

[State 4512, Var] ;Get fall velocity
type = VarSet
trigger1 = Time = 0
trigger1 = GetHitVar(fall.yvel) != 0
sysvar(1) = floor(vel y)

[State 4512, 6]
type = PlaySnd
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = F7, (sysvar(1) > 5) + (sysvar(1) > 14)

[State 4512, 7]
type = GameMakeAnim
trigger1 = Time = 0
trigger1 = !SysVar(0)
value = 60 + (sysvar(1) > 5) + (sysvar(1) > 14)
pos = 0, 0
under = sysvar(1) <= 14

[State 4512, 8]
type = VelSet
trigger1 = Time = 0
y = 0

[State 4512, 12]
type = VarSet
trigger1 = SysVar(0)
trigger1 = Time = 0
sysvar(0) = 0

[State 4512, 13] ;Friction
type = VelMul
trigger1 = 1
x = 0.85

[State 4512, ChangeAnim]
type = ChangeAnim
triggerall = anim = 15110
triggerall = animelemno(0) = 2
trigger1 = var(0) > root, var(22)
trigger2 = !root, alive
trigger3 = var(4)
value = 15150

[State 4512, ChangeState]
type = ChangeState
trigger1 = anim = 15110
trigger1 = time = 60
value = 4513

[State 4512, DestroySelf]
type = DestroySelf
trigger1 = anim = 15150
trigger1 = time = 66

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

[Statedef 4513]
type    = L
movetype= H
physics = N
anim = 15120

[State 4513, ChangeState]
type = ChangeState
trigger1 = !animtime
value = 4000

[State 4513, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(23) = 1
persistent = 0

[State 4513, ParentVarSet]
type = ParentVarSet
trigger1 = !time
var(24) = ifelse(parent, var(23) = 1, floor((parent, var(24) + pos x)/2), floor(pos x))
persistent = 0

[State Skel, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 4500
ignorehitpause = 1

[State Skel, NotHitBy]
type = NotHitBy
trigger1 = 1
value = , AT

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing < -300
x = (-300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Corner Bound]
type = PosAdd
trigger1 = pos x - helper(6000), pos x + vel x*facing > 300
x = (300 - pos x + helper(6000), pos x - vel x*facing)*facing

[State Skel, Time Over]
type = VarSet
trigger1 = numhelper(1155)
trigger2 = root, stateno = 1405
trigger2 = root, var(3) = 1
trigger3 = !root, alive
trigger4 = root, var(2) = [2000, 3000)
var(4) = 1

[State Skel, VarAdd]
type = VarAdd
trigger1 = gametime%2
var(1) = 1

;---------------------------------------------------------------------------
; Stage
;
[Statedef 6000]
ctrl = 0
anim = 6000
sprpriority = -4

[State 6000, PosSet]
type = PosSet
trigger1 = !time
x = 0
y = 0
persistent = 0

[State 6000, ParentVarSet]
type = ParentVarSet
trigger1 = root, hitshakeover
fvar(4) = root, pos x - pos x

[State 6000, ParentVarSet]
type = ParentVarSet
trigger1 = root, stateno != [9000, 9105]
var(2) = root, stateno 
ignorehitpause = 1

[State 6000, PlaySnd]
type = PlaySnd
trigger1 = root, var(10) = 1
value = 1050, 0
abspan = root, var(11)
channel = 0

[State 6000, PlaySnd]
type = PlaySnd
trigger1 = root, var(10) = 2
value = 2270, 0
abspan = root, var(11)
channel = 0

[State 6000, PlaySnd]
type = PlaySnd
trigger1 = root, var(10) = 3
value = 1070, 1
abspan = root, var(11)
channel = 0

[State 6000, PlaySnd]
type = PlaySnd
trigger1 = root, var(15)
value = 1070, 1
abspan = root, var(16)
channel = 1

[State 6000, PlaySnd]
type = PlaySnd
trigger1 = root, var(23)
value = 4000, root, var(23) - 1
abspan = root, var(24)
channel = 1 + root, var(23)

[State 6000, ParentVarSet]
type = ParentVarSet
trigger1 = root, var(10)
var(10) = 0

[State 6000, ParentVarSet]
type = ParentVarSet
trigger1 = root, var(15)
var(15) = 0

[State 6000, ParentVarSet]
type = ParentVarSet
trigger1 = root, var(23)
var(23) = 0

[State 6000, ParentVarSet]
type = ParentVarSet
trigger1 = root, hitshakeover
fvar(5) = root, pos y - pos y + root, vel y

[State 6000, NoBG]
type = AssertSpecial
trigger1 = root, stateno != 10190
;flag = NoBG
flag = GlobalNoShadow

[State 6000, RemoveExplod]
type = RemoveExplod
trigger1 = root, var(19)
id = 6300

[State 6000, RemoveExplod]
type = RemoveExplod
trigger1 = root, var(19)
trigger1 = roundstate > 3
id = 6301

[State 6000, Explod]
type = Explod
trigger1 = root, var(19)
trigger1 = !numexplod(6301)
trigger1 = roundstate < 4
postype = left
id = 6301
anim = 6301
bindtime = -1
pos = 20, 220
ontop = 1
ownpal = 1
removetime = -1

[State 6000, VarSet]
type = VarSet
trigger1 = root, var(19)
fvar(2) = fvar(2)*0.5 + 0.5*root, life/root, lifemax
ignorehitpause = 1

[State 6000, Explod]
type = Explod
trigger1 = root, var(19)
trigger1 = roundstate < 4
postype = left
id = 6300
anim = 6300
bindtime = -1
pos = 20, 220
ontop = 1
ownpal = 1
scale = fvar(2), 1
removetime = -1

;---------------------------------------------------------------------------
; Screenbounder
;
[Statedef 6001]
ctrl = 0
anim = 9999

[State 6001, VelSet]
type = VelSet
trigger1 = root, alive
trigger1 = numhelper(3)
trigger1 = helper(3), anim != 9999
x = ((root, pos x + helper(3), pos x)*0.5 - pos x)*facing

[State 6001, VelSet]
type = VelSet
triggerall = root, alive
trigger1 = !numhelper(3)
trigger2 = helper(3), anim = 9999
x = rootdist x

[State 6001, VelAdd]
type = VelAdd
trigger1 = screenpos x + vel x < 150
x = 150 - screenpos x - vel x

[State 6001, VelAdd]
type = VelAdd
trigger1 = screenpos x + vel x > 170
x = 170 - screenpos x - vel x

[State 6001, VelSet]
type = VelSet
trigger1 = !root, alive
x = 0

[State 6001, Width]
type = Width
trigger1 = 1
edge = 110, 110

[State 6001, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,0

;---------------------------------------------------------------------------
; Pusher
;
[Statedef 6100]
ctrl = 0
anim = 6100
type = S
movetype = I
physics = N

[State 6100, DestroySelf]
type = DestroySelf
trigger1 = root, var(1)
trigger2 = !root, alive

[State 6100, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = -1

[State 6100, Turn]
type = Turn
trigger1 = rootdist x < 0

[State 6100, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 6100, VelSet]
type = VelSet
trigger1 = 1
x = 4 + rootdist x*0.01

[State 6100, VelSet]
type = VelSet
trigger1 = rootdist x < enemy(0), const(size.ground.back) + enemy(0), const(size.ground.front)
x = 0

[State 6100, PosSet]
type = PosSet
trigger1 = abs(enemy(0), pos x - root, pos x) > rootdist x 
trigger2 = !time
x = enemy(0), pos x + enemy(0), const(size.ground.back)*ifelse(enemy(0), pos x < root, pos x, -1, 1)

[State 6100, Width]
type = Width
trigger1 = 1
player = -const(size.ground.front) + 4, -const(size.ground.back) + 4

[State 6100, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 1

;
[Statedef 6101]
ctrl = 0
anim = 6100
type = S
movetype = I
physics = N

[State 6101, DestroySelf]
type = DestroySelf
trigger1 = root, var(1)
trigger2 = numenemy < 2
trigger3 = !root, alive

[State 6101, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = -1

[State 6101, Turn]
type = Turn
trigger1 = rootdist x < 0

[State 6101, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 6101, VelSet]
type = VelSet
trigger1 = 1
x = 4 + rootdist x*0.03

[State 6101, VelSet]
type = VelSet
trigger1 = rootdist x < enemy(1), const(size.ground.back) + enemy(1), const(size.ground.front)
x = 0

[State 6101, PosSet]
type = PosSet
trigger1 = abs(enemy(1), pos x - root, pos x) > rootdist x 
trigger2 = !time
x = enemy(1), pos x + enemy(1), const(size.ground.back)*ifelse(enemy(1), pos x < root, pos x, -1, 1)

[State 6101, Width]
type = Width
trigger1 = 1
player = -const(size.ground.front) + 4, -const(size.ground.back) + 4

[State 6101, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 1

[Statedef 6200]
ctrl = 0
anim = 6100
type = S
movetype = I
physics = N

[State 6200, DestroySelf]
type = DestroySelf
trigger1 = root, var(1)
trigger2 = !root, alive

[State 6200, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = -1

[State 6200, Turn]
type = Turn
trigger1 = facing = root, facing

[State 6200, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 6200, VelSet]
type = VelSet
trigger1 = 1
x = 6 + (helper(6000), pos x - pos x)*facing*0.03

[State 6200, VelSet]
type = VelSet
trigger1 = vel x < 0.5
x = 0.5

[State 6200, PosSet]
type = PosSet
trigger1 = (enemy(0), pos x - pos x)*facing < 0
trigger2 = !time
x = enemy(0), pos x - enemy(0), const(size.ground.back)*facing

[State 6200, Width]
type = Width
trigger1 = 1
player = -const(size.ground.front) + 4, -const(size.ground.back) + 4

[State 6200, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 1

[Statedef 6201]
ctrl = 0
anim = 6100
type = S
movetype = I
physics = N

[State 6201, DestroySelf]
type = DestroySelf
trigger1 = root, var(1)
trigger2 = numenemy < 2
trigger3 = !root, alive

[State 6201, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA
time = -1

[State 6201, Turn]
type = Turn
trigger1 = facing = root, facing

[State 6201, PosSet]
type = PosSet
trigger1 = 1
y = 0

[State 6201, VelSet]
type = VelSet
trigger1 = 1
x = 6 + (helper(6000), pos x - pos x)*facing*0.03

[State 6201, VelSet]
type = VelSet
trigger1 = vel x < 0.5
x = 0.5

[State 6201, PosSet]
type = PosSet
trigger1 = (enemy(1), pos x - pos x)*facing < 0
trigger2 = !time
x = enemy(1), pos x - enemy(1), const(size.ground.back)*facing

[State 6201, Width]
type = Width
trigger1 = 1
player = -const(size.ground.front) + 4, -const(size.ground.back) + 4

[State 6201, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 1

;---------------------------------------------------------------------------
; Text
;
[Statedef 20000]
ctrl = 0
anim = ifelse(root, stateno = 190, 20000, ifelse(root, stateno = 10180, 20002, 20001))
sprpriority = -4

[State 20000, DestroySelf]
type = DestroySelf
trigger1 = var(0)

[State 20000, Explod]
type = Explod
trigger1 = !numexplod(20000)
anim = anim
id = 20000
ontop = 1
postype = left
bindtime = -1
ownpal = 1
pos = 0, 32
removetime = -1

[State 20000, VarSet]
type = VarSet
trigger1 = anim = 20000
trigger1 = roundstate > 1 
trigger2 = anim = 20002
trigger2 = roundstate != [3, 4]
trigger3 = time >= 600 
var(0) = 1

[State 20000, RemoveExplod]
type = RemoveExplod
trigger1 = var(0)
id = 20000

[State 20000, Invisible]
type = AssertSpecial
trigger1 = 1
flag = invisible

[State 20000, Intro]
type = AssertSpecial
trigger1 = anim = 20000
flag = intro

[State 20000, Intro]
type = AssertSpecial
trigger1 = anim = 20002
flag = roundnotover

;---------------------------------------------------------------------------
; Hyper Armour
;
[Statedef 9000]
type = A
movetype = H 
hitdefpersist = 1
movehitpersist = 1
sprpriority = -2

[State 9000, VarSet]
type = VarSet
trigger1 = !time
trigger1 = var(5) = 1
var(5) = 0

[State 9000, HitFallSet]
type = HitFallSet
trigger1 = !time
value = 0

[State 9000, PosSet]
type = PosSet
trigger1 = 1
x = fvar(4) + helper(6000), pos x
y = fvar(5) + helper(6000), pos y
ignorehitpause = 1

[State 9000, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, NA, SA, NT, ST, NP, SP
stateno = 9000
ignorehitpause = 1

[State 9000, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, HA, HT, HP
slot = 1
stateno = 9001
ignorehitpause = 1

[State 9000, VarSet]
type = VarSet
trigger1 = !time
var(13) = gethitvar(damage)
ignorehitpause = 1

[State 9000, VarAdd]
type = VarAdd
trigger1 = !time
trigger1 = var(2) != [2000, 3000)
trigger1 = var(2) != 9105
fvar(6) = ceil(var(13)*(1 + 0.5*(prevstateno = 9001) + 0.33*(var(2) = [800, 810]) + 0.15*(var(2) = 0 || var(2) = 1000)))
ignorehitpause = 1

[State 9000, LifeAdd]
type = LifeAdd
trigger1 = (!time && gethitvar(hitshaketime) = 0) || time = 1
trigger1 = var(12) = (0, lifemax)
trigger1 = life > var(12) - var(13)
trigger1 = var(12) := -var(12) || 1
value = -var(12)-var(13)-life

[State 9000, NotHitBy]
type = NotHitBy
trigger1 = (!time && gethitvar(hitshaketime) = 0) || time = 1
trigger1 = var(12) < 0
value = SCA
time = 10

[State 9000, LifeAdd]
type = LifeAdd
trigger1 = (time < 2 && gethitvar(hitshaketime) = 0) || time = 1
trigger1 = var(12) < 0
trigger1 = enemynear, name = "D'raven" || enemynear, name = "D'Raven"
trigger1 = enemynear, stateno = 1060
value = -10000/const(data.defence)
ignorehitpause = 1

[State 9000, VarSet]
type = VarSet
trigger1 = (!time && gethitvar(hitshaketime) = 0) || time = 1
var(12) = life
ignorehitpause = 1

[State 9000, PalFX]
type = PalFX
trigger1 = !time
mul = 224, 256, 256
color = 0
invertall = 1
time = 2
ignorehitpause = 1

[State 9000, ChangeAnim]
type = ChangeAnim
trigger1 = 1
value = anim
elem = animelemno(-1)

[State 9000, ChangeState]
type = ChangeState
trigger1 = !alive
trigger1 = var(0) := ifelse( var(2) = 5150, var(0), 1 ) || 1
trigger1 = var(3) := ifelse( var(2) = 5150, var(3), 0 ) || 1
trigger1 = var(2) := 5150
value = 5150
ignorehitpause = 1

[State 9000, ChangeState]
type = ChangeState
trigger1 = fvar(6) > var(14)
trigger1 = fvar(6) := 0 || 1
trigger1 = var(2) := 9100
trigger1 = var(3) := 0 || 1
value = 9100
ignorehitpause = 1

[State 9000, ChangeState]
type = ChangeState
trigger1 = hitshakeover
trigger2 = var(2) = 9100
trigger3 = var(2) = 9105
trigger3 = (var(1) := (prevstateno = 9001)) || 1
value = var(2)
ignorehitpause = 1

[State 9000, PosFreeze]
type = PosFreeze
trigger1 = 1
ignorehitpause = 1

[State 9000, PosAdd]
type = PosAdd
trigger1 = 1
x = -vel x
y = -vel y
ignorehitpause = 1

[State 9000, TargetBind]
type = TargetBind
trigger1 = var(2) = 810
trigger1 = numtarget(808)
id = 808
pos = 0, 55

[Statedef 9001]
type = A
movetype = H 
hitdefpersist = 1
movehitpersist = 1
sprpriority = -2

[State 9001, ChangeState]
type = ChangeState
trigger1 = 1
value = 9000
ignorehitpause = 1

;---------------------------------------------------------------------------
; Flinch
;
[Statedef 9100]
type = A
movetype = H 
velset = 0, 0
sprpriority = -2
velset = 0,0

[State 9100, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 9100, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 0

[State 9100, PlaySnd]
type = PlaySnd
trigger1 = !var(3)
trigger1 = alive
value = 11, 0
channel = 1
lowpriority = 1
persistent = 0

[State 9100, ChangeAnim]
type = ChangeAnim
trigger1 = !var(3)
value = 5000

[State 9100, ChangeAnim]
type = ChangeAnim
trigger1 = var(17) > 0
trigger1 = animelemno(0) = 4
value = 5000
elem = 3

[State 9100, PosSet]
type = PosSet
trigger1 = !hitshakeover
x = fvar(4) + helper(6000), pos x
y = fvar(5) + helper(6000), pos y
ignorehitpause = 1

[State 9100, VarAdd]
type = VarAdd
trigger1 = hitshakeover
var(3) = 1

[State 9100, VarSet]
type = VarSet
trigger1 = var(3) = 1
fvar(2) = gethitvar(xvel)*facing*0.5

[State 9100, VarSet]
type = VarSet
trigger1 = var(3) = 1
fvar(3) = gethitvar(yvel)*0.5

[State 9100, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(2) > 4
fvar(2) = 4

[State 9100, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(2) < -4
fvar(2) = -4

[State 9100, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(3) > 1
fvar(3) = 1

[State 9100, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(3) < -4
fvar(3) = -4

[State 9100, VarSet]
type = VarSet
trigger1 = hitshakeover
fvar(2) = fvar(2)*0.9

[State 9100, PosAdd]
type = PosAdd
trigger1 = hitshakeover
trigger1 = var(3)
x = fvar(2)

[State 9100, PosAdd]
type = PosAdd
trigger1 = hitshakeover
trigger1 = var(3) = [1, 5]
x = fvar(2)*2

;[State 9100, PosAdd]
;type = PosAdd
;trigger1 = var(3) > 15
;trigger1 = numhelper(3)
;x = (helper(3), pos x - pos x)*0.1*facing
;y = (-150 - pos y)*ifelse(var(3) < 25, (var(3) - 15)*0.1, 1)

[State 9100, PosAdd]
type = PosAdd
trigger1 = hitshakeover
trigger1 = var(3) = [1, 10]
y = fvar(3)*(0.8**(var(3) - 1))

[State 9100, PosSet]
type = PosSet
trigger1 = !hitshakeover
x = fvar(4) + helper(6000), pos x
y = fvar(5) + helper(6000), pos y
ignorehitpause = 1

[State 9100, StateTypeSet]
type = StateTypeSet
trigger1 = hitshakeover
movetype = I

[State 9100, ChangeState]
type = ChangeState
triggerall = hitshakeover
trigger1 = var(3) > 10
trigger1 = var(0) := 0 || 1
trigger1 = var(3) := 0 || 1
trigger1 = fvar(6) := 0 || 1
trigger1 = var(2) := 9105
value = 9105
ignorehitpause = 1

[Statedef 9101]
ctrl = 0
movetype = I
sprpriority = -2

[State 9101, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 9100
value = root, stateno + 1

[State 9101, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 0

[State 9101, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 9101, ChangeAnim]
type = ChangeAnim
trigger1 = anim != 1
value = 1

[State 9101, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = root, hitshakeover
trigger1 = screenpos y > 0
y = -screenpos y

[State 9101, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = root, hitshakeover
x = root, fvar(2)*facing*root, facing
y = ((-270.5 - cos((root, var(3) - 20)*pi/120.0)*10) - pos y)*0.1

[State 9101, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 5]
trigger1 = root, hitshakeover
x = root, fvar(2)*facing*root, facing*0.5

[Statedef 9103]
ctrl = 0
anim = 3
sprpriority = -5

[State 9103, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 9100
value = root, stateno + 3

[State 9103, RemoveExplod]
type = RemoveExplod
trigger1 = !time
id = 0

[State 9103, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = root, hitshakeover
trigger1 = screenpos y > 105
y = -screenpos y + 105

[State 9103, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = root, hitshakeover
x = root, fvar(2)*facing*root, facing
y = ((-190 - cos((root, var(3) - 40)*pi/60.0)*5) - pos y)*0.1

[State 9103, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 5]
trigger1 = root, hitshakeover
x = root, fvar(2)*facing*root, facing*0.5

[Statedef 9105]
type = A
movetype = H
physics = N
sprpriority = -2
ctrl = 0

[State 9105, AI Breath]
type = ChangeState
value = 2000 + (random%3)*100
triggerall = var(59) > 0
triggerall = var(20) = 1
trigger1 = hitshakeover
trigger1 = var(0) >= var(17)
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 0 || 1
trigger1 = var(1) := 0 || 1

[State 9105, 5]
type = ChangeState
trigger1 = hitshakeover
trigger1 = var(0) >= var(17)
trigger1 = var(3) := 0 || 1
trigger1 = var(0) := 30
trigger1 = var(1) := 60 + var(17)/10
value = 0

[State 9105, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 9105, VarSet]
type = VarSet
trigger1 = hitshakeover
trigger1 = fvar(2) != [-0.5, 0.5]
fvar(2) = fvar(2)*0.95

[State 9105, VarSet]
type = VarSet
trigger1 = 1
fvar(3) = -45 + cos(var(3)*pi/60.0)*5

[State 9105, VarAdd]
type = VarAdd
trigger1 = var(3) < 20
fvar(3) = var(3)*2 - 40

[State 9105, ChangeAnim]
type = ChangeAnim
trigger1 = animelemno(0) = 4
value = 5000
elem = 3

[State 9105, VarAdd]
type = VarAdd
trigger1 = hitshakeover
var(3) = 1

[State 9105, VarAdd]
type = VarAdd
trigger1 = !var(1)
trigger2 = hitshakeover
var(0) = 1

[State 9105, PosSet]
type = PosSet
trigger1 = 1
x = fvar(4) + helper(6000), pos x
y = fvar(5) + helper(6000), pos y
ignorehitpause = 1

[State 9105, PosSet]
type = PosSet
trigger1 = hitshakeover
trigger1 = numhelper(3)
trigger1 = var(3) > 200
y = fvar(3)

[State 9105, PosSet]
type = PosSet
trigger1 = hitshakeover
trigger1 = numhelper(3)
trigger1 = var(3) = [1, 200]
y = pos y*(1 - var(3)*0.005) + fvar(3)*var(3)*0.005

[State 9105, PosAdd]
type = PosAdd
trigger1 = hitshakeover
trigger1 = fvar(2) != [-0.5, 0.5]
x = fvar(2)*(1 - var(3)*0.1)

[State 9105, PlayerPush]
type = PlayerPush
trigger1 = pos y > -60
value = 1
ignorehitpause = 1

[State 9105, StateTypeSet]
type = StateTypeSet
trigger1 = pos y > -60
statetype = S

[State 9105, Helper]
type = Helper
trigger1 = statetype = S
trigger1 = !numhelper(9150)
name = "f"
id = 9150
stateno = 9150
pausemovetime = 99999
supermovetime = 99999

[State 9105, StateTypeSet]
type = StateTypeSet
trigger1 = hitshakeover
movetype = I

[Statedef 9106]
ctrl = 0
sprpriority = -2
anim = 1

[State 9106, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 9105
value = root, stateno + 1

[State 9106, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 100
trigger1 = root, hitshakeover
y = -240.5 - cos((root, var(3) + 30)*pi/60.0)*5

[State 9106, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 100]
trigger1 = root, hitshakeover
y = pos y*(1 - root, var(3)*0.01) - (240.5 + cos((root, var(3) + 30)*pi/60.0)*5)*root, var(3)*0.01

[State 9106, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 35]
trigger1 = root, hitshakeover
x = pos x*(1 - root, var(3)*0.005) + (root, pos x - 105.5*facing)*root, var(3)*0.005 + root, vel x*root, facing

[State 9106, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 0
y = -screenpos y

[Statedef 9108]
ctrl = 0
anim = 3
sprpriority = -5

[State 9108, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 9105
value = root, stateno + 3

[State 9108, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) > 100
trigger1 = root, hitshakeover
trigger2 = !time
trigger2 = !prevstateno
y = -150.5 - cos((root, var(3) + 10)*pi/60.0)*5

[State 9108, PosSet]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 100]
trigger1 = root, hitshakeover
y = pos y*(1 - root, var(3)*0.01) - (150.5 + cos((root, var(3) + 10)*pi/60.0)*5)*root, var(3)*0.01

[State 9108, PosSet1]
type = PosSet
triggerall = root, stateno != 9000
trigger1 = root, var(3) = [1, 35]
trigger1 = root, hitshakeover
x = pos x*(1 - root, var(3)*0.001) + root, pos x*root, var(3)*0.001 + root, vel x*root, facing

[State 9108, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = screenpos y > 105
trigger1 = root, hitshakeover
y = -screenpos y + 105


; Pusher to reduce collision displacement
[Statedef 9150]
ctrl = 0
anim = 0
type = S
movetype = I
physics = N

[State 9150, DestroySelf]
type = DestroySelf
trigger1 = root, stateno != [9000, 9105]
trigger2 = root, statetype != S

[State 9150, Invisible]
type = AssertSpecial
trigger1 = 1
flag = Invisible

[State 9150, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 1

[State 9150, NotHitBy]
type = NotHitBy
trigger1 = 1
value = SCA

[State 9150, BindToParent]
type = BindToParent
trigger1 = 1

;---------------------------------------------------------------------------
; KO

[Statedef 5150]
type = A
movetype = H 
velset = 0, 0

[State 5150, VarSet]
type = VarSet
trigger1 = !time
var(5) = 0

[State 5150, VarSet]
type = VarSet
trigger1 = !time
trigger1 = prevstateno != 9000
var(3) = 0

[State 5150, VarSet]
type = VarSet
trigger1 = !var(3)
fvar(2) = 0

[State 5150, VarSet]
type = VarSet
trigger1 = !var(3)
fvar(3) = 0

[State 5150, StopSnd]
type = StopSnd
trigger1 = !var(3)
channel = 0

[State 5150, StopSnd]
type = StopSnd
trigger1 = !var(3)
channel = 1

[State 5150, ChangeAnim]
type = ChangeAnim
trigger1 = !var(3)
value = 5000

[State 5150, VarSet]
type = VarSet
trigger1 = var(3) = 1
fvar(2) = gethitvar(xvel)*facing*0.5

[State 5150, VarSet]
type = VarSet
trigger1 = var(3) = 1
fvar(3) = gethitvar(yvel)*0.5

[State 5150, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(2) > 4
fvar(2) = 4

[State 5150, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(2) < -4
fvar(2) = -4

[State 5150, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(3) > 1
fvar(3) = 1

[State 5150, VarSet]
type = VarSet
trigger1 = var(3) = 1
trigger1 = fvar(3) < -4
fvar(3) = -4

[State 5150, PosAdd]
type = PosAdd
trigger1 = var(3) < 60
x = fvar(2)

[State 5150, PosAdd]
type = PosAdd
trigger1 = var(3) = [1, 5]
x = fvar(2)*2

[State 5150, PosAdd]
type = PosAdd
trigger1 = var(3) = [1, 10]
y = fvar(3)*(0.8**(var(3) - 1))

[State 5150, PosAdd]
type = PosAdd
trigger1 = var(3)
y = -10 - var(3)

[State 5150, PosSet]
type = PosSet
trigger1 = !hitshakeover
x = fvar(4) + helper(6000), pos x
y = fvar(5) + helper(6000), pos y
ignorehitpause = 1

[State 5150, StateTypeSet]
type = StateTypeSet
trigger1 = hitshakeover
statetype = L

[State 5150, AssertSpecial]
type = AssertSpecial
trigger1 = matchover
trigger1 = var(3) < 360
flag = RoundNotOver

[State 5150, AssertSpecial]
type = AssertSpecial
trigger1 = matchover
flag = NoMusic

[State 5150, Explod]
type = Explod
trigger1 = matchover
trigger1 = var(3) > 59
postype = left
id = 5150
anim = 5150
bindtime = -1
facing = facing
pos = 160, 5*(var(3) - 60)
sprpriority = -5
scale = const(size.xscale), const(size.yscale)
ownpal = 0
removetime = 1

[State 5150, PosSet]
type = PosSet
trigger1 = var(3) = 60
trigger1 = numhelper(6001)
x = floor(helper(6001), pos x)

[State 5150, PlaySnd]
type = PlaySnd
trigger1 = matchover
trigger1 = var(3) = 60
value = 11, 1
abspan = 0
channel = 1
persistent = 0

[State 5150, NotHitBy]
type = NotHitBy
trigger1 = matchover
trigger1 = var(3) > 50
value = SCA
time = 1
ignorehitpause = 1

[State 5150, PalFX]
type = PalFX
trigger1 = matchover
trigger1 = var(3) > 75
mul = 256 - (var(3)-75)/2, 256 - (var(3)-75)/2, 256 - (var(3)-75)/2
add = -(var(3)-75)/2, -(var(3)-75)/2, -(var(3)-75)/2
time = 1
ignorehitpause = 1

[State 5150, EnvShake]
type = EnvShake
trigger1 = matchover
trigger1 = var(3) = 300
time = 15
freq = 50
ampl = 8
phase = 270
persistent = 0

[State 5150, PlaySnd]
type = PlaySnd
trigger1 = matchover
trigger1 = var(3) = 300
value = 5150, 0
abspan = 0
persistent = 0

[State 5150, VarAdd]
type = VarAdd
trigger1 = hitshakeover
var(3) = 1

[Statedef 5151]
ctrl = 0
movetype = I
sprpriority = -2

[State 5151, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 5150
value = root, stateno + 1

[State 5151, PosAdd]
type = PosAdd
trigger1 = anim = 201
x = 24
y = 12

[State 5151, ChangeAnim]
type = ChangeAnim
trigger1 = anim != 1
value = 1

[State 5151, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = screenpos y > 0
y = -screenpos y

[State 5151, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = root, hitshakeover
x = root, fvar(2)*facing*root, facing
y = -7 - root, var(3)

[Statedef 5153]
ctrl = 0
anim = 3
sprpriority = -5

[State 5153, ChangeState]
type = ChangeState
triggerall = root, stateno != 9000
triggerall = root, stateno != 5030
trigger1 = root, stateno != 5150
value = root, stateno + 3

[State 5153, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = screenpos y > 105
y = -screenpos y + 105

[State 5153, PosAdd]
type = PosAdd
triggerall = root, stateno != 9000
trigger1 = root, var(3)
trigger1 = root, hitshakeover
x = root, fvar(2)*facing*root, facing
y = -5 - root, var(3)

;---------------------------------------------------------------------------
; Burnt

[Statedef 5400]
type    = A
movetype= H
physics = N
velset = 0, 0

[State 5400, DestroySelf]
type = DestroySelf
trigger1 = ishelper

[State Safety]
type = SelfState
trigger1 = gethitvar(guarded)
value = ifelse(prevstateno = 5400, 150 + 2*(statetype = C) + 4*(statetype = A), prevstateno)

[State 5400, 0]
type = PalFX
trigger1 = 1
invertall = 1
color = 0
mul = 256, floor(160 + sin(time*pi/10.0)*16), floor(64 + sin(time*pi/10.0)*16)
add = floor(208 + sin(time*pi/15.0)*48), floor(128 + sin(time*pi/10.0)*16), floor(64 + sin(time*pi/5.0)*16)
time = 1
ignorehitpause = 1

[State 5400, 2]
type = HitVelSet
trigger1 = Time = 1
x = 1
y = 1

[State 5400, 2]
type = VelMul
trigger1 = time = 1
trigger1 = gethitvar(fall.recovertime) != 1
trigger1 = vel x > 0
x = -1

[State 5400, 1]
type = ChangeAnim
trigger1 = 1
value = 5030

[State 5400, 3] ;Gravity
type = VelAdd
trigger1 = time
y = GetHitVar(yaccel)

[State 5400, 6]
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;HIT_BOUNCE

;---------------------------------------------------------------------------
; Shocked

[Statedef 5402]
type    = A
movetype= H
physics = N
velset = 0, 0

[State 5402, DestroySelf]
type = DestroySelf
trigger1 = ishelper

[State Safety]
type = SelfState
trigger1 = gethitvar(guarded)
value = ifelse(prevstateno = 5402, 150 + 2*(statetype = C) + 4*(statetype = A), prevstateno)

[State 5402, 0]
type = PalFX
trigger1 = time%4 = 0
trigger1 = !hitshakeover
invertall = 1
time = 2

[State 5402, 2]
type = HitVelSet
trigger1 = hitshakeover
x = 1
y = 1
persistent = 0

[State 5402, 2]
type = VelMul
trigger1 = hitshakeover
trigger1 = vel x > 0
x = -1
persistent = 0

[State 5402, 1]
type = ChangeAnim
trigger1 = 1
value = 5030

[State 5402, 3] ;Gravity
type = VelAdd
trigger1 = hitshakeover
y = GetHitVar(yaccel)

[State 5402, 6]
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;HIT_BOUNCE

;---------------------------------------------------------------------------
; Flame Helper

[Statedef 7005]
type = A
movetype = I
physics = N
anim = 9999
sprpriority = -1

[State 7005, VarSet]
type = VarSet
trigger1 = !time
trigger1 = numenemy > 1
var(0) = ifelse(abs(enemy(0), pos x - pos x) < abs(enemy(1), pos x - pos x), 0, 1)

[State 7005, Turn]
type = Turn
trigger1 = facing != enemy(var(0)), facing

[State 7005, Explod]
type = Explod
trigger1 = time%12 = 0
anim = 7006
id = 7006
sprpriority = 1
scale = const(size.xscale), const(size.yscale)
pos = 12, floor(enemy(var(0)), const(size.head.pos.y)*0.67+12)
bindtime = -1
ownpal = 1

[State 7005, Explod]
type = Explod
trigger1 = time%12 = 0
anim = 7006
id = 7006
sprpriority = 1
scale = const(size.xscale), const(size.yscale)
pos = -12, floor(enemy(var(0)), const(size.head.pos.y)*0.67-12)
bindtime = -1
ownpal = 1

[State 7005, RemoveExplod]
type = RemoveExplod
trigger1 = enemy(var(0)), stateno != 5400
trigger1 = enemy(var(0)), time != time

[State 7005, DestroySelf]
type = DestroySelf
trigger1 = enemy(var(0)), stateno != 5400
trigger1 = enemy(var(0)), time != time

[State 7005, PosSet]
type = PosSet
trigger1 = 1
x = enemy(var(0)), pos x
y = enemy(var(0)), pos y

[State 7005, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 2
trigger1 = enemy, vel x >= 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 3, enemy(var(0)), gethitvar(animtype), 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.front)) - 10, floor(enemy(var(0)), const(size.mid.pos.y))
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

[State 7005, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 2
trigger1 = enemy, vel x < 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 4, enemy(var(0)), gethitvar(animtype) < 4, 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.back)) + 10, floor(enemy(var(0)), const(size.mid.pos.y))
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

[State 7005, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 3
trigger1 = enemy, vel x >= 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 3, enemy(var(0)), gethitvar(animtype), 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.front)) - 10, -20
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

[State 7005, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 3
trigger1 = enemy, vel x < 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 4, enemy(var(0)), gethitvar(animtype) < 4, 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.back)) + 10, -20
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

;---------------------------------------------------------------------------
; Shock Helper

[Statedef 7007]
type = A
movetype = I
physics = N
anim = 7007
sprpriority = 1

[State 7007, VarSet]
type = VarSet
trigger1 = !time
trigger1 = numenemy > 1
var(0) = ifelse(abs(enemy(0), pos x - pos x) < abs(enemy(1), pos x - pos x), 0, 1)

[State 7007, Turn]
type = Turn
trigger1 = facing != enemy(var(0)), facing

[State 7007, RemoveExplod]
type = RemoveExplod
trigger1 = enemy(var(0)), stateno != 5402
trigger1 = enemy(var(0)), time != time

[State 7007, DestroySelf]
type = DestroySelf
trigger1 = enemy(var(0)), stateno != 5402
trigger1 = enemy(var(0)), time != time

[State 7007, PosSet]
type = PosSet
trigger1 = 1
x = enemy(var(0)), pos x
y = enemy(var(0)), pos y + floor(enemy(var(0)), const(size.head.pos.y)*0.67)

[State 7007, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 2
trigger1 = enemy, vel x >= 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 3, enemy(var(0)), gethitvar(animtype), 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.front)) - 10, floor(enemy(var(0)), const(size.mid.pos.y) - enemy(var(0)), const(size.head.pos.y)*0.67)
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

[State 7007, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 2
trigger1 = enemy, vel x < 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 4, enemy(var(0)), gethitvar(animtype) < 4, 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.back)) + 10, floor(enemy(var(0)), const(size.mid.pos.y) - enemy(var(0)), const(size.head.pos.y)*0.67)
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

[State 7007, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 3
trigger1 = enemy, vel x >= 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 3, enemy(var(0)), gethitvar(animtype), 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.front)) - 10, -20 - floor(enemy(var(0)), const(size.head.pos.y)*0.67)
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

[State 7007, Explod]
type = Explod
trigger1 = !time
trigger1 = enemy(var(0)), gethitvar(fall.recovertime) = 3
trigger1 = enemy, vel x < 0
postype = p1
anim = F(ifelse(enemy(var(0)), gethitvar(animtype) < 4, enemy(var(0)), gethitvar(animtype) < 4, 3))
bindtime = 1
pos = floor(enemy(var(0)), const(size.ground.back)) + 10, -20 - floor(enemy(var(0)), const(size.head.pos.y)*0.67)
sprpriority = 5
pausemovetime = 99999
supermovetime = 99999
persistent = 0
ignorehitpause = 1
ownpal = 1

;==================================================================================
;======| RELACIONADO  AI - AI RELATED |===========================================
;==================================================================================

; (Credit to ANMC, Bagaliao, and FlowaGirl for the basic helper method concept.)
;
;------------------
; AI Activation Helper State - Primary Version
; (Credit to YongMing for the basic HitPause bugfix concept.)
;
; var(1) - First tick button activation prevention.
; var(2) - Used for pause/superpause and custom state check, basically.
; var(3) - (Super/)Pause & custom state-triggered dir detection disabler.
; var(4) - Persistent direction command detection enabler (due to 2002.04.14).
; var(9) - AutoTurn bug fixer.
; parent's var(57) - Parent's GameTime var, for pause and custom state check.
; parent's var(59) - Parent's primary AI variable.
;
; The code in this state is mostly simply copy/pasteable.
; But if you're using different indices for the parent's variables,
; or if you change your character's basic commands' names, you'll
; of course need to change the code in this state accordingly.

[StateDef 9741]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9741, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 0

[State 9741, PauseCheck]
type = VarSet
trigger1 = (GameTime>(Parent,var(57)))
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)
trigger4 = Parent,var(59)
trigger5 = (var(3):=0)
var(2) = (var(3):=1)+(var(4):=0)

[State 9741, Facing]
type = Turn
trigger1 = (var(9):=(Facing != Parent,Facing))

[State 9741, DirTurnOnAI]
type = ParentVarSet
triggerall = !var(3)
triggerall = !var(9)
trigger1 = (Parent,command = "holdfwd")
trigger2 = (Parent,command = "holdback")
trigger3 = (Parent,command = "holdup")
trigger4 = (Parent,command = "holddown")
trigger5 = !(var(4):=1)
var(59) = var(4)

[State 9741, DirTurnOffAI]
type = ParentVarSet
triggerall = !var(3)
triggerall = Parent,var(59)
trigger1 = (command = "holdfwd")
trigger1 = (Parent,command = "holdfwd")
trigger2 = (command = "holdback")
trigger2 = (Parent,command = "holdback")
trigger3 = (command = "holdup")
trigger3 = (Parent,command = "holdup")
trigger4 = (command = "holddown")
trigger4 = (Parent,command = "holddown")
var(59) = (var(4):=0)

[State 9741, ButtonTurnOnAI]
type = ParentVarSet
triggerall = var(1)
triggerall = !var(2)
trigger1 = (Parent,command = "a")
trigger2 = (Parent,command = "b")
trigger3 = (Parent,command = "c")
trigger4 = (Parent,command = "x")
trigger5 = (Parent,command = "y")
trigger6 = (Parent,command = "z")
trigger7 = (Parent,command = "start")
var(59) = 1

[State 9741, ButtonTurnOffAI]
type = ParentVarSet
triggerall = !var(2)
trigger1 = (command = "a")
trigger1 = (Parent,command = "a")
trigger2 = (command = "b")
trigger2 = (Parent,command = "b")
trigger3 = (command = "c")
trigger3 = (Parent,command = "c")
trigger4 = (command = "x")
trigger4 = (Parent,command = "x")
trigger5 = (command = "y")
trigger5 = (Parent,command = "y")
trigger6 = (command = "z")
trigger6 = (Parent,command = "z")
trigger7 = (command = "start")
trigger7 = (Parent,command = "start")
var(59) = -1

[State 9741, UnPauseCheck]
type = VarSet
triggerall = var(2)
trigger1 = (Parent,command = "a")
trigger2 = (Parent,command = "b")
trigger3 = (Parent,command = "c")
trigger4 = (Parent,command = "x")
trigger5 = (Parent,command = "y")
trigger6 = (Parent,command = "z")
trigger7 = (Parent,command = "start")
trigger8 = (var(2) = 2)
trigger8 = (var(2):=0)
var(2) = 2

[State 9741, Goodbye]
type = DestroySelf
triggerall = (var(1):=1)
trigger1 = Parent,var(59)
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)


;------------------
; AI Activation Helper State - Compatibly Partnered Version
;
; var(1) - First tick dir activation prevention
; var(2) - Used for pause/superpause and custom state check, basically.
; var(3) - (Super/)Pause & custom state-triggered dir detection disabler.
; var(4) - Hitpause check.
; var(5) - No button on previous tick.
; fvar(6) - Any dir on this tick.
; var(7) - Any button on this tick.
; var(8) - Matching partner button detected.
; var(9) - AutoTurn bug fixer.
; parent's var(57) - Parent's GameTime var, for pause and custom state check.
; parent's var(59) - Parent's primary AI variable.
;
; The code in this state is mostly simply copy/pasteable.
; But if you're using different indices for the parent's variables,
; or if you change your character's basic commands' names, you'll
; of course need to change the code in this state accordingly.

[StateDef 9742]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9742, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 0

[State 9742, PauseCheck]
type = VarSet
trigger1 = (GameTime>Parent,var(57))
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)
trigger4 = Parent,var(59)
trigger5 = (var(3):=0)
var(2) = (var(3):=1)

[State 9742, Facing]
type = Turn
trigger1 = (var(9):=(Facing != Parent,Facing))

[State 9742, ParentDirCheck]
type = VarSet
trigger1 = (Parent,command = "holdfwd")
trigger2 = (Parent,command = "holdback")
trigger3 = (Parent,command = "holdup")
trigger4 = (Parent,command = "holddown")
trigger5 = (fvar(6):=0)
fvar(6) = 1

[State 9742, ParentButtonCheck]
type = VarSet
trigger1 = (Parent,command = "a")
trigger2 = (Parent,command = "b")
trigger3 = (Parent,command = "c")
trigger4 = (Parent,command = "x")
trigger5 = (Parent,command = "y")
trigger6 = (Parent,command = "z")
trigger7 = (Parent,command = "start")
trigger8 = (var(7):=0)
var(7) = 1

[State 9742, SameButtonCheck]
type = VarSet
triggerall = var(7)
triggerall = !var(2)
triggerall = NumPartner
trigger1 = (Parent,command = "a")
trigger1 = (Partner,command = "a")
trigger2 = (Parent,command = "b")
trigger2 = (Partner,command = "b")
trigger3 = (Parent,command = "c")
trigger3 = (Partner,command = "c")
trigger4 = (Parent,command = "x")
trigger4 = (Partner,command = "x")
trigger5 = (Parent,command = "y")
trigger5 = (Partner,command = "y")
trigger6 = (Parent,command = "z")
trigger6 = (Partner,command = "z")
trigger7 = (Parent,command = "start")
trigger7 = (Partner,command = "start")
trigger8 = (var(8):=0)
var(8) = 1

[State 9742, DirTurnOnAI]
type = ParentVarSet
trigger1 = var(1)
trigger1 = fvar(6)
trigger1 = !var(3)
trigger1 = !var(4)
trigger1 = !var(9)
var(59) = 1

[State 9742, DirTurnOffAI]
type = ParentVarSet
triggerall = fvar(6)
triggerall = !var(3)
triggerall = Parent,var(59)
trigger1 = (command = "holdfwd")
trigger1 = (Parent,command = "holdfwd")
trigger2 = (command = "holdback")
trigger2 = (Parent,command = "holdback")
trigger3 = (command = "holdup")
trigger3 = (Parent,command = "holdup")
trigger4 = (command = "holddown")
trigger4 = (Parent,command = "holddown")
var(59) = 0

[State 9742, ButtonTurnOnAI]
type = ParentVarSet
trigger1 = var(5)
trigger1 = var(7)
trigger1 = !var(2)
trigger1 = !var(8)
var(59) = 1

[State 9742, ButtonTurnOffAI]
type = ParentVarSet
triggerall = var(7)
triggerall = !var(2)
triggerall = !var(8)
trigger1 = (command = "a")
trigger1 = (Parent,command = "a")
trigger2 = (command = "b")
trigger2 = (Parent,command = "b")
trigger3 = (command = "c")
trigger3 = (Parent,command = "c")
trigger4 = (command = "x")
trigger4 = (Parent,command = "x")
trigger5 = (command = "y")
trigger5 = (Parent,command = "y")
trigger6 = (command = "z")
trigger6 = (Parent,command = "z")
trigger7 = (command = "start")
trigger7 = (Parent,command = "start")
var(59) = -1

[State 9742, UnPauseCheck]
type = VarSet
triggerall = var(2)
triggerall = !var(4)
trigger1 = var(7)
trigger2 = (var(2) = 2)
trigger2 = (var(2):=0)
var(2) = 2

[State 9742, Goodbye]
type = DestroySelf
trigger1 = Parent,var(59)
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)

[State 9742, HitPauseCheck]
type = VarSet
trigger1 = fvar(6)
trigger2 = var(7)
trigger3 = !(Parent,HitPauseTime)
var(4) = Parent,HitPauseTime

[State 9742, Delay]
type = VarSet
trigger1 = (var(1):=1)
var(5) = !var(7)


;------------------
; XOR Method's HitPauseTime Helper State

[StateDef 9743]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9743, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 0

[State 9743, HitPauseTime]
type = VarSet
trigger1 = !(Parent,HitPauseTime)
trigger2 = (GameTime>Parent,var(57))
var(1) = Parent,HitPauseTime

[State 9742, Goodbye]
type = DestroySelf
trigger1 = (Parent,var(59) = 1)
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)

;==================================================================================
;==================================================================================
;==================================================================================

;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------

;---------------------------------------------------------------------------
; States that are always executed (use statedef -2)
;---------------------------------------------------------------------------
[StateDef -2]

;==================================================================================
;======| RELACIONADO  AI - AI RELATED |===========================================
;==================================================================================

; Within StateDef -2, none of your own AI-related code should be placed
; above these next two controllers.

[State -2, StopAI]
type = VarSet
triggerall = (var(59) > 0)
trigger1 = (RoundState != 2)
trigger2 = !Alive
var(59) = -2
IgnoreHitPause = 1

; This controller is optional.  It allows you treat the AI flag as a boolean
; value rather than an integer value, letting you trigger your AI directives
; with "var(0)" instead of "var(59)>0", and letting you make moves usable only
; by humans by using "!var(0)" instead of "var(59)<1", thus slightly improving
; the size and efficiency of your code.
; Another benefit is that it makes it much easier for users to disable your AI,
; if they so choose.
;[State -2, Simplifier]
;type = VarSet
;trigger1 = (var(59) = 1)
;trigger2 = (var(0):=0)
;var(0) = 1	; Another option is to replace 1 with something like MatchNo, if
		; you want to design your AI to have varying levels of difficulty.
;IgnoreHitPause = 1

;==================================================================================
;==================================================================================
;==================================================================================


[State -2, NotHitBy]
type = NotHitBy
trigger1 = 1
value2 = , AT
time = -1

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoStandGuard
flag2 = NoCrouchGuard
flag3 = NoAirGuard
ignorehitpause = 1

[State -2, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoWalk
flag2 = NoAutoTurn
ignorehitpause = 1

[State -3, Stage]
type = Helper
trigger1 = stateno != 5900
trigger1 = !numhelper(6000)
name = "s"
id = 6000
stateno = 6000
postype = left
ownpal = 1
size.xscale = 1
size.yscale = 1
supermovetime = 99999
pausemovetime = 99999

[State -2, Helper]
type = Helper
trigger1 = !numhelper(1)
name = "l"
id = 1
stateno = 1
pos = 0, 0
facing = -1
ownpal = 1

[State -2, Helper]
type = Helper
trigger1 = !numhelper(2)
name = "r"
id = 2
stateno = 1
pos = 0, 0
ownpal = 1

[State -2, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0, 0
ignorehitpause = 1

[State -2, HitOverride]
type = HitOverride
trigger1 = 1
attr = SCA, AA, AP, AT
stateno = 9000
ignorehitpause = 1

[State -2, Flinch Var]
type = VarAdd
trigger1 = fvar(6) > 0
trigger1 = hitshakeover
fvar(6) = ifelse(fvar(6) < fvar(7), -fvar(6), -fvar(7))
ignorehitpause = 1

[State -2, Flame Helpers]
type = Helper
trigger1 = numtarget(1050) = 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = target(1050), facing
pos = floor(target(1050), pos x), floor(target(1050), pos y)
ownpal = 1
ignorehitpause = 1

[State -2, Flame Helpers]
type = Helper
trigger1 = numtarget(1050) > 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = enemy(0), facing
pos = floor(enemy(0), pos x), floor(enemy(0), pos y)
ownpal = 1
ignorehitpause = 1

[State -2, Flame Helpers]
type = Helper
trigger1 = numtarget(1050) > 1
trigger1 = numenemy > 1
name = "f"
id = 7005
stateno = 7005
postype = left
facing = enemy(1), facing
pos = floor(enemy(1), pos x), floor(enemy(1), pos y)
ownpal = 1
ignorehitpause = 1

[State -2, Burn]
type = TargetDrop
trigger1 = numtarget(1050)
id = 1050

[State -2, Shock Helpers]
type = Helper
trigger1 = numtarget(1052) = 1
name = "f"
id = 7007
stateno = 7007
postype = left
facing = target(1052), facing
pos = floor(target(1052), pos x), floor(target(1052), pos y)
ownpal = 1
ignorehitpause = 1

[State -2, Shock Helpers]
type = Helper
trigger1 = numtarget(1052) > 1
name = "f"
id = 7007
stateno = 7007
postype = left
facing = enemy(0), facing
pos = floor(enemy(0), pos x), floor(enemy(0), pos y)
ownpal = 1
ignorehitpause = 1

[State -2, Shock Helpers]
type = Helper
trigger1 = numtarget(1052) > 1
trigger1 = numenemy > 1
name = "f"
id = 7007
stateno = 7007
postype = left
facing = enemy(1), facing
pos = floor(enemy(1), pos x), floor(enemy(1), pos y)
ownpal = 1
ignorehitpause = 1

[State -2, Burn]
type = TargetDrop
trigger1 = numtarget(1052)
id = 1052

[State -2, VarSet]
type = VarSet
trigger1 = life > var(12)
var(12) = life
ignorehitpause = 1

[State -2, LifeAdd]
type = LifeAdd
trigger1 = var(12) = lifemax
trigger1 = life > var(12) - var(13)
trigger1 = var(12) := -var(12) || 1
value = -var(12)-var(13)-life

[State -2, LifeAdd]
type = LifeAdd
trigger1 = !time
trigger1 = var(12) < 0
trigger1 = enemynear, name = "D'raven" || enemynear, name = "D'Raven"
trigger1 = enemynear, stateno = 1060
value = -10000/const(data.defence)
ignorehitpause = 1

[State -2, NotHitBy]
type = NotHitBy
trigger1 = var(12) < 0
value = SCA
time = 10

[State -2, VarSet]
type = VarSet
trigger1 = var(12) < 0
var(13) = 0
ignorehitpause = 1

[State -2, VarSet]
type = VarSet
trigger1 = var(12) < 0
var(12) = life
ignorehitpause = 1

[State -2, VarSet]
type = VarSet
trigger1 = win
var(52) = ifelse(var(52), -1, 0)

[State -2, VarSet]
type = VarSet
trigger1 = lose
var(52) = 1 + alive

[State Debug Info]
type = DisplayToClipboard
trigger1 = 1
text = "stun guage %.1f, var(12) %d, fvar(1), %.2f, var(2) %d, var(50) %d"
params = fvar(6), var(12), fvar(1), var(2), var(50)

;---------------------------------------------------------------------------
; States that are executed when in self's state file (use statedef -3)
;---------------------------------------------------------------------------

[Statedef -3]

;==================================================================================
;======| RELACIONADO  AI - AI RELATED |===========================================
;==================================================================================

; Kamek and Luchini appear to have been the first ones to use the IsHomeTeam AI activation concept.
; Feel free to move this controller to your character's intro state for slightly better efficiency.
[State -3, SetAI]
type = VarSet
triggerall = !RoundState
triggerall = IsHomeTeam
trigger1 = (TeamSide = 2)
trigger2 = (MatchNo > 1)
var(59) = 1

; Feel free to move this controller to your character's intro state for slightly better efficiency.
; Note that it may give P2 a slight unfair advantage in simul team vs mode, so you
; may want to disable it.  But then, since when has Mugen been about fairness? =P
[State -3, Unfair]; Is this reliable?
type = VarSet
trigger1 = !RoundState
trigger1 = (var(59) != 1)
trigger1 = NumPartner
trigger1 = (ID > Partner,ID)
trigger1 = (TeamSide = 2)
var(59) = 1

[State -3, AI Helper (Compatibly Partnered Version)]
type = Helper
trigger1 = !var(59)
trigger1 = !NumHelper(9742)
trigger1 = (RoundState = 2)
trigger1 = Alive
trigger1 = NumPartner
trigger1 = Partner,SelfAnimExist(9741)
HelperType = normal
name = "AI Helper (Simul Version)"
ID = 9742
pos = 9999999,99999
StateNo = 9742
KeyCtrl = 1
PauseMoveTime = 999999999
SuperMoveTime = 999999999

; If you want to use the Guard mode, Dummy mode, Distance, or Button jam dummy control
; options in Training mode without activating the dummy's AI while working on your
; character, then all you need to do is temporarily disable this controller.
; Or, if you want to permanently disable this controller in Training mode,
; then you could use the Training mode detection code available on my site
; ( http://www.shinmugen.net/winane/ ), and then just add a "(var(59)&63)>30"
; triggerall to this controller.
[State -3, AI Helper]
type = Helper
triggerall = !var(59)
triggerall = !NumHelper(9741)
triggerall = (RoundState = 2)
triggerall = Alive
trigger1 = !NumPartner
trigger2 = !(Partner,SelfAnimExist(9741))
HelperType = normal
name = "AI Helper"
ID = 9741
pos = 9999999,99999
StateNo = 9741
KeyCtrl = 1
PauseMoveTime = 999999999
SuperMoveTime = 999999999

[State -3, TurnBackOnAI]
type = VarSet
trigger1 = (var(59) = -2)
trigger1 = (RoundState = 2)
trigger1 = Alive
var(59) = 1

[State -3, HitPauseTime Helper]
type = Helper
triggerall = var(59)!=1
triggerall = !NumHelper(9743)
triggerall = (RoundState = 2)
triggerall = Alive
trigger1 = (MatchNo = 1)
trigger2 = NumPartner
trigger2 = (ID > Partner,ID)
HelperType = normal
name = "HitPauseTime"
ID = 9743
pos = 9999999,99999
StateNo = 9743
PauseMoveTime = 999999999
SuperMoveTime = 999999999

; According to Roque, this method works in Linux Mugen version 2002.04.14,
; whereas the old humanly-impossible commands method does not.
; It is very important that this controller NOT be moved to State -2.
; Note that this part won't work if AI.Cheat is turned off in mugen.cfg.
[State -3, XOR]
type = VarSet
triggerall = var(59)!=1
triggerall = (var(57) = GameTime-1)
triggerall = NumHelper(9743)
triggerall = !(Helper(9743),var(1))
trigger1 = (command = "a") ^^ (command = "a2")
trigger2 = (command = "b") ^^ (command = "b2")
trigger3 = (command = "c") ^^ (command = "c2")
trigger4 = (command = "x") ^^ (command = "x2")
trigger5 = (command = "y") ^^ (command = "y2")
trigger6 = (command = "z") ^^ (command = "z2")
trigger7 = (command = "start") ^^ (command = "start2")
trigger8 = (command = "holda") ^^ (command = "holda2")
trigger9 = (command = "holdb") ^^ (command = "holdb2")
trigger10 = (command = "holdc") ^^ (command = "holdc2")
trigger11 = (command = "holdx") ^^ (command = "holdx2")
trigger12 = (command = "holdy") ^^ (command = "holdy2")
trigger13 = (command = "holdz") ^^ (command = "holdz2")
trigger14 = (command = "holdstart") ^^ (command = "holdstart2")
trigger15 = (command = "holdfwd") ^^ (command = "holdfwd2")
trigger16 = (command = "holdback") ^^ (command = "holdback2")
trigger17 = (command = "holdup") ^^ (command = "holdup2")
trigger18 = (command = "holddown") ^^ (command = "holddown2")
trigger19 = (command = "recovery") ^^ (command = "recovery2")
;Add more as desired. (See my notes in the CMD.)
var(59) = 1

; It is very important that this controller NOT be moved to State -2, as putting
; it there would defeat the entire purpose of the controller, allowing the
; helper method or the XOR method to erroneously set the AI variable.
; And within State -3, don't put any ChangeState controllers before this
; controller, lest you unnecessarily delay your character's AI activation.
[State -3, GameTimeVar]
type = VarSet
trigger1 = 1
var(57) = GameTime
IgnoreHitPause = 1

; Within StateDef -3, none of your own AI-related code should come after the code
; provided here (and putting it before the code is also generally a bad idea).
; It's better to use State -1 (or, in special circumstances, State -2) instead.

;==================================================================================
;==================================================================================
;==================================================================================

[State -3, VarSet]
type = VarSet
trigger1 = stateno != [9000, 9001]
var(2) = stateno 
ignorehitpause = 1

[State -3, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State -3, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = NoAutoTurn
ignorehitpause = 1

[State -3, Camera]
type = Helper
trigger1 = !numhelper(6001)
name = "c"
id = 6001
stateno = 6001
facing = facing
ownpal = 1

[State -3, Turn]
type = Turn
trigger1 = facing != var(4)
ignorehitpause = 1

[State -3, PosSet]
type = PosSet
trigger1 = stateno = 0 || stateno > 9100
trigger1 = numhelper(6000)
trigger1 = pos x - helper(6000), pos x != [-480, 480]
x = helper(6000), pos x + ifelse(pos x < helper(6000), pos x, -480, 480)

[State -3, ChangeState]
type = ChangeState
trigger1 = movetype != H
trigger1 = !alive
trigger1 = stateno != 5150
trigger1 = var(0) := 1
value = 5150
ignorehitpause = 1
