; KFM's constants and state file.
; There are comments scattered through this file, so you may like to
; take a look if would like to learn more about the cns.

; これはKFMの定数と状態のファイルです。
; このファイルの中には注釈が散らされているので、CNSを習いたいお方は
; 読んでみたらいいです。

[Data]
;Amount of life to start with
;体力ゲージの初期値
life = 1000
;attack power (more is stronger)
;攻撃ダメージ
attack = 100
;defensive power (more is stronger)
;体力パワー
defence = 90
;Percentage to increase defense everytime player is knocked down
fall.defence_up = 70
;Time which player lies down for, before getting up
liedown.time = 60
;Number of points for juggling
airjuggle = 17
;Default hit spark number for HitDefs
sparkno = 2
;Default guard spark number
guard.sparkno = 40
;1 to enable echo on KO
KO.echo = 0
;Volume offset (negative for softer)
volume = 255
;Variables with this index and above will not have their values
;reset to 0 between rounds or matches. There are 60 int variables,
;indexed from 0 to 59, and 40 float variables, indexed from 0 to 39.
;If omitted, then it defaults to 60 and 40 for integer and float
;variables repectively, meaning that none are persistent, i.e. all
;are reset. If you want your variables to persist between matches,
;you need to override state 5900 from common1.cns.
IntPersistIndex = 40,45,59	;Set this to at most the index of your primary AI variable.
FloatPersistIndex = 40

[Size]
xscale = 1           ;Horizontal scaling factor.
yscale = 1           ;Vertical scaling factor.
ground.back = 15     ;Player width (back, ground)
ground.front = 16    ;Player width (front, ground)
air.back = 12        ;Player width (back, air)
air.front = 12       ;Player width (front, air)
height = 60          ;Height of player (for opponent to jump over)
attack.dist = 160    ;Default attack distance
proj.attack.dist = 90 ;Default attack distance for projectiles
proj.doscale = 0     ;Set to 1 to scale projectiles too
head.pos = -5, -90   ;Approximate position of head
mid.pos = -5, -60    ;Approximate position of midsection
shadowoffset = 0     ;Number of pixels to vertically offset the shadow
draw.offset = 0,0    ;Player drawing offset in pixels (x, y)

[Velocity]
walk.fwd  = 2.6      ;Walk forward
walk.back = -2.4     ;Walk backward
run.fwd  = 4.8, 0    ;Run forward (x, y)
run.back = -4.5,-3.8 ;Hop backward (x, y)
jump.neu = 0,-8.4    ;Neutral jumping velocity (x, y)
jump.back = -2.55    ;Jump back Speed (x, y)
jump.fwd = 2.5       ;Jump forward Speed (x, y)
runjump.back = -2.55,-8.1 ;Running jump speeds (opt)
runjump.fwd = 4,-8.1      ;.
airjump.neu = 0,-8.1      ;.
airjump.back = -2.55      ;Air jump speeds (opt)
airjump.fwd = 2.5         ;.

[Movement]
airjump.num = 1      ;Number of air jumps allowed (opt)
airjump.height = 35  ;Minimum distance from ground before you can air jump (opt)
yaccel = .44         ;Vertical acceleration
stand.friction = .85  ;Friction coefficient when standing
crouch.friction = .82 ;Friction coefficient when crouching

;---------------------------------------------------------------------------
; Variable usage:
; This is a record of the variables that KFM uses. Keeping a record of your
; variable usage helps you avoid careless mistakes later.
; var(1)  - Used in kfm.cmd for combo condition (updated every tick)
; var(2)  - Used in Kung Fu Throw (state 800) to remember if fwd was being
;           held (remembered from state 800 through state 810).
; var(10) - GANKBANK
; var(20) - dizzy
; var(21) - skill gauge
; var(22) - gunfire full-screenammo gauge
; var(24) - life before GANKBANK
; var(25) - hits to count (not) to the combo damage dampender
; var(26) - hits to count (not) to the combo announcer
; var(30) - instant kill mode on/off
; var(31) - instant kill used?
; var(32) - instant kill timer

; var(40) - The non-persistent weapon
; var(45) - Which weapon?
; var(46) - special winpose
; var(50) - AI ANTI-MINDGAME = Guard
; fvar(14) - damage dampender
; fvar(15) - damage dampender
; fvar(30) - combo announcer

;---------------------------------------------------------------------------
; Lose by Time Over
; CNS difficulty: basic
; CNS レベル: 基本
[Statedef 170]
type = S
ctrl = 0
anim = 170
velset = 0,0

[State 0, ]
type = PlaySnd
trigger1 = Time = 20
value = S2,39
volume = 255

[State 170, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win state decider
; CNS difficulty: basic
; CNS レベル: 基本
[Statedef 180]
type = S

[State 180, 1]
type = ChangeState
triggerall = Time = 0
triggerall = MatchOver = 1
trigger1 = var(46) = 1
value = 188

[State 180, 1]
type = ChangeState
triggerall = Time = 0
triggerall = MatchOver = 1
trigger1 = var(46) = 2
value = 189

[State 180, 1]
type = ChangeState
trigger1 = Time = 0
value = ifelse(random<500,181,182)

;---------------------------------------------------------------------------
; Win pose 1 - Bow
; CNS difficulty: basic
; CNS レベル: 基本
[Statedef 181]
type = S
ctrl = 0
anim = 181
velset = 0,0

[State 0, ]
type = PlaySnd
trigger1 = Animelem = 6
value = S0,2

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 7
value = S2,ifelse(random<500,9,26)

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Win pose 2 - You suck
; CNS difficulty: basic
; CNS レベル: 基本
[Statedef 182]
type = S
ctrl = 0
anim = 182
velset = 0,0

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 3
value = S2,20

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Kfm Win POse
[Statedef 188]
type = S
ctrl = 0
anim = 188
velset = 0,0

[State 0, ]
type = AssertSpecial
trigger1 = time = [0,200]
flag = roundnotover

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 6
value = S2,22

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1

;---------------------------------------------------------------------------
; Ahuron/Beppu Wining
[Statedef 189]
type = S
ctrl = 0
anim = 9741
velset = 0,0

[State 0, ]
type = AssertSpecial
trigger1 = time = [0,220]
flag = roundnotover

[State 0, ]
type = Explod
trigger1 = Time = 0
anim = 20
pos = 0,0
postype = p1
facing = -1
vel = -2,0
removetime = 200
shadow = 255,255,255
ignorehitpause = 1

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S2,19

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S2,19

[State 181, 1]
type = NotHitBy
trigger1 = 1
value = SCA
time = 1


;---------------------------------------------------------------------------
; PREINTRO
[Statedef 190]
type = S
ctrl = 0
velset = 0,0

[State 0, ]
type = VarRandom
trigger1 = Time = 0
v = 0
range = 1,4

[State 190, 2] ; Special Intros
type = ChangeState
triggerall = Time = 0
trigger1 = p2name = "Shadow Dio" || p4name = "Shadow Dio"
trigger2 = p2name = "Ky Kiske" || p4name = "Ky Kiske"
trigger3 = p2name = "Vanilla H(beta)" || p4name = "Vanilla H(beta)"
trigger4 = p2name = "Kung Fu Man" || p4name = "Kung Fu Man"
trigger5 = p2name = "Thanos" || p4name = "Thanos"
trigger6 = p2name = "Ex-Inferis" || p4name = "Ex-Inferis"
trigger7 = p2name = "Kung Fu Dude" || p4name = "Kung Fu Dude"
trigger8 = p2name = "Evil Kung Fu Man" || p4name = "Evil Kung Fu Man"
trigger9 = p2name = "RoboCop" || p4name = "RoboCop"
trigger10 = p2name = "Hana" || p4name = "Hana"
trigger11 = p2name = "Akane Satomura"
trigger12 = p2name = "Ayu Tukimiya"
trigger13 = p2name = "Ikumi"
trigger14 = p2name = "kanna"
trigger15 = p2name = "Kano"
trigger16 = p2name = "Kaori Misaka"
trigger17 = p2name = "Mai"
trigger18 = p2name = "Mai_K"
trigger19 = p2name = "Mai Kawasumi"
trigger20 = p2name = "Makoto Sawatari"
trigger21 = p2name = "Mayu"
trigger22 = p2name = "Mishio"
trigger23 = p2name = "Michiru"
trigger24 = p2name = "Minagi"
trigger25 = p2name = "Minis Mahn"
trigger26 = p2name = "Misaki Kawana"
trigger27 = p2name = "Misaki Kawana"
trigger28 = p2name = "Misio Amano"
trigger29 = p2name = "Misuzu"
trigger30 = p2name = "Misuzu_K"
trigger31 = p2name = "Mizuka Nagamori"
trigger32 = p2name = "Mizuka"
trigger33 = p2name = "mutumi"
trigger34 = p2name = "nanase"
trigger35 = p2name = "EXnanase"
trigger36 = p2name = "Nayuki Minase"
trigger37 = p2name = "Sayuri Kurala"
trigger38 = p2name = "Sayuri"
trigger39 = p2name = "Sayuri Kurata"
trigger40 = p2name = "shiori"
trigger41 = p2name = "UNKNOWN"
trigger42 = p2name = "Alice Margatroid"
trigger43 = p2name = "Reimu Hakurei"
trigger44 = p2name = "PATCHOULI"
trigger45 = p2name = "Patchouli Knowledge"
trigger46 = p2name = "Marisa"
trigger47 = p2name = "remilia scarlet"
trigger48 = p2name = "youmu_k"
trigger49 = p2name = "MVC2 UNKNOWN"
trigger50 = p2name = "Youmu_Konpaku"
trigger51 = p2name = "Kira Daidohji" || p4name = "Kira Daidohji"
trigger52 = p2name = "Zangief Steel" || p4name = "Zangief Steel"
trigger53 = p2name = "Tsunade" || p4name = "Tsunade"
trigger54 = p2name = "Perfect Weapon Mb-02" || p4name = "Perfect Weapon Mb-02"
trigger55 = p2name = "Kim Kaphwan" || p4name = "Kim Kaphwan"
trigger56 = p2name = "Evil Ken" || p4name = "Evil Ken"
trigger57 = p2name = "Evil Ryu" || p4name = "Evil Ryu"
trigger58 = p2name = "Evil Dan" || p4name = "Evil Dan"
trigger59 = p2name = "Rare Akuma" || p4name = "Rare Akuma"
trigger60 = p2name = "Devil Daigo" || p4name = "Devil Daigo"
trigger61 = enemynear, authorname = "⑨"
trigger62 = p2name = "Elque" || p4name = "Elque"
trigger63 = p2name = "Ikkyu" || p4name = "Ikkyu"
trigger64 = p2name = "Giygas" || p4name = "Giygas"
trigger65 = p2name = "La=Gooth" || p4name = "La=Gooth"
trigger66 = p2name = "Kuromaru" || p4name = "Kuromaru"
trigger67 = p2name = "Missingno" || p4name = "Missingno"
trigger68 = p2name = "jinmen" || p4name = "jinmen"
trigger69 = p2name = "RaveEx" || p4name = "RaveEx"
trigger70 = p2name = "Dirty Kung Fu Man" || p4name = "Dirty Kung Fu Man"
trigger71 = p2name = "Sonic Machine" || p4name = "Sonic Machine"
trigger72 = p2name = "War Machine" || p4name = "War Machine"
trigger73 = p2name = "Iron Man" || p4name = "Iron Man"
trigger74 = p2name = "Bola" || p4name = "Bola"
trigger75 = p2name = "Dialog" || p4name = "Dialog"
trigger76 = p2name = "Developer Fags You Imbecile" || p4name = "Developer Fags You Imbecile"
trigger77 = p2name = "Kung Fu Marvel" || p4name = "Kung Fu Marvel"
trigger78 = p2name = "Rion" || p4name = "Rion"
trigger79 = p2name = "Sonso" || p4name = "Sonso"
trigger80 = p2name = "Blue" || p4name = "Blue"
trigger81 = p2name = "NEW NI66A" || p4name = "NEW NI66A"
trigger82 = p2name = "niggah" || p4name = "niggah"
trigger83 = p2name = "slime" || p4name = "slime"
trigger84 = p2name = "Zeeky H. Bomb" || p4name = "Zeeky H. Bomb"
trigger85 = p2name = "Dink Smallwood" || p4name = "Dink Smallwood"
trigger86 = p2name = "Batman" || p4name = "Batman"
trigger87 = p2name = "Lucy Fernandez" || p4name = "Lucy Fernandez"
trigger88 = p2name = "cvsyoko" || p4name = "cvsyoko"
trigger89 = p2name = "ming-vase" || p4name = "ming-vase"
trigger90 = p2name = "BDI_CvS2Mai" || p4name = "BDI_CvS2Mai"
trigger91 = p2name = "Mai" || p4name = "Mai"
trigger92 = p2name = "Mai Shiranui" || p4name = "Mai Shiranui"
trigger93 = p2name = "Rorschach" || p4name = "Rorschach"
trigger94 = p2name = "Sakuya Izayoi" || p4name = "Sakuya Izayoi"
trigger94 = p2name = "Kung Fu Bender" || p4name = "Kung Fu Bender"
trigger94 = p2name = "Kung Fu Fan" || p4name = "Kung Fu Fan"
value = 199

[State 190, 2] ; Bebum Ryo
type = ChangeState
trigger1 = p2name = "BebumRyo"
trigger1 = p2stateno = 922
value = 1971

[State 190, 2] ; K.O.D.
type = ChangeState
triggerall = Time = 0
trigger1 = enemynear, authorname = "K.O.D"
trigger2 = enemynear, authorname = "K.O.D & Vans"
value = 198

[State 190, 1]
type = ChangeAnim
trigger1 = SelfAnimExist(190)
value = 190

[State 190, 2] ;Go straight to intro.
type = ChangeState
trigger1 = Time = 0
value = 190 + var(0)

;---------------------------------------------------------------------------
; Introduction
; CNS difficulty: basic
; CNS レベル: 基本
[Statedef 191]
type = S
ctrl = 0
anim = 190
velset = 0,0

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 190

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

; You can delete the following two controllers if you're building your own
; character using KFM. These are the wood pieces that KFM kicks.
; これがKFMが蹴る木の板です。KFMのCNSを貴方のキャラに利用しているなら、
; 下にある二つのコントロラーを消したらいいです。
[State 191, Wood 1]
type = Explod
trigger1 = RoundState != 0
persistent = 0
anim = 191
postype = p1
pos = 260, -90
velocity = -4.2, -7
accel = 0, .32
removetime = 48

[State 191, Wood 2]
type = Explod
trigger1 = AnimElemTime(7) = 1
anim = 192
postype = p1
pos = 60, -70
velocity = 2, -4
accel = 0, .32
removetime = 35

; You can delete the following two controllers if you're building your own
; character using KFM. These play back the sounds of the wood block being
; broken.
[State with voice]
type = PlaySnd
trigger1 = AnimElem = 7
value = F5,2
volume = -40

[State 191, Snd 2]
type = PlaySnd
trigger1 = AnimElemTime(7) = 3
value = F5,3
volume = -80

[State with voice]
type = PlaySnd
trigger1 = AnimElem = 5
value = S2,ifelse(random<500,0,1)
channel = 0

;---------------------------------------------------------------------------
; Intro 2
[Statedef 192]
type = S
ctrl = 0
anim = 195
velset = 0,0

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 195

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

[State 0, ]
type = PlaySnd
trigger1 = Time = 10
value = S2,ifelse(Random<500,10,11)
channel = 0

;---------------------------------------------------------------------------
; Intro 3
[Statedef 193]
type = S
ctrl = 0
anim = 193
velset = 0,0

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
value = 193

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 2
value = S2,21
channel = 0

;---------------------------------------------------------------------------
; Funny Introduction
; CNS difficulty: not-so-basic-as-you-think
; CNS レベル: 基本
[Statedef 194]
type = S
movetype = A
ctrl = 0
anim = 190
velset = 0,0

[State 191, Freeze anim] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = RoundState = 0
trigger2 = p2stateno = [190,199]
trigger2 = time < 350
value = 190

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State with voice]
type = PlaySnd
trigger1 = anim = 190
trigger1 = AnimElem = 5
value = S2,ifelse(random<500,0,1)
channel = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 2
trigger1 = anim = 170
value = S2,35
channel = 0

[State 191, Freeze anim] ;Freeze animation until PreIntro is over
type = ChangeAnim
trigger1 = p2stateno = [1940,1949]
trigger1 = anim = 190
trigger1 = animtime = 0
value = 170

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = p2stateno != [1940,1949]
trigger1 = anim = 190
trigger1 = AnimTime = 0
value = 0

; You can delete the following two controllers if you're building your own
; character using KFM. These are the wood pieces that KFM kicks.
; これがKFMが蹴る木の板です。KFMのCNSを貴方のキャラに利用しているなら、
; 下にある二つのコントロラーを消したらいいです。
[State 191, Wood 1]
type = Explod
triggerall = RoundState != 0
triggerall = anim = 190
trigger1 = p2stateno != [190,199]
trigger2 = time >= 350
persistent = 0
anim = 191
postype = p1
pos = 260, -90
velocity = -4.2, -7
accel = 0, .32
removetime = 48

[State 210, 2]
type = HitDef
triggerall = anim = 190
trigger1 = !movecontact
attr = A, HP
animtype  = Hard
damage    = 0
guardflag = 
pausetime = 0,0
sparkno = -1
sparkxy = 0,0
hitsound   = -1
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 13
ground.velocity = -5.5
air.velocity = -2.5,-4
p2stateno = 1949

[State 0, ]
type = Helper
triggerall = anim = 190
trigger1 = AnimElemTime(7) = 1
helpertype = normal
name = "Woody Allen"
pos = 60,-70
postype = p1
facing = 1
stateno = 1941
ownpal = 1
ignorehitpause = 1

; You can delete the following two controllers if you're building your own
; character using KFM. These play back the sounds of the wood block being
; broken.
[State with voice]
type = PlaySnd
triggerall = anim = 190
trigger1 = AnimElem = 7
value = F5,2
volume = -40

;---------------------------------------------------------------------------
; The projectile that makes the intro funny
[Statedef 1941]
type = A
movetype = A
physics = N
ctrl = 0
anim = 191
velset = 5,0

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = intro

[State 210, 2]
type = HitDef
trigger1 = movecontact = 0
attr = A, HP
animtype  = Hard
damage    = 0
guardflag = 
pausetime = 0,0
sparkno = 3
sparkxy = 0,0
hitsound   = 5,0
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 13
ground.velocity = -5.5
air.velocity = -2.5,-4
p2stateno = 1945

[State 0, ]
type = DestroySelf
trigger1 = frontedgedist < -20

;---------------------------------------------------------------------------
[Statedef 1945]
type = S
movetype = H
physics = S
ctrl = 0
velset = 0,0

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = intro

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
value = 5012

[State 0, ]
type = ChangeAnim
trigger1 = Anim = 5012
trigger1 = animtime = 0
value = 5017

[State 0, ]
type = ChangeState
trigger1 = Time >= 40
value = 1946

;---------------------------------------------------------------------------
[Statedef 1946]
type = S
movetype = H
physics = S
ctrl = 0
velset = 0,0

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = intro

[State 0, ]
type = Turn
trigger1 = Time = 0

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
trigger1 = selfanimexist(5)
value = 5

[State 0, ]
type = ChangeState
trigger1 = animtime = 0
trigger2 = !selfanimexist(5)
value = 1947

;---------------------------------------------------------------------------
[Statedef 1947]
type = S
movetype = H
physics = S
ctrl = 0
velset = 0,0

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = intro

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
value = 20

[State 0, ]
type = VelSet
trigger1 = 1
x = const(velocity.walk.fwd.x)

;---------------------------------------------------------------------------
[Statedef 1949]
type = S
movetype = I
physics = S
ctrl = 0
velset = 0,0

[State 0, ]
type = Turn
trigger1 = Time = 0

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
trigger1 = selfanimexist(5)
value = 5

[State 0, ]
type = SelfState
triggerall = Time >= 5
trigger1 = animtime = 0
trigger2 = !selfanimexist(5)
value = 0
ctrl = 0

;---------------------------------------------------------------------------
; Special Intro 3
[Statedef 1971]
type = S
ctrl = 0
anim = 1971
velset = 0,0

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro
flag2 = nobardisplay

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 22
value = S2,50
channel = 0
volume = 255

[State BLAM]
type = Helper
trigger1 = animelem = 28
helpertype = normal
name = "BLAM"
ID = 4550
stateno = 4550
pos = 0,0
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
ignorehitpause = 1


;---------------------------------------------------------------------------
; Special Intro 2
[Statedef 198]
type = S
ctrl = 0
anim = 1988
velset = 0,0

[State 191, 1] ;Freeze animation until PreIntro is over
type = ChangeAnim
triggerall = time <= 300
trigger1 = RoundState = 0
trigger2 = p2stateno = [190,195]
value = 1988

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 2
value = S2,18
channel = 0


;---------------------------------------------------------------------------
; Special Intro 1
[Statedef 199]
type = S
ctrl = 0
anim = 198
velset = 0,0

[State 0, ]
type = Explod
trigger1 = Time = 40
anim = 199
pos = 0,-123
postype = p1
ontop = 1
ownpal = 1
scale = .5,.5

[State 0, ]
type = PlaySnd
trigger1 = Time = 40
value = S0,22

;What Does he saying?

[State against KFM]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Kung Fu Man" || p4name = "Kung Fu Man"
anim = 19900
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against some EFZ ( and possibly few Touhou) characters]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
;trigger1 = p2name = "Kohaku By Toshi" || p4name = "Kohaku By Toshi"
trigger1 = p2name = "Akane Satomura"
trigger2 = p2name = "Ayu Tukimiya"
trigger3 = p2name = "Ikumi"
trigger4 = p2name = "kanna"
trigger5 = p2name = "Kano"
trigger6 = p2name = "Kaori Misaka"
trigger7 = p2name = "Mai"
trigger8 = p2name = "Mai_K"
trigger9 = p2name = "Mai Kawasumi"
trigger10 = p2name = "Makoto Sawatari"
trigger11 = p2name = "Mayu"
trigger12 = p2name = "Mishio"
trigger13 = p2name = "Michiru"
trigger14 = p2name = "Minagi"
trigger15 = p2name = "Minis Mahn"
trigger16 = p2name = "Misaki Kawana"
trigger17 = p2name = "Misaki Kawana"
trigger18 = p2name = "Misio Amano"
trigger19 = p2name = "Misuzu"
trigger20 = p2name = "Misuzu_K"
trigger21 = p2name = "Mizuka Nagamori"
trigger22 = p2name = "Mizuka"
trigger23 = p2name = "mutumi"
trigger24 = p2name = "nanase"
trigger25 = p2name = "EXnanase"
trigger26 = p2name = "Nayuki Minase"
trigger27 = p2name = "Sayuri Kurala"
trigger28 = p2name = "Sayuri"
trigger29 = p2name = "Sayuri Kurata"
trigger30 = p2name = "shiori"
trigger31 = p2name = "UNKNOWN"
trigger32 = p2name = "Alice Margatroid"
trigger33 = p2name = "Reimu Hakurei"
trigger34 = p2name = "PATCHOULI"
trigger35 = p2name = "Patchouli Knowledge"
trigger36 = p2name = "Marisa"
trigger37 = p2name = "remilia scarlet"
trigger38 = p2name = "youmu_k"
trigger39 = p2name = "MVC2 UNKNOWN"
trigger40 = p2name = "Youmu_Konpaku"
trigger41 = p2name = "Kira Daidohji" || p4name = "Kira Daidohji"
trigger42 = p2name = "Zangief Steel" || p4name = "Zangief Steel"
trigger43 = p2name = "Tsunade" || p4name = "Tsunade"
trigger44 = p2name = "Sakuya Izayoi" || p4name = "Sakuya Izayoi"
anim = 19901
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against potential litigators]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Perfect Weapon Mb-02" || p4name = "Perfect Weapon Mb-02"
trigger2 = p2name = "RoboCop" || p4name = "RoboCop"
trigger3 = p2name = "Hana" || p4name = "Hana"
trigger4 = p2name = "Kim Kaphwan" || p4name = "Kim Kaphwan"
anim = 19902
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against other famous "evil" characters]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Evil Ken" || p4name = "Evil Ken"
trigger2 = p2name = "Evil Ryu" || p4name = "Evil Ryu"
trigger3 = p2name = "Evil Dan" || p4name = "Evil Dan"
trigger4 = p2name = "Rare Akuma" || p4name = "Rare Akuma"
trigger5 = p2name = "Devil Daigo" || p4name = "Devil Daigo"
anim = 19903
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against 9's MB/BBB conversions]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = enemynear, authorname = "⑨"
anim = 19904
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against what EKFM believes to be his past incarnations]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Kung Fu Dude" || p4name = "Kung Fu Dude"
trigger2 = p2name = "Elque" || p4name = "Elque"
trigger3 = p2name = "Ikkyu" || p4name = "Ikkyu"
trigger4 = p2name = "Giygas" || p4name = "Giygas"
trigger5 = p2name = "La=Gooth" || p4name = "La=Gooth"
trigger6 = p2name = "Kuromaru" || p4name = "Kuromaru"
trigger7 = p2name = "Missingno" || p4name = "Missingno"
trigger8 = p2name = "jinmen" || p4name = "jinmen"
anim = 19905
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against ravenous]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Ex-Inferis" || p4name = "Ex-Inferis"
trigger2 = p2name = "RaveEx" || p4name = "RaveEx"
anim = 19906
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against MM's old EKFM]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Evil Kung Fu Man" || p4name = "Evil Kung Fu Man"
trigger1 = enemynear, authorname = "Most Mysterious"
trigger1 = ishometeam != 1
anim = 19907
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against this current EKFM]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Evil Kung Fu Man" || p4name = "Evil Kung Fu Man"
trigger1 = enemynear, authorname = "The_None"
trigger1 = ishometeam = 1
anim = 19908
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against other EKFM edits (including Garionfields)]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Evil Kung Fu Man" || p4name = "Evil Kung Fu Man"
trigger1 = enemynear, authorname != "The_None"
trigger1 = enemynear, authorname != "Most Mysterious"
trigger2 = p2name = "Dirty Kung Fu Man" || p4name = "Dirty Kung Fu Man"
trigger2 = ishometeam != 1
anim = 19915
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against whoever EKFM thinks has the Protton Cannon]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Sonic Machine" || p4name = "Sonic Machine"
trigger2 = p2name = "War Machine" || p4name = "War Machine"
trigger3 = p2name = "Iron Man" || p4name = "Iron Man"
anim = 19909
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against threats to his sanity]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Bola" || p4name = "Bola"
trigger2 = p2name = "Dialog" || p4name = "Dialog"
trigger3 = p2name = "Developer Fags You Imbecile" || p4name = "Developer Fags You Imbecile"
trigger4 = p2name = "Kung Fu Marvel" || p4name = "Kung Fu Marvel"
trigger5 = p2name = "Rion" || p4name = "Rion"
trigger6 = p2name = "Sonso" || p4name = "Sonso"
trigger7 = p2name = "Blue" || p4name = "Blue"
trigger8 = p2name = "NEW NI66A" || p4name = "NEW NI66A"
trigger9 = p2name = "niggah" || p4name = "niggah"
trigger10 = p2name = "slime" || p4name = "slime"
trigger11 = p2name = "Zeeky H. Bomb" || p4name = "Zeeky H. Bomb"
anim = 19910
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against Dink Smallwood]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Dink Smallwood" || p4name = "Dink Smallwood"
anim = 19911
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against The Goddamn Batman]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Batman" || p4name = "Batman"
anim = 19913
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against delicious boobies]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Lucy Fernandez" || p4name = "Lucy Fernandez"
trigger2 = p2name = "cvsyoko" || p4name = "cvsyoko"
trigger3 = p2name = "ming-vase" || p4name = "ming-vase"
trigger4 = p2name = "BDI_CvS2Mai" || p4name = "BDI_CvS2Mai"
trigger5 = p2name = "Mai" || p4name = "Mai"
trigger6 = p2name = "Mai Shiranui" || p4name = "Mai Shiranui"
anim = 19914
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against delicious boobGAWDEMMITRORSCHACHINEARLYFELLFORYOUMUCHTOYOURDISMAY]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Rorschach" || p4name = "Rorschach"
anim = 19916
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State against KFM's following]
type = Explod
triggerall = numexplod(1999) = 0
triggerall = AnimTime = 0
trigger1 = p2name = "Kung Fu Fan" || p4name = "Kung Fu Fan"
trigger2 = p2name = "Kung Fu Bender" || p4name = "Kung Fu Bender"
anim = 199177
ID = 1999
pos = 0,0
postype = left
bindtime = -1
scale = .5, .5
ontop = 1
ownpal = 1
ignorehitpause = 1

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = Intro

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0


;---------------------------------------------------------------------------
; Taunt
; CNS difficulty: easy
[Statedef 195]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2
poweradd = ifelse(prevstateno!=3901,150,0)

[State 0, ]
type = PlaySnd
triggerall = prevstateno != 3901
trigger1 = Time = 0
trigger1 = random < 500
value = S2,10
channel = 0

[State 0, ]
type = PlaySnd
triggerall = prevstateno = 3901
trigger1 = Time = 0
trigger1 = random < 500
value = S2,13
channel = 0

[State 0, ]
type = NotHitBy
trigger1 = prevstateno = 3901
value = SCA
time = 5

[State 195, 1]
type = CtrlSet
trigger1 = Time = 40
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Insta-kill switch
[Statedef 19666]
type = S
ctrl = 0
anim = 195
velset = 0,0
movetype = I
physics = S
sprpriority = 2

[State 0, ]
type = SuperPause
trigger1 = time = 0
time = 40
anim = -1
movetime = 40

[State 0, ]
type = VarSet
trigger1 = time = 0
v = 32
value = ifelse(var(30)=0,power,0)
ignorehitpause = 1

[State 0, ]
type = VarSet
trigger1 = time = 0
v = 30
value = ifelse(var(30)=0,1,0)
ignorehitpause = 1

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S0,26
channel = 0

[State 0, ]
type = NotHitBy
trigger1 = 1
value = SCA

[State 195, 1]
type = CtrlSet
trigger1 = Time = 40
value = 1

[State 195, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Stand Light Punch
; CNS difficulty: easy
[Statedef 200]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air
juggle  = 1                      ;Number of air juggle points move takes
;Commonly-used controllers:
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 200                       ;Change animation (Def: no change)
poweradd = 20                    ;Power to add (Def: 0)
sprpriority = 2                  ;Set layering priority to 2 (in front)

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,2
channel = 0

[State 200, 1]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA                     ;Attribute: Standing, Normal Attack
damage = 20, 0                   ;Damage that move inflicts, guard damage
animtype = Light                 ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag = MA                   ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
priority = 3, Hit                ;Attack priority: 0 (least) to 7 (most), 4 default
;Hit/Miss/Dodge type (Def: Hit)
pausetime = 8, 8                 ;Time attacker pauses, time opponent shakes
sparkno = 0                      ;Spark anim no (Def: set above)
sparkxy = -10, -76               ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = 5, 0                  ;Sound to play on hit
guardsound = 6, 0                ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 5             ;Time that the opponent slides back
ground.hittime  = 10             ;Time opponent is in hit state
guard.hittime  = 5
ground.velocity = -4             ;Velocity at which opponent is pushed
airguard.velocity = -1.9,-.8     ;Guard velocity in air (def: (air.xvel*1.5, air.yvel/2))
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = -1.4,-3           ;X-velocity at which opponent is pushed,
;Y-velocity at which opponent is pushed
air.hittime = 12                 ;Time before opponent regains control in air

[State 200, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 200, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing overhead
[Statedef 205]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 85
ctrl = 0
velset = 0,0
anim = 205
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,49
channel = 0

[State 210, Width]
type = Width
trigger1 = (AnimElemTime (3) >= 0) && (AnimElemTime (6) < 0)
value = 17,0

[State 210, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[State 210, 2]
type = HitDef
trigger1 = prevstateno = [200,499]
trigger1 = AnimElem = 4
attr = S, NA
animtype  = hard
damage    = 66
guardflag = MA
pausetime = 12,12
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,3
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 16
guard.hittime  = 8
ground.velocity = -6.2
air.velocity = -2.5,-4
[State 210, 2]
type = HitDef
trigger1 = prevstateno != [200,499]
trigger1 = AnimElem = 4
attr = S, NA
animtype  = hard
damage    = 79
guardflag = HA
pausetime = 12,12
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,3
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 19
guard.hittime  = 8
ground.velocity = -8
air.velocity = -2.5,4
air.fall = 1

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Standing strong punch
; CNS difficulty: easy
; Note the width controller. It makes KFM's push box larger, so he doesn't
; stand so close to the opponent. Hit Ctrl-C and look at the red bar at his
; feet.
; The sprpriority for this state is at -1, instead of the usual 2 for
; attacks. This makes KFM appear behind the opponent initially.
; The SprPriority controller in [State 210, 4] brings KFM to the front when
; his arm has swung over.
; To stop KFM from pausing in his swing frame, there is a ChangeAnim in
; [State 210, 3] that detects if the hit has come in contact with the
; opponent during that frame, and switches to the next animation element
; (notice the elem=6 parameter). If you don't see what I mean, try commenting
; out that controller, then hit someone with this attack.
[Statedef 210]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 65
ctrl = 0
velset = 0,0
anim = 210
sprpriority = -1

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,3
channel = 0

[State 210, Width]
type = Width
trigger1 = (AnimElemTime (2) >= 0) && (AnimElemTime (7) < 0)
value = 15,0

[State 210, 1]
type = PlaySnd
trigger1 = Time = 5
value = 0, 4

[State 210, 2]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA
animtype  = Medium
damage    = 57
guardflag = MA
pausetime = 12,12
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,2
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 13
guard.hittime  = 6
ground.velocity = -5.5
air.velocity = -2.5,-4

[State 210, 3]
type = ChangeAnim
trigger1 = AnimElemTime(5) > 0 && AnimElemTime(6) <= 0
trigger1 = movecontact
ignorehitpause = 1
persistent = 0
value = 210
elem = 6

[State 210, 4]
type = SprPriority
trigger1 = AnimElem = 5
value = 2

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; KnockDown Move
[Statedef 220]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 65
ctrl = 0
velset = 0,0
anim = 220
sprpriority = -1

[State 0, ]
type = PowerAdd
trigger1 = Time = 0
trigger1 = prevstateno = [120,169]
trigger1 = var(21) < 1000
value = -500
ignorehitpause = 1
[State 0, ]
type = VarAdd
trigger1 = Time = 0
trigger1 = prevstateno = [120,169]
trigger1 = var(21) >= 1000
var(21) = -1000
ignorehitpause = 1
[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
trigger1 = Time = 0
trigger1 = prevstateno = [120,169]
time = 15
add = 0,0,0
mul = 256,256,256
sinadd = 512,512,512,3
invertall = 0
color = 256


[State 0, NotHitBy]
type = NotHitBy
trigger1 = Time = 0
trigger1 = prevstateno = [120,169]
value = SCA,NA,SA,HA,NP,SP,HP
time = 6

[State with voice]
type = PlaySnd
trigger1 = roundstate >= 2
trigger1 = Time = 0
trigger1 = random < 500
value = S2,17
channel = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = roundstate < 2
trigger1 = time = 0
value = S2,ifelse(random<500,38,51)
channel = 0

[State 210, Width]
type = Width
trigger1 = (AnimElemTime (3) >= 0) && (AnimElemTime (8) < 0)
value = 40,-27

[State 210, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 3

[State 210, 2]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA
animtype  = Medium
damage    = ifelse(roundstate!=2,0,80)
guardflag = MA
pausetime = 12,13
sparkno = 1
sparkxy = -10,-70
hitsound   = S0,19
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 13
guard.hittime  = 5
ground.velocity = -5.5
air.velocity = -2.5,-4
fall = 1
fall.recover = 0
;p2stateno = 225
;p2facing = 1
id = 225

[State 0, TargetFacing]
type = TargetFacing
trigger1 = movehit
trigger1 = numtarget(225)
value = -1
ID = 225
ignorehitpause = 1
persistent = 0
[State 0, TargetState]
type = TargetState
trigger1 = movehit
trigger1 = numtarget(225)
;trigger1 = !(target(225),ishelper)
value = 225
ID = 225
ignorehitpause = 1
persistent = 0

[State 210, 4]
type = SprPriority
trigger1 = AnimElem = 3
value = 2

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------
; Hit by Fast Kung Fu Palm - shaking from the hit
; (a custom gethit state)
; See State 1020 for details
[Statedef 225]
type    = A
movetype= H
physics = N
velset = 0,0

[State ****: AfterImage]
type = AfterImage
trigger1 = 1
time = 150
timegap = 1
framegap = 1
length = 60
paladd = 0, 0, 0
palmul = .80, .80, .80
palcontrast = 100,100,100
trans = add
persistent = 0

[State 1025, Anim] ;Custom animation
type = ChangeAnim
trigger1 = 1
value = 5017

[State 1025, State]
type = ChangeState
trigger1 = HitShakeOver = 1
value = 226

;------------------
; Hit by Fast Kung Fu Palm - flying through the air
; (a custom gethit state)
[Statedef 226]
type    = A
movetype= H
physics = N

[State 0, ]
type = AfterImageTime
trigger1 = 1
time = 15

[State 1025, Anim] ;Custom animation
type = ChangeAnim2
trigger1 = Time = 0
value = 225

[State 0, ]
type = VelSet
trigger1 = 1
x = -15
ignorehitpause = 1

[State 1026, No scroll]
type = null;ScreenBound
triggerall = Pos y < -15
trigger1 = BackEdgeBodyDist < 65
trigger2 = FrontEdgeBodyDist < 65
value = 1
movecamera = 0,1

[State 1026, Hit wall]
type = ChangeState
trigger1 = BackEdgeBodyDist <= 10
trigger2 = time >= 300
value = 227

;------------------
; Hit by Fast Kung Fu Palm - hit wall
; (a custom gethit state)
[Statedef 227]
type    = A
movetype= H
physics = N

[State 1027, Pos]
type = PosAdd
trigger1 = Time = 0
x = 10 - BackEdgeBodyDist

[State 1027, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 1027, Spark]
type = Explod
trigger1 = Time = 0
anim = F72
pos = 0, floor (screenpos y) - 50
postype = back
sprpriority = 3

[State 1027, Anim]
type = ChangeAnim
trigger1 = 1
value = 5017

[State 1027, Sound]
type = PlaySnd
trigger1 = Time = 0
value = F5,4

[State 1027, State]
type = ChangeState
trigger1 = time >= 15
value = 228

;------------------
; Hit by Fast Kung Fu Palm - bounce off wall
; (a custom gethit state)
[Statedef 228]
type    = A
movetype= H
physics = N

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
value = 5070

[State 1028, 1]
type = NotHitBy
trigger1 = 1
value = , NA, NP

[State 1028, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -6

[State 1028, Vel X]
type = VelSet
trigger1 = Time = 0
x = 1.6

[State 1028, Gravity]
type = VelAdd
trigger1 = 1
y = .35

[State 1028, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
; Go To the screen
[Statedef 229]
type    = S
physics = S
anim = 100
sprpriority = 1
ctrl = 0

[State 0, ]
type = Turn
trigger1 = frontedgedist <= -10
ignorehitpause = 1

[State 100, 1]
type = VelSet
trigger1 = 1
x = const(velocity.run.fwd.x) * 3

[State 0, ]
type = ScreenBound
trigger1 = 1
value = 0

[State 100, 4]
type = ChangeState
trigger1 = animtime = 0
trigger1 = screenpos x = [0,320]
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing light kick
; CNS difficulty: easy
[Statedef 230]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 22
ctrl = 0
velset = 0,0
anim = 230
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,2
channel = 0

[State 230, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 230, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 26
guardflag = MA
pausetime = 12,12
sparkno = 0
sparkxy = -10,-37
hitsound   = 5,1
guardsound = 6,0
ground.type = Low
ground.slidetime = 10
ground.hittime  = 11
guard.hittime  = 6
ground.velocity = -5
air.velocity = -2.5,-3.5

[State 230, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Chain Saw
[Statedef 235]
type    = S
movetype= A
physics = N
juggle  = 5
poweradd= 80
ctrl = 0
velset = 0,0
anim = 235
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = movehit
value = S2,ifelse(random<333,10,ifelse(random<333,13,27) )
channel = 0
ignorehitpause = 1
persistent = 0

[State 240, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 11

[State 240, 2]
type = HitDef
trigger1 = Timemod = 6,2
attr = S, SA
animtype  = Hard
damage    = 14,ifelse(random<500,1,0)
guardflag = MA
pausetime = 6,6
sparkno = 12
sparkxy = -10,-60
hitsound   = S0,14
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 16
guard.hittime  = 6
ground.velocity = -3
air.velocity = -2.2,-3.2

[State 240, 3]
type = Velset
trigger1 = AnimElem = 3
x = 2.7

[State 240, 3]
type = Velset
trigger1 = AnimElem = 23
x = 0

[State 0, ]
type = VarSet
trigger1 = Time = 0
v = 6
value = 0

[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Standing strong kick
; CNS difficulty: easy
[Statedef 240]
type    = S
movetype= A
physics = S
juggle  = 5
poweradd= 65
ctrl = 0
velset = 0,0
anim = 240
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,4
channel = 0

[State 240, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 240, 2]
type = HitDef
trigger1 = Time = 0
attr = S, NA
animtype  = Medium
damage    = 63
guardflag = MA
pausetime = 12,12
sparkno = 1
sparkxy = -10,-60
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -6
air.velocity = -2.2,-3.2

[State 240, 3]
type = PosAdd
trigger1 = AnimElem = 7
x = 12

[State 240, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Evasion
[Statedef 250]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= I                      ;Move-type: A-attack, I-idle, H-gethit
physics = N                      ;Physics: S-stand, C-crouch, A-air
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 250                       ;Change animation (Def: no change)
sprpriority = 0                  ;Set layering priority to 2 (in front)

[State 0, ]
type = PowerAdd
trigger1 = Time = 0
trigger1 = prevstateno = [120,699]
trigger1 = prevstateno != 229
trigger1 = var(21) < 1000
value = -500
ignorehitpause = 1
[State 0, ]
type = VarAdd
trigger1 = Time = 0
trigger1 = prevstateno = [120,699]
trigger1 = prevstateno != 229
trigger1 = var(21) >= 1000
var(21) = -1000
ignorehitpause = 1

[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
trigger1 = Time = 0
trigger1 = prevstateno = [120,699]
trigger1 = prevstateno != 229
time = 15
add = 0,0,0
mul = 256,256,256
sinadd = 512,512,512,3
invertall = 0
color = 256

[State 0, ]
type = AfterImage
trigger1 = Time = 0
time = 20
length = 30
palcolor = 128
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 5,5,5
paladd = 10,10,10
palmul = .65,.65,.65
timegap = 1
framegap = 4
trans = add

[State 0, ]
type = SprPriority
trigger1 = AnimElem = 2
value = -1

[State 0, ]
type = VelSet
trigger1 = AnimElem = 2
x = 7.5

[State 0, ]
type = VelSet
trigger1 = AnimElem = 7
x = 0

[State 0, ]
type = NotHitBy
trigger1 = 1
value = SCA,AA,AP
time = 1
ignorehitpause = 1

[State 0, ]
type = PlayerPush
trigger1 = vel x != 0
value = 0
ignorehitpause = 1

[State 200, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Back Evasion
[Statedef 255]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= I                      ;Move-type: A-attack, I-idle, H-gethit
physics = N                      ;Physics: S-stand, C-crouch, A-air
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 250                       ;Change animation (Def: no change)
sprpriority = 0                  ;Set layering priority to 2 (in front)

[State 0, ]
type = PowerAdd
trigger1 = Time = 0
trigger1 = prevstateno = [120,699]
trigger1 = prevstateno != 229
trigger1 = var(21) < 1000
value = -500
ignorehitpause = 1
[State 0, ]
type = VarAdd
trigger1 = Time = 0
trigger1 = prevstateno = [120,699]
trigger1 = prevstateno != 229
trigger1 = var(21) >= 1000
var(21) = -1000
ignorehitpause = 1

[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
trigger1 = Time = 0
trigger1 = prevstateno = [120,699]
trigger1 = prevstateno != 229
time = 15
add = 0,0,0
mul = 256,256,256
sinadd = 512,512,512,3
invertall = 0
color = 256

[State 0, ]
type = AfterImage
trigger1 = Time = 0
time = 20
length = 30
palcolor = 128
palbright = 30,30,30
palcontrast = 120,120,220
palpostbright = 5,5,5
paladd = 10,10,10
palmul = .65,.65,.65
timegap = 1
framegap = 4
trans = add

[State 0, ]
type = SprPriority
trigger1 = AnimElem = 2
value = -1

[State 0, ]
type = VelSet
trigger1 = AnimElem = 2
x = -7.5

[State 0, ]
type = VelSet
trigger1 = AnimElem = 7
x = 0

[State 0, ]
type = NotHitBy
trigger1 = 1
value = SCA,AA,AP
time = 1
ignorehitpause = 1

[State 0, ]
type = PlayerPush
trigger1 = vel x != 0
value = 0
ignorehitpause = 1

[State 200, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
;Crouching light punch
; CNS difficulty: easy
; Description: Simple crouching attack. The HitDef's guardflag parameter
;     is set to "L", meaning that the move can only be guarded low
;     (crouching), and not by standing or jumping opponents.
;     Like for all light attacks, it's a good idea to keep the slidetime
;     and hittime parameters at a smaller number, so the opponent isn't
;     stunned for too long. For all crouching attacks you have to
;     remember to set the attr parameter to indicate that it is crouching
;     attack. In this case, "C, NA" stands for "crouching, normal attack".
;     The HitDef's priority is set at 3, instead of the default of 4,
;     so this attack has a lower priority than most others, meaning
;     KFM will get hit instead of trading hits with his opponent if
;     their attack collision boxes (Clsn1) intersect each other's Clsn2
;     boxes at the same time.
[Statedef 400]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 15
ctrl = 0
anim = 400
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,2
channel = 0

[State 400, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 400, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 20
priority  = 3
animtype  = Light
hitflag = MAF
guardflag = L
pausetime = 10,11
sparkno = 0
sparkxy = -10,-42
hitsound   = 5,0
guardsound = 6,0
ground.type = Low
ground.slidetime = 4
ground.hittime  = 10
guard.hittime  = 5
ground.velocity = -4
air.velocity = -1.5,-3

[State 400, 3]
type = CtrlSet
trigger1 = Time = 5
value = 1

[State 400, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11

;---------------------------------------------------------------------------
;Crouching strong punch
; CNS difficulty: easy
; Description: This is a 2-hit move. It is done by having two HitDefs
;     triggered, one for each frame of animation that hits.
;     Notice how the first hit cannot be guarded by an opponent in the
;     air, because of the "M" in the guardflag, meaning it can only
;     be guarded "middle". The second hit has an "MA" guardflag, so
;     it can be guarded both on the ground and in the air.
; CNS レベル: 易
; 詳細: これは殴打が二発ある攻撃です。
; 殴打できるアニメーションの枚は一々HitDefを登録しています。
; 一発目の攻撃のHitDefにはguardflagが「M」（middle＝中段ガード）
; にセットされているので、相手は空中でガードできません。二発目
; の攻撃のguardflagは「MA」（middle+air＝中段＋空中ガード）で、
; 地上、空中でもガードすることができます。
[Statedef 410]
type    = C
movetype= A
physics = C
juggle  = 6
poweradd= 50
ctrl = 0
anim = 410
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,5
channel = 0

[State 410, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

;This is the first hit, triggered on the 3rd element of animation.
[State 410, 2]
type = HitDef
trigger1 = AnimElem = 3
attr = C, NA
damage    = 37
animtype  = Medium
hitflag = MAF
guardflag = M
pausetime = 12,12
sparkno = 1
sparkxy = -10,-55
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -4
air.velocity = -3,-4

;This is the second hit, triggered on the 4th element of animation.
[State 410, 3]
type = HitDef
trigger1 = AnimElem = 4
attr = C, NA
damage    = 36
animtype  = Medium
hitflag = MAF
guardflag = MA
pausetime = 12,12
sparkxy = -10,-83
hitsound   = 5,2
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 16
guard.hittime  = 7
ground.velocity = -7
air.velocity = -3,-4

[State 410, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

; Launcher
[Statedef 420]
type    = A
movetype= A
physics = N
anim = 420
velset = 2,-7
ctrl = 0
juggle = 7

[State 210, 3]
type = ChangeAnim
trigger1 = AnimElemTime(5) > 0 && AnimElemTime(6) <= 0
trigger1 = movecontact
ignorehitpause = 1
persistent = 0
value = 420
elem = 6

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,6
channel = 0

[State 1055, 2]
type = PlaySnd
trigger1 = Time = 5
value = 0, 2

[State 1055, 3]
type = PosAdd
trigger1 = Time = 0
x = 10
y = 10

[State 1055, 4] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 1055, 5]
type = HitDef
trigger1 = Time = 0
attr = A, NA
animtype  = diagup
damage    = 74, 8
priority  = 4
guardflag = MA
pausetime = 12,12
sparkxy = 0,-90
hitsound   = 5,4
guardsound = 6,0
ground.type = High
ground.slidetime = 15
ground.hittime  = 16
ground.velocity = -1,-8
guard.velocity = -8
guard.ctrltime = 12
air.velocity = -1,-8
airguard.velocity = -4,-4.5
fall = 1

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -5
value = 1056

;---------------------------------------------------------------------------
;Crouching light kick
; CNS difficulty: easy
[Statedef 430]
type    = C
movetype= A
physics = C
juggle  = 5
poweradd= 22
ctrl = 0
anim = 430
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,2
channel = 0

[State 430, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 430, 2]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage    = 28
animtype  = Light
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 0
sparkxy = -10,-8
hitsound   = 5,1
guardsound = 6,0
ground.type = Low
ground.slidetime = 6
ground.hittime  = 10
guard.hittime  = 5
ground.velocity = -5
air.velocity = -2,-3
down.velocity = -5,0
down.hittime = 20

[State 430, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Crouch Strong Kick
; CNS difficulty: easy
; Description: This move uses "Trip" for the "ground.type" parameter in
;     its HitDef. It's a special type that puts the opponent in a tripped
;     animation as he falls. Also, the hitflag parameter in the HitDef
;     is set to "MAFD". The "D" indicates that a downed opponent can be
;     hit by the attack.
; CNS レベル: 易
; 詳細:
[Statedef 440]
type    = C
movetype= A
physics = C
juggle  = 7
poweradd= 70
ctrl = 0
anim = 440
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,6
channel = 0

[State 440, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 2

[State 240, 1]
type = PlaySnd
trigger1 = animelem = 3
value = 0, 11

[State 440, 3]
type = HitDef
trigger1 = Time = 0
attr = C, NA
damage = 78
hitflag = MAFD
guardflag = L
pausetime = 12,12
sparkno = 1
sparkxy = -5,-10
hitsound   = 5,2
guardsound = 6,0
ground.type = Trip
ground.slidetime = 10
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -1.5,-2
air.velocity = -1.2,-3
guard.velocity = -5
fall = 1

[State 440, 4]
type = ChangeState
trigger1 = AnimTime = 0
value = 11
ctrl = 1

;---------------------------------------------------------------------------
;Jump Light Punch
; CNS difficulty: easy
[Statedef 600]
type    = A
movetype= A
physics = A
juggle  = 2
poweradd= 11
ctrl = 0
anim = 600
sprpriority = 2

[State 600, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 600, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 20
guardflag = HA
priority = 3
pausetime = 7,8
sparkno = 0
sparkxy = -10,-58
hitsound   = 5,0
guardsound = 6,0
ground.type = High
ground.slidetime = 5
ground.hittime  = 5
ground.velocity = -4
air.velocity = -1.3,-3

[State 600, 3]
type = CtrlSet
trigger1 = Time = 17
value = 1

;---------------------------------------------------------------------------
;Jump Strong Punch
; CNS difficulty: easy
[Statedef 610]
type    = A
movetype= A
physics = A
juggle  = 4
poweradd= 65
ctrl = 0
anim = 610
sprpriority = 2

[State 610, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 610, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 72
guardflag = HA
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-55
hitsound   = 5,3
guardsound = 6,0
animtype = Med
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -5
air.velocity = -3,-4

; Aerial Launcher
[Statedef 620]
type    = A
movetype= A
physics = N
anim = 420
;velset = 2,-6
ctrl = 0

[State 210, 3]
type = ChangeAnim
trigger1 = AnimElemTime(5) > 0 && AnimElemTime(6) <= 0
trigger1 = movecontact
ignorehitpause = 1
persistent = 0
value = 420
elem = 6

[State with voice]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,6
channel = 0

[State 1055, 2]
type = PlaySnd
trigger1 = Time = 5
value = 0, 2

[State 1055, 4] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 0, VelAdd]
type = VelAdd
trigger1 = animelem = 4
x = 0.5
y = -4
ignorehitpause = 1

[State 1055, 5]
type = HitDef
trigger1 = Time = 0
attr = A, NA
animtype  = diagup
damage    = 74, 8
priority  = 4
guardflag = MA
pausetime = 12,12
sparkxy = 0,-90
hitsound   = 5,4
guardsound = 6,0
ground.type = High
ground.slidetime = 15
ground.hittime  = 16
ground.velocity = -4,-8
guard.velocity = -8
guard.ctrltime = 12
air.velocity = -4,-8
airguard.velocity = -4,-4.5
fall = 1

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -5
value = 1056

;---------------------------------------------------------------------------
;Jump Light Kick
; CNS difficulty: easy
[Statedef 630]
type    = A
movetype= A
physics = A
juggle  = 3
poweradd= 20
ctrl = 0
anim = 630
sprpriority = 2

[State 630, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 0

[State 630, 2]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage = 26
guardflag = HA
priority = 3
pausetime = 8,8
sparkno = 1
sparkxy = -5,-35
hitsound   = 5,0
guardsound = 6,0
ground.type = High
ground.slidetime = 6
ground.hittime  = 6
guard.hittime  = 3
ground.velocity = -4
air.velocity = -2,-3

;---------------------------------------------------------------------------
;Jump Strong Kick
; CNS difficulty: easy
[Statedef 640]
type    = A
movetype= A
physics = A
juggle  = 4
poweradd= 65
ctrl = 0
anim = 640
sprpriority = 2

[State 640, 2]
type = PlaySnd
trigger1 = Time = 2
value = 0, 1

[State 640, 3]
type = HitDef
trigger1 = Time = 0
attr = A, NA
damage    = 70
guardflag = HA
priority = 4
pausetime = 12,12
sparkno = 1
sparkxy = -10,-40
hitsound   = 5,3
guardsound = 6,0
animtype = Med
ground.type = High
ground.slidetime = 15
ground.hittime  = 17
guard.hittime  = 7
ground.velocity = -5
air.velocity = -3,-4

;---------------------------------------------------------------------------
;Kung Fu Throw - Attempt
; CNS difficulty: medium-advanced
; Description: Throws are not difficult to make, although then can be
;     tedious at times. Throw attempt states have a HitDef of a
;     special format. The key parameters in a throw are p1stateno
;     and p2stateno. If the HitDef successfully connects, then
;     the attacker will change to the state number specified by
;     p1stateno, and the opponent will be change to the state
;     number assigned to p2stateno. The special thing about p2stateno
;     is that the opponent will be temporarily brought into the
;     attacker's state file. In this case, no matter who the
;     opponent is, he will be taken to state 820 of this file (kfm.cns)
;     and remain here until the end of the throw (look at his debug
;     information when he is being thrown; the text changes to yellow
;     to mean that he is in another player's state file).
[Statedef 800]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 800
sprpriority = 2

; Notes: The '-' symbol in the hitflag field means that it only affects
;   players who are not in a hit state. This prevents KFM from combo-ing
;   into the throw. The priority should be set to a low number, such as
;   1 or 2, so that the throw does not take precedence over normal attacks.
;   The type of priority must always be set to "Miss" or "Dodge" for throws,
;   otherwise strange behavior can result.
[State 800, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, NT          ;Attributes: Standing, Normal Throw
hitflag = M-          ;Affect only ground people who are not being hit
priority = 1, Miss    ;Throw has low priority, must be miss or dodge type.
sparkno = -1          ;No spark
sprpriority = 1       ;Draw in front of p2
p1facing = 1
p2facing = 1          ;Force p2 to face KFM
p1stateno = 810       ;On success, KFM changes to state 810
p2stateno = 820       ;If hit, p2 changes to state 820 in KFM's cns
guard.dist = 0        ;This prevents p2 from going into a guard state if close
fall = 1              ;Force p2 into falling down

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Kung Fu Throw - Throwing the opponent
; Description: In this state, KFM throws the opponent by binding him to
;     various offsets based on his current frame of animation. For
;     example, [State 810, Bind 1] binds the opponent to an offset of
;     28 pixels in front of KFM. That puts him around where KFM's hand
;     is at. Is is important to keep the opponent bound using a
;     TargetBind controller at all times, until you let him go. This
;     is especially important if your player has a Clsn2 box that
;     allows him to get hit while throwing someone. Each time a player
;     gets hit, all his bound targets will be set to a fall state. If
;     the opponent is not bound, then he may get stuck in his thrown
;     state when his attacker is knocked out of the throw halfway.
; Notes: There is a TargetLifeAdd controller to decrease the opponent's
;     life, and a TargetState controller to change his state to a
;     falling state when KFM lets go of him.
[Statedef 810]
type    = S
movetype= A
physics = N
anim = 810
poweradd = 60

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,7
channel = 0

; Here a variable, var(2), is used to remember whether or not the
; player was holding forward at the start of the state. This variable
; is checked later on to turn KFM around if necessary.
[State 810, Holding fwd?]
type = VarSet
trigger1 = Time = 0
var(2) = command = "holdfwd"

[State 810, Grab Sound]
type = PlaySnd
trigger1 = AnimElem = 2
value = 1, 1

[State 810, Throw Sound]
type = PlaySnd
trigger1 = AnimElem = 7
value = 800, 0

[State 810, Bind 1]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 28, 0

[State 810, Width 2-11]
type = Width
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(12) < 0
edge = 60,0

[State 810, Bind 2-4]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(5) < 0
pos = 58, 0

[State 810, Bind 5]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = 47, 0

[State 810, holdfwd - Turn 6] ;If was holding fwd before, turn now
type = Turn
trigger1 = var(2)
trigger1 = AnimElem = 6

[State 810, holdfwd - Pos 6] ;If was holding fwd before, move a little
type = PosAdd
trigger1 = var(2)
trigger1 = AnimElem = 6
x = -37

[State 810, holdfwd - Turn Target 6] ;If was holding fwd before, turn target too
type = TargetFacing
trigger1 = var(2)
trigger1 = AnimElem = 6
value = -1

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 41, -60

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 25, -75

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
pos = 15, -90

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
pos = -5, -96

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
pos = -14, -90

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElem = 11
pos = -50, -50

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = AnimElem = 11
value = -78

[State 810, Throw 11]
type = TargetState
trigger1 = AnimElem = 11
value = 821

[State 810, Turn 12]
type = Turn
trigger1 = AnimElem = 12

[State 810, Pos 15]
type = PosAdd
trigger1 = AnimElem = 15
x = -10

[State 810, State End]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw
; (a custom gethit state)
; Description: This is the state that the opponent changes to after being
;     hit by KFM's throw HitDef. The important thing here is to use a
;     ChangeAnim2 controller. The difference between ChangeAnim2 and
;     ChangeAnim is that ChangeAnim2 changes the player's animation to
;     an action in the AIR file of the attacker (in this case, kfm.air),
;     whereas ChangeAnim always changes the player to an action in his
;     own AIR file. Look at Action 820 in kfm.air for some extra
;     comments.
[Statedef 820]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 820

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = time>80;!gethitvar(isbound);
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 821]
type    = A
movetype= H
physics = N
velset = 2.8,-7
poweradd = 40

[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = .4

[State 821, 2] ; Recover near ground (use ChangeState)
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -20
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 ;HITFALL_RECOVER

[State 821, 3] ; Recover in mid air (use SelfState)
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 ;HITFALL_AIRRECOVER

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground

[Statedef 900]
type    = S
movetype= I
physics = N
velset = 0,0
anim = 9741

[State dizzy length]
type = VarSet
trigger1 = 1
fvar(0) = parent,var(20)
[State fvar]
type = VarSet
trigger1 = 1
fvar(10) = ifelse(fvar(0)>=500,1,fvar(0)/500)
[State skill length]
type = VarSet
trigger1 = 1
fvar(1) = parent,var(21)
[State fvar]
type = VarSet
trigger1 = 1
fvar(11) = ifelse(fvar(1)>=2000,1,fvar(1)/2000)
[State ammo length]
type = VarSet
trigger1 = 1
fvar(2) = parent,var(22)
[State fvar]
type = VarSet
trigger1 = 1
fvar(12) = ifelse(fvar(2)>=15,1,fvar(2)/15)
[State IK length]
type = VarSet
trigger1 = 1
fvar(3) = parent,var(32)
[State fvar]
type = VarSet
trigger1 = 1
fvar(13) = ifelse(fvar(3)>=3000,1,fvar(3)/3000)

[State System]
type = Explod
trigger1 = parent,stateno != 4010
trigger1 = !numhelper(202)
anim = 900
ID = 900
pos = 3,196
postype = back
;facing = 1
;vfacing = 1
bindtime = -1
removetime = 1
supermovetime = 65535
pausemovetime = 65535
scale = 1,1
sprpriority = 600
ontop = 1
ownpal = 1
ignorehitpause = 1
[State Dizzy]
type = Explod
triggerall = fvar(10) > 0
triggerall = parent,stateno != 4010
triggerall = !numhelper(202)
trigger1 = fvar(10) < 0.8
trigger2 = !((gametime%3)=0)
anim = 902
ID = 902
pos = 2,196
postype = back
;facing = 1
;vfacing = 1
bindtime = -1
removetime = 1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(10),1
sprpriority = 599
ontop = 1
ownpal = 1
ignorehitpause = 1
[State Skill]
type = Explod
triggerall = fvar(11) != 0
triggerall = parent,stateno != 4010
triggerall = !numhelper(202)
trigger1 = fvar(11) != 1
trigger2 = !((gametime%3)=0)
anim = 904
ID = 904
pos = 2,196
postype = back
;facing = 1
;vfacing = 1
bindtime = -1
removetime = 1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(11),1
sprpriority = 599
ontop = 1
ownpal = 1
ignorehitpause = 1
[State Skill]
type = Explod
triggerall = parent,stateno != 4010
triggerall = !numhelper(202)
trigger1 = fvar(12) != 0
anim = 901
ID = 901
pos = 2,196
postype = back
;facing = 1
;vfacing = 1
bindtime = -1
removetime = 1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(12),1
sprpriority = 599
ontop = 1
ownpal = 1
ignorehitpause = 1
[State IK]
type = Explod
triggerall = parent,stateno != 4010
triggerall = !numhelper(202)
trigger1 = fvar(13) != 0
anim = 903
ID = 903
pos = 2,196
postype = back
;facing = 1
;vfacing = 1
bindtime = -1
removetime = 1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(13),1
sprpriority = 599
ontop = 1
ownpal = 1
ignorehitpause = 1

[State 0, PlaySnd]
type = PlaySnd
triggerall = !(parent,var(55))
triggerall = parent,stateno != 4010
trigger1 = var(40) = 0
trigger1 = fvar(10) >= 0.8
value = S0,8
abspan = 0
[State 0, VarSet]
type = VarSet
trigger1 = var(40) = 0
trigger1 = fvar(10) >= 0.8
var(40) = 1
[State 0, VarSet]
type = VarSet
trigger1 = var(40) = 1
trigger1 = fvar(10) < 0.8
var(40) = 0

[State 0, PlaySnd]
type = PlaySnd
triggerall = !(parent,var(55))
triggerall = parent,stateno != 4010
trigger1 = var(41) = 0
trigger1 = fvar(11) >= 0.5
value = S0,7
abspan = 0
[State 0, VarSet]
type = VarSet
trigger1 = var(41) = 0
trigger1 = fvar(11) >= 0.5
var(41) = 1
[State 0, VarSet]
type = VarSet
trigger1 = var(41) = 1
trigger1 = fvar(11) < 0.5
var(41) = 0

[State 0, PlaySnd]
type = PlaySnd
triggerall = !(parent,var(55))
triggerall = parent,stateno != 4010
trigger1 = var(42) = 0
trigger1 = fvar(11) >= 1
value = S0,7
abspan = 0
[State 0, VarSet]
type = VarSet
trigger1 = var(42) = 0
trigger1 = fvar(11) >= 1
var(42) = 1
[State 0, VarSet]
type = VarSet
trigger1 = var(42) = 1
trigger1 = fvar(11) < 1
var(42) = 0


;---------------------------------------------------------------------------
; Kung Fu Palm
; CNS difficulty: medium
; Description: This is like a standard attack, but with some differences.
;   There are two HitDefs in this attack. One is triggered when the
;   opponent is near (using a p2bodydist trigger), and the other
;   when the opponent is farther away. The main differences between
;   the near and far versions of the HitDefs is that the near version
;   has a "fall" parameter set to 1, causing the opponent to be knocked
;   down. Other minor differences are the damage, and the velocity to
;   give the opponent.
;   The line "attr = S, SA" line means this is a Standing, Special Attack.
;   It is important you have the attr parameter set correctly for all
;   you HitDefs.
[Statedef 1000]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 110
velset = 0,0
anim = 1000
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,8
channel = 0

[State 1000, 1]
type = PlaySnd
trigger1 = Time = 8
value = 0, 3

[State 1000, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = 20

[State 1000, 3]
type = PosAdd
trigger1 = AnimElem = 3
trigger2 = AnimElem = 12
x = 10

[State 1000, 4]
type = PosAdd
trigger1 = AnimElem = 5
x = 5

[State 1000, 5] ;Opponent near
type = HitDef
trigger1 = AnimElem = 5
trigger1 = p2bodydist X < 40
attr = S, SA
animtype  = Hard
damage    = 75, 4
priority  = 5
guardflag = MA
pausetime = 15,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -4,-3.5
air.velocity = -4,-3
fall = 1

[State 1000, 6] ;Opponent not near
type = HitDef
trigger1 = AnimElem = 5
trigger1 = p2bodydist X >= 40
attr = S, SA
animtype  = Hard
damage    = 70, 4
priority  = 4
guardflag = MA
pausetime = 15,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -7
air.velocity = -4,-2.5

[State 1000, 6]
type = PosAdd
trigger1 = AnimElem = 8
x = -5

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Strong Kung Fu Palm
; CNS difficulty: medium
[Statedef 1010]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 120
velset = 0,0
anim = 1010
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,8
channel = 0

[State 1010, 1]
type = PlaySnd
trigger1 = Time = 9
value = 0, 3

[State 1010, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = 20

[State 1010, 3]
type = PosAdd
trigger1 = AnimElem = 3
trigger2 = AnimElem = 12
x = 10

[State 1010, 4]
type = PosAdd
trigger1 = AnimElem = 5
x = 5

[State 1010, 5]
type = VelSet
trigger1 = AnimElem = 5
x = 8

[State 1010, 6] ;Opponent near
type = HitDef
trigger1 = AnimElem = 5
trigger1 = p2bodydist X < 40
attr = S, SA
animtype  = Hard
damage    = 94, 4
priority  = 5
guardflag = MA
pausetime = 15,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -4,-3.5
air.velocity = -4,-3
fall = 1

[State 1010, 7] ;Opponent not near
type = HitDef
trigger1 = AnimElem = 5
trigger1 = p2bodydist X >= 40
attr = S, SA
animtype  = Hard
damage    = 89, 4
priority  = 4
guardflag = MA
pausetime = 15,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 7
ground.velocity = -7
air.velocity = -4,-2.5

[State 1010, 8]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Fast Kung Fu Palm
; CNS difficulty: advanced
; Description: This is a complicated attack move. If you're a beginner,
;     you should skip looking at this for now and check it later when
;     you are more comfortable with the cns.
;     This move puts the other player in a custom get-hit state.
;     The line "p2stateno = 1025" in the HitDef does this. KFM has some
;     palette effects as well as after-image effects.
[Statedef 1020]
type    = S
movetype= A
physics = N
juggle  = 6
poweradd= -330
velset = 0,0
anim = 1020
ctrl = 0
sprpriority = 2

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,6
channel = 0

[State 1020, Friction]
type = VelMul
trigger1 = !movehit
x = .85 * ifelse (AnimElemTime(6) < 0, 1, .8)

[State 1020, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1020, Afterimage]
type = AfterImageTime
trigger1 = AnimElemTime(8) < 0
time = 2

[State 1020, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State 1020, 1]
type = PlaySnd
trigger1 = Time = 2
value = 0, 3

[State 1020, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = 20

[State 1020, 3]
type = PosAdd
trigger1 = AnimElem = 3
trigger2 = AnimElem = 11
x = 10

[State 1020, 4]
type = PosAdd
trigger1 = AnimElem = 4
x = 5

[State 1020, 5]
type = VelSet
trigger1 = AnimElem = 4
x = 25

[State 1020, 1]
type = PlaySnd
trigger1 = animelem = 4
value = 0, 17

[State 0, ]
type = Explod
trigger1 = AnimElem = 4
anim = 1022
pos = 39,-59
scale = 1,1
postype = p1
bindtime = 1
sprpriority = 12
facing = -1
vel = vel x,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1

[State 0, NotHitBy]
type = NotHitBy
trigger1 = abs(vel x)>10
value = SCA,NP,SP
time = 1
ignorehitpause = 1

[State 1020, 6]
type = HitDef
trigger1 = AnimElem = 4
attr = S, SA
animtype  = Hard
damage    = 115, 5
getpower  = 0
priority  = 4
guardflag = MA
pausetime = 0,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
guard.hittime  = 10
ground.velocity = -16,-9
guard.velocity = -12
air.velocity = -14,-9
airguard.velocity = -5, -4
fall = 1
;p2stateno = 1025
id = 1020

[State 0, PlayerPush]
type = PlayerPush
trigger1 = movecontact
value = 0
ignorehitpause = 1

;[State 0, StateTypeSet]
;type = StateTypeSet
;trigger1 = movehit
;physics = N
;ignorehitpause = 1
;persistent = 0

[State 0, TargetState]
type = TargetState
trigger1 = movehit = 1
trigger1 = numtarget(1020)
value = 1025
ID = 1020
ignorehitpause = 1
persistent = 0

[State 1020, 7]
type = ChangeState
trigger1 = movehit
trigger1 = p2dist x < -40
value = 1021
ignorehitpause = 1

[State 1020, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

[Statedef 1021]
type    = S
movetype= I
physics = S
;velset = 0,0
anim = 1021
ctrl = 0
sprpriority = 2

[State 0, VelMul]
type = VelMul
trigger1 = 1
x = 0.8

[State 0, PlayerPush]
type = PlayerPush
trigger1 = 1
value = 0
ignorehitpause = 1

[State 1020, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;------------------
; Hit by Fast Kung Fu Palm - shaking from the hit
; (a custom gethit state)
; See State 1020 for details
[Statedef 1025]
type    = A
movetype= H
physics = N
velset = 0,0

[State 1025, Anim] ;Custom animation
type = ChangeAnim2
trigger1 = 1
value = 1025

[State 1025, State]
type = ChangeState
trigger1 = HitShakeOver = 1
value = 1026

;------------------
; Hit by Fast Kung Fu Palm - flying through the air
; (a custom gethit state)
[Statedef 1026]
type    = A
movetype= H
physics = N

[State 1026, Velocity]
type = HitVelSet
trigger1 = Time = 0
x = 1
y = 1

[State 1026, Gravity]
type = VelAdd
trigger1 = 1
y = .45

[State 1026, No scroll]
type = ScreenBound
triggerall = Pos y < -15
trigger1 = BackEdgeBodyDist < 65
trigger2 = FrontEdgeBodyDist < 65
value = 1
movecamera = 0,1

[State 1026, Hit wall]
type = ChangeState
triggerall = Pos y < -15
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 1027

[State 1026, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;------------------
; Hit by Fast Kung Fu Palm - hit wall
; (a custom gethit state)
[Statedef 1027]
type    = A
movetype= H
physics = N

[State 1027, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 1027, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 1027, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 1027, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 1027, Spark]
type = Explod
trigger1 = Time = 0
anim = F72
pos = 0, floor (screenpos y) - 50
postype = back
sprpriority = 3

[State 1027, Anim]
type = ChangeAnim2
trigger1 = Time = 0
value = 1027

[State 1027, Sound]
type = PlaySnd
trigger1 = Time = 0
value = F7,0

[State 1027, State]
type = ChangeState
trigger1 = AnimTime = 0
value = 1028

;------------------
; Hit by Fast Kung Fu Palm - bounce off wall
; (a custom gethit state)
[Statedef 1028]
type    = A
movetype= H
physics = N

[State 1028, 1]
type = NotHitBy
trigger1 = 1
value = , NA, NP

[State 1028, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -6

[State 1028, Vel X]
type = VelSet
trigger1 = Time = 0
x = 1.6

[State 1028, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 1028, Gravity]
type = VelAdd
trigger1 = 1
y = .35

[State 1028, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 1028, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 1028, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 1028, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 1028, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
; Kung Fu Knee
; CNS difficulty: medium
; Description: Like the Kung Fu Palm, this is a special attack. This attack
;     begins on the ground, launches KFM into the air, then ends when KFM
;     lands on the ground. To achieve this, we use three states. The first
;     has KFM starting on the ground (note that type = S in the Statedef).
;     The ChangeState controller brings KFM into the second state (state
;     1051) when his ground animation ends. The second state controls KFM's
;     movement into the air and back towards the ground. The last state
;     (state 1052) stops KFM from moving when he touches the ground, and
;     brings him back to his stand state (state 0) when the animation is
;     over. More details are given in comments before each of the following
;     states.
[Statedef 1050]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 110
velset = 0,0
anim = 1050
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 2
;trigger1 = random < 500
value = S2,30
channel = 0

[State 1050, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 2

[State 1050, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = 15

[State 1050, 3]
type = PosAdd
trigger1 = AnimElem = 4
x = 25

[State 1050, 4]
type = HitDef
trigger1 = Time = 0
attr = A, SA
animtype  = Medium
damage    = 70, 4
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = -10,-70
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
guard.hittime  = 10
ground.velocity = -3.5,-7
guard.velocity = -7
air.velocity = -3.5,-7
fall = 1

[State 1050, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 1051

;------------------
; Light Kung Fu Knee - jump
; Description: This state uses a velset parameter in the Statedef to make
;     KFM move upwards. A value of 2,-6 means 2 pixels/tick forwards, and
;     6 pixels/tick upwards. Since this is an aerial state, the type is set
;     to A in the Statedef.
;     Notice that physics = N (N for None) here. This means we are not using
;     the built-in aerial physics model (physics = A), so we have complete
;     control over what KFM does in this state. Since we do not have
;     physics = A to take care of gravity for us, we need to put in our own
;     controller for that. Controller 1051,1 does the work of pulling KFM
;     down towards the ground. Controller 1051,2 checks if KFM has reached
;     the ground, and changes to state 1052 if so.
;     In this state's Statedef, we will use the hitdefpersist parameter to
;     retain the HitDef information from the last state. If we did not have
;     hitdefpersist, the HitDef will be turned off between state changes.
[Statedef 1051]
type    = A
movetype= A
physics = N
velset = 2,-6
anim = 1051
hitdefpersist = 1 ;Keep the HitDef from previous state active

[State 1051, 1] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 1051, 2]
type = ChangeState
trigger1 = Command = "a" || Command = "b"
trigger1 = Vel y < -1
value = 1055

[State 1051, 3] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -10
value = 1052

;------------------
; Light Kung Fu Knee - land
; Description: This is KFM's landing state. There is a velset in the
;     Statedef to stop KFM from moving. Since KFM's y-position can be any
;     number greater than -10 upon entering this state (see the ChangeState
;     controller in State 1051), we need to reset it to 0, the ground
;     level. That is what controller 1052,1 is for.
[Statedef 1052]
type    = S
movetype= I
physics = S
anim = 1052
sprpriority = 1
velset = 0,0

[State 1052, 1] ;Reset y-position to ground level
type = PosSet
trigger1 = Time = 0
y = 0

[State 1052, 2] ;Play a sound for landing
type = PlaySnd
trigger1 = Time = 0
value = 40, 0

[State 1052, 3] ;Give KFM back control early
type = CtrlSet
trigger1 = AnimElem = 3, -1
value = 1

[State 1052, 4] ;Move KFM back a little
type = PosAdd
trigger1 = AnimElem = 4
x = -15

[State 1052, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------
; Kung Fu Knee - kick
[Statedef 1055]
type    = A
movetype= A
physics = N
anim = 1055

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,31
channel = 0

[State 1055, 2]
type = PlaySnd
trigger1 = Time = 0
value = 0, 1

[State 1055, 3]
type = PosAdd
trigger1 = Time = 0
x = 10
y = -10

[State 1055, 4] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 1055, 5]
type = HitDef
trigger1 = Time = 0
attr = A, SA
animtype  = Med
damage    = 30 + (prevstateno = 1061)*7, 2
priority  = 4
guardflag = MA
pausetime = 12,12
sparkxy = 0,-90
hitsound   = 5,2
guardsound = 6,0
ground.type = High
ground.slidetime = 15
ground.hittime  = 16
ground.velocity = -6
guard.velocity = -8
guard.ctrltime = 12
air.velocity = -4,-5
airguard.velocity = -4,-4.5
air.fall = 1

[State 1051, 2]
type = ChangeState
trigger1 = Command = "x" || Command = "y"
trigger1 = animelemtime(5) >= 0
trigger1 = animelemtime(8) < 0
value = 1057

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -5
value = 1056

;------------------
; Kung Fu Knee - land from kick
[Statedef 1056]
type    = S
movetype= I
physics = S
anim = 1056
sprpriority = 1
velset = 0,0

[State 1056, 1] ;Reset y-position to ground level
type = PosSet
trigger1 = Time = 0
y = 0

[State 1056, 2] ;Play a sound for landing
type = PlaySnd
trigger1 = Time = 0
value = 40, 0

[State 1056, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;------------------
; Kung Fu Knee - chop
[Statedef 1057]
type    = A
movetype= A
physics = N
anim = 1057

[State with voice]
type = PlaySnd
trigger1 = Time = 4
;trigger1 = random < 500
value = S2,32
channel = 0

[State 1055, 2]
type = PlaySnd
trigger1 = Time = 4
value = 0, 2

[State 1055, 3]
type = PosAdd
trigger1 = Time = 0
x = 10
y = -10

[State 1055, 3]
type = VelMul
trigger1 = Time = 0
x = 0.9

[State 1055, 3]
type = VelSet
trigger1 = Time = 0
y = -4

[State 1055, 4] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 610, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage = 25 + (prevstateno = 1061)*5, 2
guardflag = HA
priority = 4
pausetime = 12,12
sparkno = 2
sparkxy = -10,-55
hitsound   = 5,2
guardsound = 6,0
animtype = Med
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -7
air.velocity = -3,-3
air.fall = 1

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -5
value = 1056

;---------------------------------------------------------------------------
; Strong Kung Fu Knee
[Statedef 1060]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 120
velset = 0,0
anim = 1060
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,30
channel = 0

[State 1060, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 2

[State 1060, 2]
type = PosAdd
trigger1 = AnimElem = 2
trigger2 = AnimElem = 3
x = 14

[State 1060, 3]
type = PosAdd
trigger1 = AnimElem = 4
x = 25

[State 1060, 4]
type = HitDef
trigger1 = Time = 0
attr = A, SA
animtype  = Medium
damage    = 85, 4
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = -10,-70
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 20
ground.velocity = -3.5,-7.5
guard.velocity = -7
air.velocity = -3.5,-7.5
fall = 1

[State 1060, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 1061

;------------------
; Strong Kung Fu Knee - jump
[Statedef 1061]
type    = A
movetype= A
physics = N
velset = 2.5,-7.5
anim = 1061
hitdefpersist = 1 ;Keep the HitDef from previous state active

[State 1061, 1]
type = VelAdd
trigger1 = 1
y = .45

[State 1061, 2]
type = ChangeState
trigger1 = Command = "a" || Command = "b"
trigger1 = Vel y < -1
value = 1055

[State 1061, 3]
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -10
value = 1052

;---------------------------------------------------------------------------
; Fast Kung Fu Knee
; Description: This version of the Kung Fu Knee hits up to 3 times (including
;     the kick).
[Statedef 1070]
type    = S
movetype= A
physics = S
juggle  = 6
poweradd= -330
velset = 0,0
anim = 1070
ctrl = 0
sprpriority = 2

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,30
channel = 0

[State 1070, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1070, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[State 1070, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State 1070, 1]
type = PlaySnd
trigger1 = Time = 1
value = 0, 2

[State 1070, 2]
type = PosAdd
trigger1 = AnimElem = 2
trigger2 = AnimElem = 3
x = 14

[State 1070, 3]
type = PosAdd
trigger1 = AnimElem = 4
x = 25

[State 1070, 4]
type = HitDef
trigger1 = Time = 0
attr = S, SA
animtype  = Medium
getpower  = 0
damage    = 35, 3
priority  = 5
hitflag   = MA
guardflag = MA
pausetime = 8,7
sparkxy = -10,-70
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -2,-6
guard.velocity = -7
air.velocity = -2,-6
fall = 1
fall.animtype = Med
fall.recovertime = 30

[State 1070, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 1071

;------------------
; Fast Kung Fu Knee - jump
[Statedef 1071]
type    = A
movetype= A
physics = N
velset = 2.5,-9
anim = 1071

[State 1071, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 18
add = 32,16,0
sinadd = 64,32,5,3

[State 1071, Afterimage]
type = AfterImageTime
trigger1 = Vel Y < 0
time = 2

[State 1071, 1]
type = VelAdd
trigger1 = 1
y = .5

[State 1071, 2]
type = VelAdd
trigger1 = Vel Y >= -1
y = .2

[State 1071, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
animtype  = Medium
getpower  = 0
damage    = 68, 4
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = -10,-70
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 18
ground.hittime  = 18
ground.velocity = -3,-9.5
guard.velocity = -7
air.velocity = -3,-9.5
fall = 1
fall.recovertime = 30

[State 1071, 4]
type = ChangeState
trigger1 = Command = "a" || Command = "b"
trigger1 = Vel y < -1
trigger1 = Time > 0
value = 1075

[State 1071, 5]
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -10
value = 1052

;------------------
; Fast Kung Fu Knee - kick
[Statedef 1075]
type    = A
movetype= A
physics = N
anim = 1055

[State 1075, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[State 1075, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,31
channel = 0

[State 1075, 2]
type = PlaySnd
trigger1 = Time = 0
value = 0, 1

[State 1075, 3]
type = PosAdd
trigger1 = Time = 0
x = 10
y = -10

[State 1075, 4] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 1075, 5]
type = VelAdd
trigger1 = Vel Y >= -1
y = .2

[State 1075, 6]
type = HitDef
trigger1 = Time = 0
attr = A, SA
animtype  = Med
damage    = 42, 2
getpower  = 0
priority  = 4
guardflag = MA
pausetime = 12,12
sparkxy = 0,-90
hitsound   = 5,2
guardsound = 6,0
ground.type = High
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -6
guard.velocity = -6
air.velocity = -4,-6
airguard.velocity = -4,-4.5
air.fall = 1

[State 1051, 2]
type = ChangeState
trigger1 = Command = "x" || Command = "y"
trigger1 = animelemtime(5) >= 0
trigger1 = animelemtime(8) < 0
value = 1077

[State 1075, 7] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -5
value = 1056


;------------------
; Fast Kung Fu Knee - chop
[Statedef 1077]
type    = A
movetype= A
physics = N
anim = 1057

[State 1075, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2

[State 1075, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State with voice]
type = PlaySnd
trigger1 = Time = 4
;trigger1 = random < 500
value = S2,32
channel = 0

[State 1055, 2]
type = PlaySnd
trigger1 = Time = 4
value = 0, 2

[State 1055, 3]
type = PosAdd
trigger1 = Time = 0
x = 10
y = -10

[State 1055, 3]
type = VelMul
trigger1 = Time = 0
x = 0.9

[State 1055, 3]
type = VelSet
trigger1 = Time = 0
y = -4

[State 1055, 4] ;Gravity
type = VelAdd
trigger1 = 1
y = .45

[State 1075, 5]
type = VelAdd
trigger1 = Vel Y >= -1
y = .2

[State 610, 3]
type = HitDef
trigger1 = Time = 0
attr = A, SA
damage = 30
getpower = 0
guardflag = HA
priority = 4
pausetime = 12,12
sparkno = 3
sparkxy = -10,-55
hitsound   = 5,4
guardsound = 6,0
animtype = Med
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -7
air.velocity = -3,-2
air.fall = 1
;fall.yvelocity = -9

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= -5
value = 1056

;---------------------------------------------------------------------------
; Light Kung Fu Upper
; CNS difficulty: easy
; Description: This is a simple special attack that can hit twice. Notice
;     the use of the Width controller to keep opponents from getting too
;     close to KFM during his uppercut (press Ctrl-C, and look at the
;     yellow bar at KFM's feet during the move).
;     The second HitDef has some interesting parameters. fall.recovertime
;     is used to prevent the opponent (p2) from recovering immediately
;     after being hit (eg. press x+y with KFM to recover). This gives the
;     attacking KFM a chance to follow up with an extra attack, such as
;     a Kung Fu Knee. The yaccel parameter, set at 0.4, makes p2 fall at a
;     greater value of acceleration than the default, which is 0.35.
[Statedef 1100]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 110
velset = 0,0
anim = 1100
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,6
channel = 0

[State 1100, Width]
type = Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(13) < 0
value = 5,0

[State 1100, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[State 1100, 2]
type = HitDef
trigger1 = Time = 0
attr = S, SA
animtype  = Med
damage    = 52, 4
priority  = 5
guardflag = MA
pausetime = 4,8
sparkxy = 0,-48
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -3
guard.velocity = -6
air.velocity = -2,-2
airguard.velocity = -4,-4.5
p2facing = 1

[State 1100, 3]
type = HitDef
trigger1 = AnimElem = 7
attr = S, SA
animtype  = Up
damage    = 55, 4
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = 0,-110
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -1,-9.5
guard.velocity = -6
air.velocity = -1,-7.5
airguard.velocity = -4,-4.5
p2facing = 1
fall = 1                   ;Make p2 fall down
fall.recovertime = 40      ;40 ticks before p2 can recover from fall
yaccel = .4                ;p2 will accelerate down at .4 pixels/sec^2 when falling

[State 1100, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Strong Kung Fu Upper
[Statedef 1110]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 120
velset = 0,0
anim = 1110
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,6
channel = 0

[State 1110, Width]
type = Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(14) < 0
value = 5,0

[State 1110, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[State 1110, 2]
type = HitDef
trigger1 = Time = 0
attr = S, SA
animtype  = Med
damage    = 57, 4
priority  = 5
guardflag = MA
pausetime = 4,8
sparkxy = 0,-48
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -3
guard.velocity = -6
air.velocity = -2,-2
airguard.velocity = -4,-4.5
p2facing = 1

[State 1110, 3]
type = HitDef
trigger1 = AnimElem = 7
attr = S, SA
animtype  = Up
damage    = 60, 4
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = 0,-110
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 15
ground.hittime  = 18
ground.velocity = -1,-10.5
guard.velocity = -6
air.velocity = -1,-8.5
airguard.velocity = -4,-4.5
p2facing = 1
fall = 1
fall.recovertime = 50
yaccel = .4

[State 1110, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Fast Kung Fu Upper
[Statedef 1120]
type    = S
movetype= A
physics = S
juggle  = 6
poweradd= -330
velset = 0,0
anim = 1120
ctrl = 0
sprpriority = 2

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,6
channel = 0

[State 1120, Width]
type = Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(14) < 0
value = 5,0

[State 1120, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1120, Afterimage]
type = AfterImageTime
trigger1 = AnimTime < -2
time = 2

[State 1120, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State 1120, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[State 1120, 2]
type = HitDef
trigger1 = Time = 0
trigger2 = AnimElem = 4
attr = S, SA
animtype  = Med
damage    = 30, 4
getpower  = 0
priority  = 5
guardflag = MA
pausetime = 6,20
sparkxy = 0, ifelse(Time = 0, -48, -55)
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 18
ground.hittime  = 21
ground.velocity = -3
guard.velocity = -6
air.velocity = -2,-2
airguard.velocity = -4,-4.5
p2facing = 1

[State 1120, 3]
type = HitDef
trigger1 = AnimElem = 7
attr = S, SA
animtype  = Up
damage    = 68, 4
getpower  = 0
priority  = 5
guardflag = MA
pausetime = 12,22
sparkxy = 0,-110
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 18
ground.hittime  = 21
ground.velocity = -1.2,-11
guard.velocity = -6
air.velocity = -1.2,-9
airguard.velocity = -4,-4.5
p2facing = 1
fall = 1
fall.recovertime = 60
yaccel = .4

[State 1120, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Light Kung Fu Blow
; CNS difficulty: easy
; Notes: This uses the EnvShake controller to shake the screen. It makes the
;        move look stronger.
[Statedef 1200]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 100
velset = 0,0
anim = 1200
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = !(enemynear,movereversed)
trigger1 = animelem = 5
value = S2,ifelse(random<500,28,17)
channel = 0
lowpriority = 1

[State with voice]
type = PlaySnd
trigger1 = enemynear,movereversed
value = S2,33
channel = 0
ignorehitpause = 1
persistent = 0

[State 1200, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 3

[State 1200, Width 1]
type = Width
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
value = 10,0

[State 1200, Width 2]
type = Width
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = 20,0

[State 1200, Shake Screen]
type = EnvShake
trigger1 = AnimElem = 6
time = 4     ;Time to shake screen
ampl = 2     ;Amount to shake
freq = 180   ;A frequency of 180 shakes the screen rapidly

[State 0, ReversalDef]
type = ReversalDef
trigger1 = animelemtime(4) < 0
reversal.attr = SCA,NA,SA,HA
pausetime = 12,12
sparkno = 40
hitsound = F6,0
numhits = 0

[State 1200, 2]
type = HitDef
trigger1 = AnimElem = 6
attr = S, SA
animtype  = Hard
damage    = 100, 6
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = 0,-65
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 16
ground.hittime  = 18
ground.velocity = -10
guard.hittime  = 9
ground.cornerpush.veloff = -12 ;To push far away when p2 is in corner
guard.velocity = -7
air.velocity = -3.5,-4.5
airguard.velocity = -3.5,-4.5

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Strong Kung Fu Blow
; CNS difficulty: easy
[Statedef 1210]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 120
velset = 0,0
anim = 1210
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = !(enemynear,movereversed)
trigger1 = animelem = 5
value = S2,ifelse(random<500,28,17)
channel = 0
lowpriority = 1

[State with voice]
type = PlaySnd
trigger1 = enemynear,movereversed
value = S2,33
channel = 0
ignorehitpause = 1
persistent = 0

[State 1210, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 3

[State 1210, Width 1]
type = Width
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
value = 10,0

[State 1210, Width 2]
type = Width
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = 20,0

[State 1210, Shake Screen]
type = EnvShake
trigger1 = AnimElem = 6
time = 8
ampl = 2
freq = 170   ;A frequency of less than 180 causes a dampening effect

[State 0, ReversalDef]
type = ReversalDef
trigger1 = animelemtime(4) < 0
reversal.attr = SCA,NA,SA,HA
pausetime = 12,12
sparkno = 40
hitsound = F6,0
numhits = 0

[State 1210, 2]
type = HitDef
trigger1 = AnimElem = 6
attr = S, SA
animtype  = Hard
damage    = 125, 9
priority  = 5
guardflag = MA
pausetime = 12,12
sparkxy = 0,-65
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 22
guard.hittime  = 11
ground.velocity = -10
ground.cornerpush.veloff = -15 ;To push far away when p2 is in corner
guard.velocity = -8
air.velocity = -4,-4.5
airguard.velocity = -4,-4.5

[State 1210, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Fast Kung Fu Blow
; CNS difficulty: easy
[Statedef 1220]
type    = S
movetype= A
physics = S
juggle  = 6
poweradd= -330
velset = 0,0
anim = 1220
ctrl = 0
sprpriority = 2

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State with voice]
type = PlaySnd
trigger1 = !(enemynear,movereversed)
trigger1 = animelem = 5
value = S2,ifelse(random<500,28,17)
channel = 0
lowpriority = 1

[State with voice]
type = PlaySnd
trigger1 = enemynear,movereversed
value = S2,33
channel = 0
ignorehitpause = 1
persistent = 0

[State 1220, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1220, Afterimage]
type = AfterImageTime
trigger1 = AnimTime < -2
time = 2

[State 1220, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State 1220, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 3

[State 1220, Width 1]
type = Width
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
value = 10,0

[State 1220, Width 2]
type = Width
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(9) < 0
value = 20,0

[State 1220, Shake Screen]
type = EnvShake
trigger1 = AnimElem = 6
time = 8
ampl = 3
freq = 170

[State 0, ReversalDef]
type = ReversalDef
trigger1 = animelemtime(4) < 0
reversal.attr = SCA,NA,SA,HA
pausetime = 12,12
sparkno = 40
hitsound = F6,0
numhits = 0

[State 1220, 2]
type = HitDef
trigger1 = AnimElem = 6
attr = S, SA
animtype  = Hard
damage    = 135, 10
getpower  = 0
priority  = 5
guardflag = MA
pausetime = 15,15
sparkxy = 0,-65
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 20
ground.hittime  = 30
guard.hittime  = 15
ground.velocity = -15
ground.cornerpush.veloff = -20 ;To push far away when p2 is in corner
guard.velocity = -9
air.velocity = -5,-5
airguard.velocity = -5,-5
air.fall = 1
fall.animtype = Hard           ;Show "hard" animtype when hit for a fall
yaccel = .4                    ;Fall faster

[State 1220, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Kung Fu Laser
[Statedef 1250]
type    = S
movetype= I
physics = S
poweradd= 110
velset = 0,0
anim = 1250
ctrl = 0
;sprpriority = 2

[State 0, ]
type = PlaySnd
trigger1 = time = 2
trigger1 = prevstateno != 3100
value = S2,34
channel = 0

[State 0, ]
type = PlaySnd
trigger1 = animelem = 10
value = S0,12

[State 0, ]
type = PlaySnd
trigger1 = animelem = 6
value = S0,13

[State 0, ]
type = PlaySnd
trigger1 = animelem = 11
value = S0,11

[State 0, Width]
type = Width
trigger1 = animelemno(0) >= 5
value = 21,12
ignorehitpause = 1
[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 2
x = 26
[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 3
x = 10
[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 4
x = 5

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 1251
ctrl = 0


[Statedef 1251]
type    = S
movetype= A
physics = S
juggle  = 3
velset = 0,0
anim = ifelse(var(22),3102,1251)
ctrl = 0
;sprpriority = 2

[State 0, Width]
type = Width
trigger1 = 1
value = 19,12
ignorehitpause = 1

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
var(8) = 0
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = command = "x"
trigger2 = command = "y"
var(8) = 9
ignorehitpause = 1
[State 0, VarSet]
type = VarAdd
trigger1 = var(8) > 0
var(8) = -1
ignorehitpause = 1

[State 3000, 1]
type = PlaySnd
trigger1 = AnimElem = 2
value = 0, 16

[State 3000, 2]
type = VelAdd
trigger1 = AnimElem = 2
x = ifelse(anim=3102,-1.6,-1)

[State 0, ]
type = Explod
trigger1 = AnimElem = 2
anim = 3103
pos = 0,0
postype = p1
bindtime = 3
sprpriority = 10
ownpal = 1
removeongethit = 1
ignorehitpause = 1
[State 0, ]
type = Explod
;trigger1 = anim != 3102
trigger1 = AnimElem = 2
anim = 1255
pos = 0,0
postype = p1
bindtime = 3
sprpriority = 12
ownpal = 1
removeongethit = 1
ignorehitpause = 1
[State 0, ]
type = Explod
trigger1 = anim = 3102
trigger1 = AnimElem = 2
anim = 1256
pos = 73,-61
scale = 2,.5
postype = p1
bindtime = 3
sprpriority = -1
ownpal = 1
removeongethit = 1
ignorehitpause = 1

[State 3000, 5]
type = HitDef
trigger1 = anim != 3102
trigger1 = AnimElem = 2
attr = S, SP
animtype  = Hard
damage    = 16,0
getpower  = 0
priority  = 6
guardflag = MA
pausetime = 0,0
sparkxy = -10,-60
hitsound   = 5,1
guardsound = 6,0
ground.type = Low
ground.slidetime = 25
ground.hittime  = 25
guard.hittime  = 11
ground.velocity = -5
air.velocity = -3,-3
air.fall = 1
fall.animtype = Hard
fall.recover = 0
;ground.cornerpush.veloff = 0
;air.cornerpush.veloff = 0

[State 3000, 5]
type = HitDef
trigger1 = anim = 3102
trigger1 = AnimElem = 2
attr = S, HP
animtype  = Hard
damage    = 17,3
getpower  = 0
priority  = 6
guardflag = MA
pausetime = 0,0
sparkxy = -10,-60
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
guard.hittime  = 15
ground.velocity = -7
air.velocity = -3,-1.9
air.fall = 1
fall.animtype = Hard
fall.recover = 0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0
getpower = 0

[State 0, VarSet]
type = VarAdd
trigger1 = anim = 3102
trigger1 = AnimElem = 2
var(22) = -1

[State 3000, 7]
type = ChangeState
triggerall = AnimTime = 0
trigger1 = !var(55)
trigger1 = command != "holdx" && command != "holdy"
;trigger1 = prevstateno != 3100
trigger1 = var(8) <= 0
trigger2 = anim = 3102
trigger2 = var(22) <= 0
trigger3 = var(55)
trigger3 = (((p2bodydist x >= 145) || (p2bodydist x < 0) || (p2bodydist y <= -70)) && var(22) <= 0) || (p2stateno = [120,169])
value = 3103
ignorehitpause = 1

;---------------------------------------------------------------------------
; Power Stomp
; CNS difficulty: easy
; Notes: This uses the EnvShake controller to shake the screen. It makes the
;        move look stronger.
[Statedef 1300]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 100
velset = 0,0
anim = 1300
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,14
channel = 0

[State 1200, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 6

[State 1200, Width 1]
type = null;Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(7) < 0
value = 74,0

[State 1200, Shake Screen]
type = EnvShake
trigger1 = AnimElem = 4
time = 10     ;Time to shake screen
ampl = 2     ;Amount to shake
freq = 180   ;A frequency of 180 shakes the screen rapidly

[State 0, ]
type = Explod
trigger1 = AnimElem = 4
anim = F60
pos = 58,0
postype = p1
facing = 1
vfacing = 1
bindtime = 1
ontop = 1
ownpal = 1
ignorehitpause = 1

[State 1200, 2]
type = HitDef
trigger1 = Time = 0
attr = S, SA
animtype  = Hard
damage    = 55, 11
priority  = 5
hitflag = MAFD
guardflag = LA
pausetime = 12,12
sparkxy = 0,0
hitsound   = 5,2
guardsound = 6,0
ground.type = Low
ground.slidetime = 16
ground.hittime  = 20
ground.velocity = -12
ground.cornerpush.veloff = -12 ;To push far away when p2 is in corner
down.velocity = -7,0
down.hittime = 20
down.slidetime = 11
guard.velocity = -7
air.velocity = -3.5,-4.5
airguard.velocity = -3.5,-4.5

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Strong Power Stomp
; CNS difficulty: easy
; Notes: This uses the EnvShake controller to shake the screen. It makes the
;        move look stronger.
[Statedef 1310]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 100
velset = 0,0
anim = 1310
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,14
channel = 0

[State 1200, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 6

[State 1200, Width 1]
type = null;Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(7) < 0
value = 74,0

[State 1200, Shake Screen]
type = EnvShake
trigger1 = AnimElem = 4
time = 10     ;Time to shake screen
ampl = 4     ;Amount to shake
freq = 180   ;A frequency of 180 shakes the screen rapidly

[State 0, ]
type = Explod
trigger1 = AnimElem = 4
anim = F61
pos = 58,0
postype = p1
facing = 1
vfacing = 1
bindtime = 1
ontop = 1
ownpal = 1
ignorehitpause = 1

[State 1200, 2]
type = HitDef
trigger1 = Time = 0
attr = S, SA
animtype  = Hard
damage    = 73, 11
priority  = 5
hitflag = MAFD
guardflag = LA
pausetime = 12,12
sparkxy = 0,0
hitsound   = 5,2
guardsound = 6,0
ground.type = trip
ground.slidetime = 16
ground.hittime  = 20
ground.velocity = -3,-3.8
ground.cornerpush.veloff = -12 ;To push far away when p2 is in corner
guard.velocity = -7
air.velocity = -3,-4.5
fall = 1
airguard.velocity = -3.5,-4.5

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Fast Power Stomp
; CNS difficulty: easy
; Notes: This uses the EnvShake controller to shake the screen. It makes the
;        move look stronger.
[Statedef 1320]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= -330
velset = 0,0
anim = 1320
ctrl = 0
sprpriority = 2

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State 1220, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 13
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 2
Trans = Add
time = 2

[State 1220, Afterimage]
type = AfterImageTime
trigger1 = AnimTime < -2
time = 2

[State 1220, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S2,14
channel = 0

[State 1200, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 5

[State 1200, Width 1]
type = null;Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(7) < 0
value = 74,0

[State 1200, Shake Screen]
type = EnvShake
trigger1 = AnimElem = 4
time = 20     ;Time to shake screen
ampl = 6     ;Amount to shake
freq = 210   ;A frequency of 180 shakes the screen rapidly

[State 0, ]
type = Explod
trigger1 = AnimElem = 4
anim = F62
pos = 58,0
postype = p1
facing = 1
vfacing = 1
bindtime = 1
ontop = 1
ownpal = 1
ignorehitpause = 1

[State 1200, 2]
type = HitDef
trigger1 = Time = 0
attr = S, SA
animtype  = Hard
damage    = 80, 11
getpower = 0
priority  = 7
hitflag = MAFD
guardflag =
pausetime = 6,20
sparkxy = 0,0
hitsound   = 5,4
guardsound = 6,0
ground.type = trip
ground.slidetime = 16
ground.hittime  = 18
ground.velocity = -2,-7.8
ground.cornerpush.veloff = -12 ;To push far away when p2 is in corner
guard.velocity = -7
air.velocity = -2.5,-7.8
airguard.velocity = -3.5,-4.5
fall = 1

[State 1200, 3]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Reversi
[Statedef 1350]
type    = S
movetype= A
physics = S
poweradd= 65
ctrl = 0
velset = 0,0
anim = 1350
sprpriority = -1

[State 0, ]
type = ReversalDef
trigger1 = 1
reversal.attr = SCA,AA,AT
p1stateno = 1351
ignorehitpause = 1
persistent = 1
priority = 7, hit
pausetime = 0,2

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Slap
[Statedef 1351]
type    = S                      ;State-type: S-stand, C-crouch, A-air, L-liedown
movetype= A                      ;Move-type: A-attack, I-idle, H-gethit
physics = S                      ;Physics: S-stand, C-crouch, A-air
;Commonly-used controllers:
velset = 0,0                     ;Set velocity (x,y) (Def: no change)
ctrl = 0                         ;Set ctrl (Def: no change)
anim = 1352                       ;Change animation (Def: no change)
sprpriority = 2                  ;Set layering priority to 2 (in front)

[State with voice]
type = PlaySnd
trigger1 = time = 1
value = S2,ifelse(random<333,10,ifelse(random<333,13,27) )
channel = 0
ignorehitpause = 1

[State 0, ]
type = NotHitBy
trigger1 = 1
value = SCA

[State 0, ]
type = EnvColor
trigger1 = time = 0
value = 255,255,255
time = 10

[State 200, 1]
type = HitDef
trigger1 = time = 0
attr = S, SA                     ;Attribute: Standing, Normal Attack
damage = 110, 25                   ;Damage that move inflicts, guard damage
animtype = Hard                 ;Animation type: Light, Medium, Heavy, Back (def: Light)
guardflag =                    ;Flags on how move is to be guarded against
hitflag = MAF                    ;Flags of conditions that move can hit
pausetime = 0, 0                 ;Time attacker pauses, time opponent shakes
sparkno = 2                      ;Spark anim no (Def: set above)
sparkxy = -10, -50               ;X-offset for the "hit spark" rel. to p2,
;Y-offset for the spark rel. to p1
hitsound = S0, 9                  ;Sound to play on hit
guardsound = 6, 0                ;Sound to play on guard
ground.type = High               ;Type: High, Low, Trip (def: Normal)
ground.slidetime = 5             ;Time that the opponent slides back
ground.hittime  = 12             ;Time opponent is in hit state
ground.velocity = 0,-30             ;Velocity at which opponent is pushed
air.type = High                  ;Type: High, Low, Trip (def: same as ground.type)
air.velocity = 0,-30           ;X-velocity at which opponent is pushed,
;Y-velocity at which opponent is pushed
air.hittime = 12                 ;Time before opponent regains control in air
fall = 1
fall.recover = 0
fall.damage = 15
getpower = 100,0

[State 200, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Rocket Punch
[Statedef 1400]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 80
velset = 0,0
anim = 1400
ctrl = 0
sprpriority = 2

[State with voice]
type = PlaySnd
trigger1 = Time = 0
;trigger1 = random < 500
value = S2,15
channel = 0

[State 1000, 1]
type = PlaySnd
trigger1 = Time = 8
value = 0, 3

[State 1000, 1]
type = PlaySnd
trigger1 = AnimElem = 5
value = 0, 10

[State 1000, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = 14

[State 1000, 2]
type = PosAdd
trigger1 = AnimElem = 3
trigger2 = AnimElem = 5
x = 3

[State 1000, 5] ;Opponent near
type = HitDef
trigger1 = AnimElem = 7
attr = S, ST
animtype  = Hard
damage    = 0, 0
priority  = 7
hitflag = MA
guardflag = M
pausetime = 0,0
sparkno = -1
guard.sparkno = -1
sparkxy = 0,0
hitsound   = -1
guardsound = 6,0
ground.type = Low
ground.slidetime = 12
ground.hittime  = 15
guard.hittime  = 8
ground.velocity = -4,-3.5
air.velocity = -4,-3
p2stateno = 1401
id = 1400

[State 1000, 6]
type = PosAdd
trigger1 = AnimTime = 0
x = -5

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
var(0) = 0
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = animelemtime(7) >= 0 && animelemtime(8) < 0
var(0) = 19
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = animelemtime(8) >= 0 && animelemtime(9) < 0
var(0) = 18
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = animelemtime(9) >= 0 && animelemtime(10) < 0
var(0) = 17
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = animelemtime(10) >= 0 && animelemtime(11) < 0
var(0) = 16
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = animelemtime(11) >= 0 && animelemtime(12) < 0
var(0) = 15
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = animelemtime(12) >= 0 && animelemtime(13) < 0
var(0) = 14
ignorehitpause = 1

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = numtarget(1400)
trigger1 = movehit
trigger1 = var(0)
trigger1 = animelemtime(13) < 0
value = 1400
elem = var(0)
ignorehitpause = 1
persistent = 0

[State 0, ]
type = TargetState
trigger1 = numtarget(1400)
trigger1 = movehit
trigger1 = AnimElem = 20
value = 1402
id = 1400

[State 810, Bind 6]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
trigger2 = AnimElemTime(20) >= 0 && AnimElemTime(21) < 0
pos = 75, 0
id = 1400

[State 810, Bind 7]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
trigger2 = AnimElemTime(19) >= 0 && AnimElemTime(20) < 0
pos = 80, 0
id = 1400

[State 810, Bind 8]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(8) >= 0 && AnimElemTime(9) < 0
trigger2 = AnimElemTime(18) >= 0 && AnimElemTime(19) < 0
pos = 96, 0
id = 1400

[State 810, Bind 9]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(9) >= 0 && AnimElemTime(10) < 0
trigger2 = AnimElemTime(17) >= 0 && AnimElemTime(18) < 0
pos = 107, 0
id = 1400

[State 810, Bind 10]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(10) >= 0 && AnimElemTime(11) < 0
trigger2 = AnimElemTime(16) >= 0 && AnimElemTime(17) < 0
pos = 116, 0
id = 1400

[State 810, Bind 11]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(11) >= 0 && AnimElemTime(12) < 0
trigger2 = AnimElemTime(15) >= 0 && AnimElemTime(16) < 0
pos = 131, 0
id = 1400

[State 810, Bind 12]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(12) >= 0 && AnimElemTime(13) < 0
trigger2 = AnimElemTime(14) >= 0 && AnimElemTime(15) < 0
pos = 144, 0
id = 1400

[State 810, Bind 13]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = AnimElemTime(13) >= 0 && AnimElemTime(14) < 0
pos = 153, 0
id = 1400

[State 810, Bind 6]
type = TargetBind
triggerall = movehit
triggerall = numtarget(1400)
trigger1 = animelem = 21
pos = 60, 0
id = 1400

[State 1000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Rocket Punch p2
[Statedef 1401]
type    = S
movetype= H
physics = S
velset = 0,0
ctrl = 0

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
value = 5000

[State 0, ]
type = SelfState
trigger1 = Time >= 120
value = 5070

;---------------------------------------------------------------------------
; Rocket Punch p2
[Statedef 1402]
type    = S
movetype= H
physics = S
velset = 0,0
ctrl = 0

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
value = 5300

[State 0, ]
type = SelfState
trigger1 = Time >= 200
value = 5100

;---------------------------------------------------------------------------
; Rugal Excusion
[Statedef 1450]
type    = S
movetype= I
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 1450
sprpriority = 2

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,46,49)
channel = 0

[State 0, StateTypeSet]
type = StateTypeSet
trigger1 = animelem = 5
movetype = A
physics = N
ignorehitpause = 1
persistent = 0

[State 0, VelSet]
type = VelSet
trigger1 = animelem = 5
x = 7
persistent = 0

[State 1010, 2]
type = PosAdd
trigger1 = AnimElem = 2
trigger2 = AnimElem = 5
x = 20

[State 1010, 3]
type = PosAdd
trigger1 = AnimElem = 3
x = 10

[State 0, ]
type = AfterImage
trigger1 = AnimElem = 5
time = 30
length = 60
palcolor = 240
paladd = 10,10,10
palmul = .8,.8,.8
timegap = 1
framegap = 4
trans = add
ignorehitpause = 1

[State 800, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, ST
hitflag = MAF
priority = 3, Miss
sparkno = -1
sprpriority = 1
p1facing = 1
p2facing = 1
p1stateno = 1460
p2stateno = 1470
guard.dist = 0
fall = 1
[State 800, 1]
type = HitDef
trigger1 = !movehit
Trigger1 = Time = 19
attr = S, ST
hitflag = MAF
guardflag = H
priority = 3, Miss
sparkno = -1
guard.sparkno = -1
sprpriority = 1
p1facing = 1
p2facing = 1
p1stateno = 1460
p2stateno = 1470
fall = 1

[State 0, Turn]
type = ChangeState
trigger1 = moveguarded
value = 1451
ignorehitpause = 1
persistent = 0

[State 800, 2]
type = ChangeState
trigger1 = time >= 25
Trigger1 = AnimTime = 0
value = 1451
ctrl = 0

;---------------------------------------------------------------------------
; CANTCATCHME
[Statedef 1451]
type    = S
movetype= I
physics = S
velset = 0,0
ctrl = 0
anim = 1459
sprpriority = 0

[State with voice]
type = PlaySnd
trigger1 = time = 0
value = S2,16
channel = 0
[State with voice]
type = PlaySnd
trigger1 = animelem = 10
value = S2,39
channel = 0

[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 10
x = 3
[State 0, Turn]
type = Turn
trigger1 = animelem = 11

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 14
value = S6,0

[State 200, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Rugal Excusion p1
[Statedef 1460]
type    = S
movetype= A
physics = S
anim = 1451
poweradd = 60
velset = 0,0
sprpriority = 0

[State 810, Grab Sound]
type = PlaySnd
triggerall = anim = 1451
trigger1 = AnimElem = 2
value = 1, 1

[State 810, Throw Sound]
type = PlaySnd
triggerall = anim = 1451
trigger1 = AnimElem = 3
value = 2, 16
channel = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 99
value = 2,29
channel = 0

[State 810, Bind 1]
type = TargetBind
triggerall = anim = 1451
trigger1 = AnimElemTime(4) < 0
pos = 4, -60

[State 810, Bind 2-4]
type = TargetBind
triggerall = anim = 1451
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(6) < 0
pos = 34, -51

[State 810, Bind 5]
type = TargetBind
triggerall = anim = 1451
trigger1 = AnimElemTime(6) >= 0 && AnimElemTime(7) < 0
pos = 39, -85

[State 810, Bind 6]
type = TargetBind
triggerall = anim = 1451
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 38, -132

[State 810, Bind 7]
type = TargetBind
triggerall = anim = 1451
trigger1 = time < 100
trigger1 = AnimElemTime(7) >= 0 && AnimElemTime(8) < 0
pos = 38, -130

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = time = 100
value = -115

[State 810, Hurt 11]
type = LifeAdd
trigger1 = time = 100
trigger1 = life < const(data.life) - 44
value = 45

[State 810, Throw 11]
type = TargetState
trigger1 = Time = 100
value = 1471

[State 810, Throw 11]
type = ChangeAnim
trigger1 = anim != 1453
trigger1 = Time >= 100
value = 1453

[State 810, Throw Sound]
type = StopSnd
trigger1 = Time = 100
channel = 0

[State 0, ]
type = PlaySnd
trigger1 = Time = 100
value = F5,4

[State 0, ]
type = EnvColor
trigger1 = Time = 100
value = 255,0,0
time = 10
ignorehitpause = 1

[State 810, State End]
type = ChangeState
trigger1 = anim = 1453
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Rugal Excusion p2
[Statedef 1470]
type    = A
movetype= H
physics = N
velset = 0,0
sprpriority = 2

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0

[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
trigger1 = 1
time = 10
add = time * 2,0,0
color = 256 - time
ignorehitpause = 1

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 1452

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = time>200;!gethitvar(isbound);
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw - thrown into the air
; (a custom gethit state)
; Description: This state has the opponent flying through the air and
;     falling down onto the ground. The SelfState controller sets the
;     opponent back using to his own state file when he his the ground.
;     Controllers 821,2 and 821,3 allow the opponent to recover by
;     hitting his recovery command when he is falling.
[Statedef 1471]
type    = A
movetype= H
physics = N
velset = -3.8,-12
poweradd = 40

[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
trigger1 = Time = 0
time = 10
add = 256,0,0
mul = 256,256,256
sinadd = 0,0,0,1
invertall = 1
color = 256

[State 0, ]
type = ChangeAnim2
trigger1 = Time = 0
value = 1454

[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = .8

[State 821, 2] ; Recover near ground (use ChangeState)
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -20
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 ;HITFALL_RECOVER

[State 821, 3] ; Recover in mid air (use SelfState)
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 ;HITFALL_AIRRECOVER

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground

;---------------------------------------------------------------------------
; Light Low Kung Fu Cannonball
[Statedef 1500]
type    = A
movetype= A
physics = N
anim = 1500
poweradd = 40
juggle = 2
ctrl = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,46,49)
channel = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,15
freqmul = 1.2
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 4
value = S0,29
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 4
helpertype = normal
name = "Ripple"
ID = 1508
stateno = 1508
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 7
helpertype = normal
name = "Ripple"
ID = 1509
stateno = 1509
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1

;[State 0, PlaySnd]
;type = PlaySnd
;trigger1 = animelem = 5
;value = S0,30

[State 0, VelSet]
type = VelSet
trigger1 = time = 0
x = -1.4
y = -3
[State 0, VelSet]
type = VelSet
trigger1 = animelem = 4
x = 4
y = -2.2
ignorehitpause = 1
persistent = 0
[State 0, VelSet]
type = VelMul
trigger1 = moveguarded = 1
trigger1 = vel x > 0
x = -0.8
y = ifelse(vel y<0,1.11,-1.11)
ignorehitpause = 1

[State 610, 3]
type = HitDef
trigger1 = timemod = 6,2
trigger1 = !moveguarded
attr = A, SA
damage = floor(46 / (hitcount+1) )
guardflag = HA
priority = 4
pausetime = 6,6
guard.pausetime = 9,9
sparkno = 1
sparkxy = -10,-60
hitsound   = 5,3
guardsound = 6,0
animtype = Med
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -5
air.velocity = -3,-4

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= 0
value = ifelse(moveguarded,5100,1052)

;---------------------------------------------------------------------------
; Strong Low Kung Fu Cannonball
[Statedef 1510]
type    = A
movetype= A
physics = N
anim = 1510
poweradd = 60
juggle = 1
ctrl = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,46,49)
channel = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,15
freqmul = 1.2
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,29
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 5
helpertype = normal
name = "Ripple"
ID = 1508
stateno = 1508
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 8
helpertype = normal
name = "Ripple"
ID = 1509
stateno = 1509
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1

;[State 0, PlaySnd]
;type = PlaySnd
;trigger1 = animelem = 5
;value = S0,30

[State 0, VelSet]
type = VelSet
trigger1 = time = 0
x = -1.6
y = -4.2
[State 0, VelSet]
type = VelSet
trigger1 = animelem = 5
x = 5.41
y = 0.2
ignorehitpause = 1
persistent = 0
[State 0, VelSet]
type = VelSet
trigger1 = movecontact = 1
;trigger1 = movehit = 1
;trigger2 = moveguarded = 1
y = -6
ignorehitpause = 1
[State 0, VelSet]
type = VelMul
trigger1 = moveguarded = 1
trigger1 = vel x > 0
x = -0.8
ignorehitpause = 1

[State 610, 3]
type = HitDef
trigger1 = time = 0
trigger2 = vel y > 0
trigger2 = !moveguarded
attr = A, SA
damage = 82
guardflag = HA
priority = 4
pausetime = 8,8
sparkno = 2
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
animtype = hard
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -3,6
air.velocity = -2,6
fall = 1
envshake.time = 8
envshake.ampl = 4
envshake.freq = 173

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= 0
value = ifelse(moveguarded,5100,1052)

;---------------------------------------------------------------------------
; Fast Low Kung Fu Cannonball
[Statedef 1520]
type    = A
movetype= A
physics = N
anim = 1520
poweradd = -330
juggle = 3
ctrl = 0

[State 0, PlayerPush]
type = PlayerPush
trigger1 = movehit
value = 0
ignorehitpause = 1

[State 0, ScreenBound]
type = ScreenBound
trigger1 = !movecontact
value = 0
ignorehitpause = 1

[State 0, AngleDraw]
type = AngleDraw
trigger1 = animelemtime(5) < 0
scale = 1 + time*4,1

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State 1020, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 20
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 1
Trans = Add
time = 2

[State 1020, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2
ignorehitpause = 1
[State 1020, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 4
value = S2,ifelse(random<500,52,9)
channel = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,15
freqmul = 1.15
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,15
freqmul = 1.61
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,29
persistent = 0
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,32
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 5
helpertype = normal
name = "Ripple"
ID = 1508
stateno = 1508
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 8
helpertype = normal
name = "Ripple"
ID = 1509
stateno = 1509
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1

;[State 0, PlaySnd]
;type = PlaySnd
;trigger1 = animelem = 5
;value = S0,30

[State 0, VelSet]
type = VelSet
trigger1 = time = 0
x = -0.5
y = -6
[State 0, VelSet]
type = VelSet
trigger1 = animelem = 5
x = 2
y = 34
ignorehitpause = 1
persistent = 0
[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 5
x = ifelse(p2dist x<144,p2dist x,144) - 4
ignorehitpause = 1
persistent = 0
[State 0, PosAdd]
type = PosSet
trigger1 = animelem = 5
y = -300
ignorehitpause = 1
persistent = 0
[State 0, VelSet]
type = VelSet
trigger1 = movecontact = 1
;trigger1 = movehit = 1
;trigger2 = moveguarded = 1
x = -3.2
y = -4.1
ignorehitpause = 1

[State 610, 3]
type = HitDef
trigger1 = time = 0
attr = A, SA
damage = 109
guardflag = HA
priority = 4
pausetime = 8,12
sparkno = 3
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
animtype = hard
ground.type = High
ground.slidetime = 17
ground.hittime  = 23
guard.hittime = 7
ground.velocity = -1,-7.2
air.velocity = -1,6
fall = 1
getpower = 0
envshake.time = 10
envshake.ampl = -6
envshake.freq = 200

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= 0
value = ifelse(moveguarded,5100,1052)


;---------------------------------------------------------------------------
; Light Low Kung Fu Cannonball
[Statedef 1550]
type    = A
movetype= A
physics = N
anim = 1500
poweradd = 40
juggle = 2
ctrl = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,46,49)
channel = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,15
freqmul = 1.2
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 4
value = S0,29
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 4
helpertype = normal
name = "Ripple"
ID = 1508
stateno = 1508
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 7
helpertype = normal
name = "Ripple"
ID = 1509
stateno = 1509
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1

;[State 0, PlaySnd]
;type = PlaySnd
;trigger1 = animelem = 5
;value = S0,30

[State 0, VelSet]
type = VelSet
trigger1 = time = 0
x = -1.4
y = -3
[State 0, VelSet]
type = VelSet
trigger1 = animelem = 4
x = 6.8
y = -2
ignorehitpause = 1
persistent = 0
[State 0, VelSet]
type = VelMul
trigger1 = moveguarded = 1
trigger1 = vel x > 0
x = -0.8
y = ifelse(vel y<0,1.11,-1.11)
ignorehitpause = 1

[State 610, 3]
type = HitDef
trigger1 = timemod = 6,2
trigger1 = !moveguarded
attr = A, SA
damage = floor(46 / (hitcount+1) )
guardflag = HA
priority = 4
pausetime = 6,6
guard.pausetime = 9,9
sparkno = 1
sparkxy = -10,-60
hitsound   = 5,3
guardsound = 6,0
animtype = Med
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -5
air.velocity = -3,-4

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= 0
value = ifelse(moveguarded,5100,1052)

;---------------------------------------------------------------------------
; Strong Low Kung Fu Cannonball
[Statedef 1560]
type    = A
movetype= A
physics = N
anim = 1510
poweradd = 60
juggle = 1
ctrl = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,46,49)
channel = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,15
freqmul = 1.2
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,29
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 5
helpertype = normal
name = "Ripple"
ID = 1508
stateno = 1508
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 8
helpertype = normal
name = "Ripple"
ID = 1509
stateno = 1509
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1

;[State 0, PlaySnd]
;type = PlaySnd
;trigger1 = animelem = 5
;value = S0,30

[State 0, VelSet]
type = VelSet
trigger1 = time = 0
x = -1.6
y = -4.2
[State 0, VelSet]
type = VelSet
trigger1 = animelem = 5
x = 8.11
y = -1.5
ignorehitpause = 1
persistent = 0
[State 0, VelSet]
type = VelSet
trigger1 = movecontact = 1
;trigger1 = movehit = 1
;trigger2 = moveguarded = 1
y = -6
ignorehitpause = 1
[State 0, VelSet]
type = VelMul
trigger1 = moveguarded = 1
trigger1 = vel x > 0
x = -0.8
ignorehitpause = 1

[State 610, 3]
type = HitDef
trigger1 = time = 0
trigger2 = vel y > 0
trigger2 = !moveguarded
attr = A, SA
damage = 82
guardflag = HA
priority = 4
pausetime = 8,8
sparkno = 2
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
animtype = hard
ground.type = High
ground.slidetime = 17
ground.hittime  = 19
guard.hittime  = 7
ground.velocity = -3,6
air.velocity = -2,6
fall = 1
envshake.time = 8
envshake.ampl = 4
envshake.freq = 173

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= 0
value = ifelse(moveguarded,5100,1052)

;---------------------------------------------------------------------------
; Fast Low Kung Fu Cannonball
[Statedef 1570]
type    = A
movetype= A
physics = N
anim = 1520
poweradd = -330
juggle = 1
ctrl = 0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = !movecontact
value = 0
ignorehitpause = 1

[State 0, AngleDraw]
type = AngleDraw
trigger1 = animelemtime(5) < 0
scale = 1 + time*4,1

[State KI2 EX SOUND EFFECT]
type = PlaySnd
trigger1 = time = 0
value = S0,31

[State 1020, Afterimage]
type = AfterImage
trigger1 = Time = 0
length = 20
PalBright   =  30, 30,  0
PalContrast =  70, 70, 20
PalAdd      = -10,-10,-10
PalMul      = .85,.85,.50
TimeGap  = 1
FrameGap = 1
Trans = Add
time = 2

[State 1020, Afterimage]
type = AfterImageTime
trigger1 = 1
time = 2
ignorehitpause = 1
[State 1020, Blink Yellow]
type = PalFX
trigger1 = Time = 0
time = 20
add = 32,16,0
sinadd = 64,32,5,3

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 4
value = S2,ifelse(random<500,52,9)
channel = 0

[State 0, Gravity]
type = Gravity
trigger1 = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,15
freqmul = 1.15
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,15
freqmul = 1.61
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,29
persistent = 0
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 5
value = S0,32
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 5
helpertype = normal
name = "Ripple"
ID = 1508
stateno = 1508
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1
persistent = 0
[State 0, Helper]
type = Helper
trigger1 = animelem = 8
helpertype = normal
name = "Ripple"
ID = 1509
stateno = 1509
pos = 0,-60
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
;ignorehitpause = 1

;[State 0, PlaySnd]
;type = PlaySnd
;trigger1 = animelem = 5
;value = S0,30

[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 5
x = 290
y = p2bodydist y - 12
ignorehitpause = 1
persistent = 0
[State 0, Turn]
type = Turn
trigger1 = animelem = 5
persistent = 0
[State 0, VelSet]
type = VelSet
trigger1 = time = 0
x = -0.5
y = -6
[State 0, VelSet]
type = VelSet
trigger1 = animelem = 5
x = 25
y = -4.5
ignorehitpause = 1
persistent = 0
[State 0, VelSet]
type = VelSet
trigger1 = movecontact = 1
;trigger1 = movehit = 1
;trigger2 = moveguarded = 1
x = 6
y = -6
ignorehitpause = 1

[State 610, 3]
type = HitDef
trigger1 = time = 0
attr = A, SA
damage = 113
guardflag = HA
priority = 4
pausetime = 8,12
sparkno = 3
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
animtype = diagup
ground.type = High
ground.slidetime = 17
ground.hittime  = 23
guard.hittime  = 7
ground.velocity = -2,-3
air.velocity = -2,6
fall = 1
getpower = 0
envshake.time = 10
envshake.ampl = -6
envshake.freq = 200

[State 1055, 6] ;Change state when KFM is close to ground
type = ChangeState
trigger1 = Vel Y > 0 && Pos Y >= 0
value = ifelse(moveguarded,5100,1052)

; Smoke Ripple Effect
[Statedef 1508]
type    = S
movetype = I
physics = S
sprpriority = -6
anim = 1508
ctrl = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
[State 0, VarSet]
type = VarAdd
trigger1 = time
trigger1 = parent,hitpausetime = 0
fvar(0) = 3
[State 0, VarSet]
type = VarAdd
trigger1 = time
trigger1 = parent,hitpausetime = 0
fvar(1) = 0.041
[State 0, VarAdd]
type = VarAdd
trigger1 = time
trigger1 = parent,hitpausetime = 0
var(0) = 31
[State 0, AngleDraw]
type = AngleDraw
trigger1 = 1
value = var(0)
scale = 1.2+fvar(1),1.1+fvar(1)
[State 0, Trans]
type = Trans
trigger1 = 1
trans = sub
[State 0, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = floor(0-fvar(0)),floor(0-fvar(0)),floor(0-fvar(0))
mul = 280,280,280
[State 0, ]
type = DestroySelf
trigger1 = fvar(0) >= 200


; Ripple Effect
[Statedef 1509]
type    = S
movetype = I
physics = S
sprpriority = 13
anim = 1509
ctrl = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 1
value = S0,30
[State 0, VarSet]
type = VarAdd
trigger1 = time
trigger1 = parent,hitpausetime = 0
fvar(0) = 7
[State 0, VarSet]
type = VarAdd
trigger1 = time
trigger1 = parent,hitpausetime = 0
fvar(1) = 0.021
[State 0, VarAdd]
type = VarAdd
trigger1 = time
trigger1 = parent,hitpausetime = 0
var(0) = 17
[State 0, AngleDraw]
type = AngleDraw
trigger1 = 1
value = var(0)
scale = 1+fvar(1),1+fvar(1)
[State 0, Trans]
type = Trans
trigger1 = 1
trans = add
[State 0, PalFX]
type = PalFX
trigger1 = 1
time = 1
add = floor(0-fvar(0)),floor(0-fvar(0)),floor(0-fvar(0))
mul = 280,280,280
[State 0, ]
type = DestroySelf
trigger1 = fvar(0) >= 200


;---------------------------------------------------------------------------
; Triple Kung Fu Palm (hyper)
; CNS difficulty: medium
; Notes: Notice that the HitDefs in supers have "getpower = 0". This makes
;        sure KFM doesn't recharge his super guage as he hits.
;        Also, the attributes for the HitDefs is "HA" for "hyper attack",
;        ie. "attr = S, HA".
;        Notice how the first HitDef is reused twice by allowing it to
;        trigger on two animation elements.
[Statedef 3000]
type    = S
movetype= A
physics = S
juggle  = 2
velset = 0,0
anim = 3000
ctrl = 0
sprpriority = 2

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse( random<500 , ifelse(random<500,53,54) , ifelse(random<500,46,49) )
channel = 0

[State 0, Turn]
type = Turn
trigger1 = time = 0
trigger1 = prevstateno = 1021

[State 3000, Width]
type = Width
trigger1 = AnimElem = 2, >= 0
value = 15,0

[State 3000, Super A]
type = SuperPause
trigger1 = AnimElem = 2, 1
pos = 25, -57
anim = 100
sound = 20, 0
poweradd = -1000

[State 3000, Super B]
type = AfterImage
trigger1 = AnimElem = 2, 1
time = 2

[State 3000, Super C]
type = AfterImageTime
trigger1 = AnimElemTime(2) >= 1 && Time < 60
time = 2

[State 3000, Super D]
type = NotHitBy
trigger1 = AnimElem = 2
value = , NA, SA, AT
time = 12

[State 3000, Super E]
type = NotHitBy
trigger1 = AnimElemTime(2) >= 0 && Time < 30
value2 = C, NA
time = 1

[State 3000, 1]
type = PlaySnd
trigger1 = AnimElem = 4
trigger2 = AnimElem = 11
trigger3 = AnimElem = 18
value = 0, 3

[State with voice]
type = PlaySnd
trigger1 = animelem = 4
value = S2,40
channel = 0

[State with voice]
type = PlaySnd
trigger1 = animelem = 11
value = S2,41
channel = 0

[State with voice]
type = PlaySnd
trigger1 = animelem = 18
value = S2,42
channel = 0

[State 3000, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = 20

[State 3000, 3]
type = PosAdd
trigger1 = AnimElem = 3
trigger2 = AnimElem = 10
trigger3 = AnimElem = 12
trigger4 = AnimElem = 17
trigger5 = AnimElem = 19
trigger4 = AnimElem = 29
x = 10

[State 3000, 4]
type = VelSet
trigger1 = AnimElem = 5
trigger2 = AnimElem = 12
trigger3 = AnimElem = 19
x = 36

[State 3000, 4]
type = PosAdd
trigger1 = AnimElem = 5
x = 5

[State 0, Turn]
type = Turn
triggerall = p2dist x < -5
trigger1 = animelem = 10
trigger2 = animelem = 18
ignorehitpause = 1
[State 0, PlayerPush]
type = PlayerPush
trigger1 = movehit
trigger2 = abs(vel x) >= 8
value = 0
ignorehitpause = 1
[State 1020, 1]
type = PlaySnd
trigger1 = AnimElem = 5
trigger2 = AnimElem = 12
trigger3 = AnimElem = 19
value = 0, 17
[State 0, ]
type = Explod
trigger1 = AnimElem = 5
trigger2 = AnimElem = 12
trigger3 = AnimElem = 19
anim = 1022
pos = 39,-59
scale = 1,1
postype = p1
bindtime = 1
sprpriority = 12
facing = -1
vel = vel x,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1

[State 3000, 5]
type = HitDef
trigger1 = AnimElem = 5
trigger2 = AnimElem = 12
attr = S, HA
animtype  = Hard
damage    = 50,4
getpower  = 0
priority  = 6
guardflag = MA
pausetime = 0,12
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -6
air.velocity = -3,-3
air.fall = 1
fall.animtype = Hard
fall.recover = 0

[State 3000, 6]
type = HitDef
trigger1 = AnimElem = 19
attr = S, HA
animtype  = Hard
damage    = 60,4
getpower  = 0
priority  = 5
guardflag = MA
pausetime = 8,15
sparkxy = -10,-60
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -5.5, -5.5
guard.velocity = -12
air.velocity = -5.5,-5.5
airguard.velocity = -3,-3
fall.animtype = Hard
fall = 1
fall.recover = 0

[State 3000, 7]
type = ChangeState
trigger1 = var(55)
trigger1 = movehit
trigger1 = animelem = 25
trigger2 = animelemtime(21) >= 0
trigger2 = command = "x" || command = "y"
value = 3001

[State 3000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Smash Kung Fu Upper (followup)
[Statedef 3001]
type    = S
movetype= A
physics = S
juggle  = 4
velset = 0,0
anim = 3001
ctrl = 0
sprpriority = 2

[State 0, Turn]
type = Turn
triggerall = time = 0
trigger1 = p2bodydist x <= -30

[State 3050, Width]
type = Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(16) < 0
value = 5,0

[State 3050, Super C]
type = AfterImageTime
trigger1 = 1
time = 2

[State 3050, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[State with voice]
type = PlaySnd
trigger1 = AnimElem = 3
value = S2,52
channel = 0

[State 3050, 2]
type = HitDef
trigger1 = Time = 0
attr = S, HA
animtype  = Up               ;Make p2 use "Up" type animation on hit
damage    = 65, 12
getpower  = 0
priority  = 5
guardflag = M
pausetime = 30,30
sparkno = 3
sparkxy = 0,-110
hitsound   = 5,4
guardsound = 6,0
ground.type = Low
ground.slidetime = 26
ground.hittime  = 26
ground.velocity = -1.3,-25
guard.velocity = -11
air.velocity = -1.3,-25
airguard.velocity = -4.5,-5
envshake.time = 25           ;Parameters for shaking the screen on hit
envshake.ampl = 7
envshake.freq = 176
p2facing = 1                 ;Force p2 to face p1 on hit
fall = 1
fall.recover = 0             ;Prevent p2 from recovering
fall.damage = 20             ;p2 will take 70 damage on hitting the ground
fall.envshake.ampl = 6       ;Parameters for shaking the screen on fall
fall.envshake.freq = 178
fall.envshake.time = 15
mindist = 50,-100            ;Keep p2 a minimum of 50 pixels away from p1, and no higher than 100 pixels up
maxdist = 100,-10            ;Keep p2 a maximum of 100 pixels away from p1, and no lower than 10 pixels below
yaccel = .8                  ;Accelerate p2 downwards rapidly

;This controller below makes Kung Fu man change to a success state if he
;successfully hits the Smash Kung Fu Upper.
[State 3050, 4]
type = ChangeState
trigger1 = MoveHit
value = 3002

[State 3050, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------
; Smash Kung Fu Upper (success)
; Description: This is the state that KFM changes to if he successfully hits
;     with Smash Kung Fu Upper. KFM holds his arm high for a short while
;     longer, then changes back to his idle stand state.
[Statedef 3002]
type    = S
movetype= A
physics = S
anim = 3002

[State 3051, 1]
type = AfterImageTime
trigger1 = AnimTime < -2
time = 2

[State 3051, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1


;---------------------------------------------------------------------------
; Smash Kung Fu Upper (hyper)
; CNS difficulty: medium
; Description: This is very similar to KFM's Strong and Light Kung Fu Uppers.
;     There is just one HitDef, for a screen-shaking hit. The envshake
;     parameters are used to make this effect. You can find out more about
;     each parameter in the CNS documentation.
;     The fall.recover parameter is set at 0, meaning that p2 cannot recover
;     from the fall by entering his recovery command (for KFM, that is x+y).
;     This gives the attacking KFM a chance to follow up with another attack,
;     such as the Fast Kung Fu Palm.
;     Note that there is a ChangeState controller used to make KFM change to
;     a success state if he hits. The success state has KFM hold his arm
;     up longer for a dramatic effect.
[Statedef 3050]
type    = S
movetype= A
physics = S
juggle  = 4
velset = 0,0
anim = 3050
ctrl = 0
sprpriority = 2

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,46,49)
channel = 0

[State 0, PosAdd]
type = PosAdd
trigger1 = animelem = 2
trigger2 = animelem = 3
trigger3 = animelem = 4
trigger4 = animelem = 5
trigger5 = animelem = 6
trigger6 = animelem = 7
x = 1

[State 0, Turn]
type = Turn
triggerall = time = 0
trigger1 = prevstateno = 1021
trigger2 = p2bodydist x <= -30

[State 3050, Width]
type = Width
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(16) < 0
value = 5,0

[State 3050, Super A]
type = SuperPause
trigger1 = AnimElem = 2
pos = -5, -55
anim = 100
sound = 20, 0
poweradd = -1000

[State 3050, Super B]
type = AfterImage
trigger1 = AnimElem = 2
time = 2

[State 3050, Super C]
type = AfterImageTime
trigger1 = AnimElemTime(2) >= 0
time = 2

[State 3050, Super D]
type = NotHitBy
trigger1 = AnimElem = 2
value = , NA, SA, AT
time = 6

[State 3050, 1]
type = PlaySnd
trigger1 = AnimElem = 4
value = 0, 2

[State with voice]
type = PlaySnd
trigger1 = AnimElem = 3
value = S2,4
channel = 0

[State 3050, 2]
type = HitDef
trigger1 = Time = 0
attr = S, HT
animtype  = Up
hitflag = MAF
damage    = 0, 0
getpower  = 0
priority  = 5
guardflag = 
pausetime = 0,0
guard.pausetime = 30
sparkno = -1
sparkxy = 0,-110
hitsound   = -1
guardsound = 6,0
ground.type = Low
ground.slidetime = 26
ground.hittime  = 26
guard.velocity = -11
air.velocity = -1.3,-25
airguard.velocity = -4.5,-5
p2facing = 1
fall = 1
fall.recover = 0
fall.damage = 30
p1stateno = 3051
p2stateno = 3052

[State 3050, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;------------------
; Smash Kung Fu Upper (success)
[Statedef 3051]
type    = S
movetype= A
physics = S
anim = 3051

[State with voice]
type = PlaySnd
trigger1 = time = 0
value = S2,36
channel = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S1,1
[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 2
value = S800,0

[State 3051, 1]
type = AfterImageTime
trigger1 = AnimTime < -2
time = 2

[State 810, Bind 6]
type = TargetBind
trigger1 = AnimElemTime(2) < 0
pos = 41, -60

[State 810, Bind 7]
type = TargetBind
trigger1 = AnimElemTime(2) >= 0 && AnimElemTime(3) < 0
pos = 25, -75

[State 810, Bind 8]
type = TargetBind
trigger1 = AnimElemTime(3) >= 0 && AnimElemTime(4) < 0
pos = 15, -90

[State 810, Bind 9]
type = TargetBind
trigger1 = AnimElemTime(4) >= 0 && AnimElemTime(5) < 0
pos = -5, -96

[State 810, Bind 10]
type = TargetBind
trigger1 = AnimElemTime(5) >= 0 && AnimElemTime(6) < 0
pos = -14, -90

[State 810, Bind 11]
type = TargetBind
trigger1 = AnimElem = 6
pos = -50, -50

;[State 810, Hurt 11]
;type = TargetLifeAdd
;trigger1 = AnimElem = 6
;value = -78

[State 810, Throw 11]
type = TargetState
trigger1 = AnimElem = 6
value = 3053

[State 810, Turn 12]
type = Turn
trigger1 = AnimElem = 7

[State 810, Pos 15]
type = PosAdd
trigger1 = AnimElem = 7
x = -10

[State 3051, 2]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

[Statedef 3052]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3052

[State 1026, No scroll]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0,0

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = time>80;!gethitvar(isbound);
value = 5050

;---------------------------------------------------------------------------
[Statedef 3053]
type    = A
movetype= H
physics = N
velset = 25,-7
poweradd = 40

[State 821, 1] ;Gravity
type = VelAdd
Trigger1 = 1
y = .4

[State 1026, No scroll]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0,0

[State 1026, Hit wall]
type = ChangeState
triggerall = Pos y < -15
trigger1 = BackEdgeBodyDist <= 20
trigger2 = FrontEdgeBodyDist <= 20
value = 3054

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground

[Statedef 3054]
type    = A
movetype= H
physics = N

[State 0, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 25
ampl = 7
freq = 176

[State 0, LifeAdd]
type = LifeAdd
trigger1 = time = 0
value = -223
kill = 1

[State 1027, Turn]
type = Turn
trigger1 = (Time = 0) && (FrontEdgeBodyDist <= 30)

[State 1027, Pos]
type = PosAdd
trigger1 = Time = 0
x = 15 - BackEdgeBodyDist

[State 1027, Stop moving]
type = PosFreeze
trigger1 = 1
x = 1
y = 1

[State 1027, No scroll]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 0,1

[State 1027, Spark]
type = Explod
trigger1 = Time = 0
anim = F72
pos = 0, floor (screenpos y) - 50
postype = back
sprpriority = 3

[State 1027, Anim]
type = ChangeAnim2
trigger1 = Time = 0
value = 3054

[State 1027, Sound]
type = PlaySnd
trigger1 = Time = 0
value = F7,0
[State 1027, Sound]
type = PlaySnd
trigger1 = Time = 0
value = F5,4
[State 1027, Sound]
type = PlaySnd
trigger1 = Time = 0
value = F5,4
freqmul = 0.7

[State 1027, State]
type = ChangeState
trigger1 = AnimTime = 0
value = 3055

[Statedef 3055]
type    = A
movetype= H
physics = N

[State 1028, Vel Y]
type = VelSet
trigger1 = Time = 0
y = -6

[State 1028, Vel X]
type = VelSet
trigger1 = Time = 0
x = 1.6

[State 1028, Turn]
type = Turn
trigger1 = (Time = 0) && (BackEdgeDist < 30)

[State 1028, Gravity]
type = VelAdd
trigger1 = 1
y = .35

[State 1028, Anim 5050] ;Self falling animation
type = ChangeAnim
trigger1 = Time = 0
trigger1 = !SelfAnimExist(5052)
value = 5050

[State 1028, Anim 5052] ;Self falling animation (diagup type)
type = ChangeAnim
trigger1 = Time = 0
trigger1 = SelfAnimExist(5052)
value = 5052

[State 1028, Anim 5060] ;Coming down - normal
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5050
trigger1 = SelfAnimExist(5060)
persistent = 0
value = 5060

[State 1028, Anim 5062] ;Coming down - diagup type
type = ChangeAnim
trigger1 = Vel Y > -2
trigger1 = Anim = 5052
trigger1 = SelfAnimExist(5062)
persistent = 0
value = 5062

[State 1028, Hit ground]
type = SelfState
trigger1 = (Vel y > 0) && (Pos y >= 0)
value = 5100

;---------------------------------------------------------------------------
; Secret Weapon = M4 (hyper)
; CNS difficulty: medium
[Statedef 3100]
type    = S
movetype= I
physics = S
velset = 0,0
anim = 3100
ctrl = 0
sprpriority = 2

[State 0, Turn]
type = Turn
trigger1 = time = 0
trigger1 = prevstateno = 1021

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
var(22) = 15

[State 3000, Super A]
type = SuperPause
trigger1 = Time = 0
pos = 25, -57
anim = -1
sound = 20, 0
poweradd = -1000
movetime = 30

[State 3000, Super B]
type = AfterImage
trigger1 = Time = 0
time = 2

[State 3000, Super C]
type = AfterImageTime
trigger1 = Time = 0
time = 2

[State 3000, Super D]
type = NotHitBy
trigger1 = 1
value = , NA, SA, AT
time = 6

[State with voice]
type = PlaySnd
trigger1 = animelem = 2
trigger1 = anim != 1250
value = S2,25
channel = 0

[State 0, ChangeAnim]
type = ChangeAnim
trigger1 = anim != 1250
trigger1 = animtime > -15
trigger1 = command = "holdx" || command = "holdy"
value = 1250

[State 0, ]
type = PlaySnd
trigger1 = anim = 1250
trigger1 = animelem = 10
value = S0,12
[State 0, ]
type = PlaySnd
trigger1 = anim = 1250
trigger1 = animelem = 6
value = S0,13
[State 0, ]
type = PlaySnd
trigger1 = anim = 1250
trigger1 = animelem = 11
value = S0,11

[State 0, Width]
type = Width
trigger1 = anim = 1250
trigger1 = animelemno(0) >= 5
value = 21,12
ignorehitpause = 1
[State 0, PosAdd]
type = PosAdd
trigger1 = anim = 1250
trigger1 = animelem = 2
x = 26
[State 0, PosAdd]
type = PosAdd
trigger1 = anim = 1250
trigger1 = animelem = 3
x = 10
[State 0, PosAdd]
type = PosAdd
trigger1 = anim = 1250
trigger1 = animelem = 4
x = 5

[State 3000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = ifelse(anim=1250,1251,0)
ctrl = ifelse(anim=1250,0,1)


;---------------------------------------------------------------------------
; Secret Weapon = M4 (2/3)
[Statedef 3102]
type    = S
movetype= A
physics = S
velset = 0,0
anim = 3102
ctrl = 0
sprpriority = 2

[State 3000, Super D]
type = NotHitBy
trigger1 = Time = 0
value = , NA, SA, AT
time = 12

[State 3000, 1]
type = PlaySnd
trigger1 = AnimElem = 2
value = 0, 16

[State 3000, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = -1

[State 0, ]
type = Explod
trigger1 = AnimElem = 2
anim = 3103
pos = 0,0
postype = p1
bindtime = 3
sprpriority = 10
ownpal = 1
removeongethit = 1
ignorehitpause = 1

[State 3000, 5]
type = HitDef
trigger1 = AnimElem = 2
attr = S, HP
animtype  = Hard
damage    = 15,3
getpower  = 0
priority  = 6
guardflag = MA
pausetime = 0,0
sparkxy = -10,-60
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -6
air.velocity = -3,-3
air.fall = 1
fall.animtype = Hard
fall.recover = 0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0

[State 3000, 7]
type = ChangeState
trigger1 = time >= 100
trigger1 = AnimTime = 0
value = 3103

;---------------------------------------------------------------------------
; Secret Weapon = M4 (2/3)
[Statedef 3103]
type    = S
movetype= I
physics = S
velset = 0,0
anim = 3109
ctrl = 0
sprpriority = 2

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S0,12

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 6
value = S0,13

[State 3000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Secret Weapon = M16 (hyper)
; CNS difficulty: medium
[Statedef 3110]
type    = S
movetype= I
physics = S
velset = 0,0
anim = 3100
ctrl = 0
sprpriority = 2

[State 3000, Width]
type = Width
trigger1 = AnimElem = 2, >= 0
value = 15,0

[State with voice]
type = PlaySnd
trigger1 = animelem = 2
value = S2,5
channel = 0

[State 3000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 3111
ctrl = 0

;---------------------------------------------------------------------------
; Secret Weapon = M4 (1/3)
[Statedef 3111]
type    = S
movetype= I
physics = S
velset = 0,0
anim = 3101
ctrl = 0
sprpriority = 2

[State 3000, Width]
type = Width
trigger1 = 1
value = 15,0

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S3000,0

[State 3000, Super A]
type = SuperPause
trigger1 = Time = 0
pos = 25, -57
anim = -1
sound = 20, 0
poweradd = -2000
movetime = 30

[State 3000, Super B]
type = AfterImage
trigger1 = Time = 0
time = 2

[State 3000, Super C]
type = AfterImageTime
trigger1 = Time = 0
time = 2

[State 3000, Super D]
type = NotHitBy
trigger1 = 1
value = , NA, SA, AT
time = 12

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S0,13

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 11
value = S0,12

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 12
value = S0,11

[State 3000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 3112
ctrl = 0

;---------------------------------------------------------------------------
; Secret Weapon = M4 (2/3)
[Statedef 3112]
type    = S
movetype= A
physics = S
velset = 0,0
anim = 3112
ctrl = 0
sprpriority = 2

[State 3000, Super D]
type = NotHitBy
trigger1 = Time = 0
value = , NA, SA, AT
time = 12

[State 3000, 1]
type = PlaySnd
trigger1 = AnimElem = 2
value = 0, 16

[State 3000, 2]
type = PosAdd
trigger1 = AnimElem = 2
x = -1

[State 0, ]
type = Explod
trigger1 = AnimElem = 2
anim = 3103
pos = 0,0
postype = p1
bindtime = 3
sprpriority = 10
shadow = 255,255,0
ownpal = 1
removeongethit = 1
ignorehitpause = 1

[State 3000, 5]
type = HitDef
trigger1 = AnimElem = 2
attr = S, HP
animtype  = Hard
damage    = 15,3
getpower  = 0
priority  = 6
guardflag = MA
pausetime = 0,0
sparkxy = -10,-60
hitsound   = 5,3
guardsound = 6,0
ground.type = Low
ground.slidetime = 30
ground.hittime  = 30
ground.velocity = -6
air.velocity = -3,-3
air.fall = 1
fall.animtype = Hard
fall.recover = 0
ground.cornerpush.veloff = 0
air.cornerpush.veloff = 0

[State 3000, 7]
type = ChangeState
trigger1 = time >= 150
trigger1 = AnimTime = 0
value = 3113

;---------------------------------------------------------------------------
; Secret Weapon = M4 (2/3)
[Statedef 3113]
type    = S
movetype= I
physics = S
velset = 0,0
anim = 3109
ctrl = 0
sprpriority = 2

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S0,12

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 6
value = S0,13

[State 3000, 7]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Napalm Vietnam
[Statedef 3200]
type    = S
movetype= A
physics = S
ctrl = 0
velset = 0,0
anim = 210
sprpriority = 2

[State 3000, Super A]
type = SuperPause
trigger1 = AnimElem = 2, 1
pos = 25, -57
anim = 100
sound = 20, 0
poweradd = -2000

[State 3000, Super B]
type = AfterImage
trigger1 = AnimElem = 2, 1
time = 2

[State 3000, Super C]
type = AfterImageTime
trigger1 = AnimElemTime(2) >= 1 && Time < 60
time = 2

[State 3000, Super D]
type = NotHitBy
trigger1 = AnimElem = 2
value = , NA, SA, AT
time = 12

[State with voice]
type = PlaySnd
trigger1 = Time = 6
value = S2,37
channel = 0

[State 210, Width]
type = Width
trigger1 = (AnimElemTime (2) >= 0) && (AnimElemTime (7) < 0)
value = 15,0

[State 0, ]
type = Helper
trigger1 = AnimElem = 3
helpertype = normal
name = "FireBall"
ID = 3200
pos = 20,-85
postype = p1
facing = 1
stateno = 3201
ownpal = 1
size.xscale = .75
size.yscale = .75
ignorehitpause = 1

[State 0, ]
type = Helper
trigger1 = AnimElem = 3
helpertype = normal
name = "FireBall"
ID = 3200
pos = 20,-85
postype = p1
facing = 1
stateno = 3202
ownpal = 1
size.xscale = .75
size.yscale = .75
ignorehitpause = 1

[State 0, ]
type = Helper
trigger1 = AnimElem = 3
helpertype = normal
name = "FireBall"
ID = 3200
pos = 20,-85
postype = p1
facing = 1
stateno = 3203
ownpal = 1
size.xscale = .75
size.yscale = .75
ignorehitpause = 1

[State 0, ]
type = Helper
trigger1 = AnimElem = 3
helpertype = normal
name = "FireBall"
ID = 3200
pos = 20,-85
postype = p1
facing = 1
stateno = 3204
ownpal = 1
size.xscale = .75
size.yscale = .75
ignorehitpause = 1

[State 210, 2]
type = HitDef
trigger1 = AnimElem = 3
attr = S, NA
animtype  = Medium
damage    = 57
guardflag = MA
pausetime = 12,12
sparkno = 1
sparkxy = -10,-70
hitsound   = 5,2
guardsound = 6,0
ground.type = High
ground.slidetime = 12
ground.hittime  = 13
ground.velocity = -5.5
air.velocity = -2.5,-4

[State 210, 3]
type = ChangeAnim
trigger1 = AnimElemTime(5) > 0 && AnimElemTime(6) <= 0
trigger1 = movecontact
ignorehitpause = 1
persistent = 0
value = 210
elem = 6

[State 210, 4]
type = SprPriority
trigger1 = AnimElem = 5
value = 2

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; FlameBall 1
[Statedef 3201]
type    = A
movetype= A
physics = N
ctrl = 0
velset = 2,-4
anim = 3200
sprpriority = 2

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, ]
type = Gravity
trigger1 = 1

[State 0, ]
type = ChangeState
trigger1 = pos y >= 0
trigger1 = vel y >= 0
value = 3205

;---------------------------------------------------------------------------
; FlameBall 2
[Statedef 3202]
type    = A
movetype= A
physics = N
ctrl = 0
velset = 3,-3
anim = 3200
sprpriority = 2

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, ]
type = Gravity
trigger1 = 1

[State 0, ]
type = ChangeState
trigger1 = pos y >= 0
trigger1 = vel y >= 0
value = 3205

;---------------------------------------------------------------------------
; FlameBall 3
[Statedef 3203]
type    = A
movetype= A
physics = N
ctrl = 0
velset = 4,-2
anim = 3200
sprpriority = 2

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, ]
type = Gravity
trigger1 = 1

[State 0, ]
type = ChangeState
trigger1 = pos y >= 0
trigger1 = vel y >= 0
value = 3205

;---------------------------------------------------------------------------
; FlameBall 4
[Statedef 3204]
type    = A
movetype= A
physics = N
ctrl = 0
velset = 5,-1
anim = 3200
sprpriority = 2

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, ]
type = Gravity
trigger1 = 1

[State 0, ]
type = ChangeState
trigger1 = pos y >= 0
trigger1 = vel y >= 0
value = 3205

;---------------------------------------------------------------------------
; FlameBall Burn State
[Statedef 3205]
type    = C
movetype= A
physics = C
ctrl = 0
velset = 0,0
anim = 3201
sprpriority = 2

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = noshadow
ignorehitpause = 1

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = 0,18

[State 0, ]
type = PosSet
trigger1 = Time = 0
y = 0

[State 0, ParentVarAdd]
type = ParentVarAdd
trigger1 = movehit = 1
var(25) = 1
ignorehitpause = 1

[State 3000, 5]
type = HitDef
trigger1 = (gametime%5)=0
attr = C, HP
animtype  = Hard
damage    = 0,0
getpower  = 0
priority  = 7
hitflag = MAFD
guardflag = 
pausetime = 0,0
sparkno = -1
sparkxy = 0,0
hitsound   = S0,18
guardsound = 6,0
ground.type = Low
ground.slidetime = 0
ground.hittime  = 0
ground.velocity = 0
air.velocity = 0
air.fall = 1
fall.animtype = Hard
fall.recover = 0
p2stateno = 3209
getpower = 0
numhits = 0

[State 0, ]
type = DestroySelf
trigger1 = time >= 120
trigger1 = animtime = 0

;---------------------------------------------------------------------------
; Crispy p2
[Statedef 3209]
type    = A
movetype= H
physics = N
velset = 0,-1.8
poweradd = 40

[State 0, ]
type = LifeAdd
trigger1 = time = 0
trigger2 = (gametime%2)=0
;trigger1 = 1
value = -1
ignorehitpause = 1

[State 0, ]
type = ChangeAnim
trigger1 = time = 0
trigger1 = !selfanimexist(7697)
value = 5070

[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
trigger1 = time = 0
trigger1 = !selfanimexist(7697)
time = 40
add = 61,25,0
mul = 128,128,128
sinadd = 73,24,0,12
invertall = 1
color = 1

[State 0, ]
type = ChangeAnim
trigger1 = time = 0
trigger1 = selfanimexist(7697)
value = 7697

[State 821, 1] ;Gravity
type = Gravity
Trigger1 = 1

[State 821, 2] ; Recover near ground (use ChangeState)
type = ChangeState
triggerall = Vel Y > 0
triggerall = Pos Y >= -20
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5200 ;HITFALL_RECOVER

[State 821, 3] ; Recover in mid air (use SelfState)
type = SelfState
triggerall = Vel Y > 0
triggerall = alive
triggerall = CanRecover
trigger1 = Command = "recovery"
value = 5210 ;HITFALL_AIRRECOVER

[State 821, 4] ;Hit ground
type = SelfState
trigger1 = Vel Y > 0
trigger1 = Pos Y >= 0
value = 5100 ;Hit ground

;---------------------------------------------------------------------------
; A move that not supposed to be
; CNS difficulty: medium
[Statedef 3250]
type    = S
movetype= A
physics = S
juggle  = 4
poweradd= 65
ctrl = 0
velset = 0,0
anim = 220
sprpriority = -1

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 3
value = S3000,2

[State 3000, Super A]
type = SuperPause
trigger1 = AnimElem = 2
pos = 0, 0
anim = -1
sound = 20,0
poweradd = -3000

[State 0, ]
type = Helper
trigger1 = AnimElem = 3
helpertype = normal
name = "Crap"
ID = 3250
pos = 10,-70
postype = p1
facing = 1
stateno = 3251
ownpal = 1
size.xscale = .5
size.yscale = .5
ignorehitpause = 1

[State 210, 5]
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Crappy Fireball Itself
; CNS difficulty: medium
[Statedef 3251]
type    = S
movetype= A
physics = N
ctrl = 0
velset = 4,0
anim = 3250
sprpriority = -1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = !movehit
flag = timerfreeze

;[State 0, ]
;type = PlaySnd
;trigger1 = movehit = 100
;value = S2,50
;volume = 255

;[State 0, ]
;type = PlaySnd
;trigger1 = movehit = 100
;value = S2,50
;volume = 255

[State 0, ]
type = AngleDraw
trigger1 = 1
ignorehitpause = 1
[State 0, ]
type = AngleAdd
trigger1 = 1
value = 10
ignorehitpause = 1

[State 0, VarAdd]
type = VarSet
trigger1 = time = 0
var(0) = 0
[State 0, VarAdd]
type = VarAdd
trigger1 = moveguarded = 1
trigger1 = var(0) > -630
var(0) = -30
ignorehitpause = 1
[State 0, VarAdd]
type = VarSet
trigger1 = time = 0
var(1) = 100
[State 0, VarAdd]
type = VarAdd
trigger1 = moveguarded = 1
trigger1 = var(1) > 0
var(1) = -5
ignorehitpause = 1
[State 0, VarAdd]
type = VarSet
trigger1 = time = 0
fvar(2) = 4
[State 0, VarAdd]
type = VarAdd
trigger1 = moveguarded = 1
fvar(2) = -0.42
ignorehitpause = 1
[State 0, VelSet]
type = VelSet
trigger1 = moveguarded = 1
x = fvar(2)
ignorehitpause = 1

[State 210, 2]
type = HitDef
triggerall = !movehit
triggerall = fvar(2) >= 0
trigger1 = !moveguarded
trigger2 = timemod = 3,2
attr = S, HP
animtype  = Hard
damage    = 666 + var(0)
guardflag = M
pausetime = 0,30
sparkno = -1
sparkxy = 0,0
hitsound   = S201,0
guardsound = S201,2
ground.type = Trip
ground.slidetime = 12
ground.hittime  = 13
guard.velocity = -30
ground.velocity = -1,-100
air.velocity = -1,-100
fall = 1
fall.recover = 0
numhits = 666
yaccel = 2
envshake.time = 60
envshake.freq = 255
envshake.ampl = -24
p2facing = -1
fall.animtype = hard
getpower = 0,var(1)

[State 210, 2]
type = HitDef
triggerall = !movehit
triggerall = fvar(2) < 0
trigger1 = !moveguarded
trigger2 = timemod = 3,2
attr = S, HP
animtype  = Hard
damage    = 666 + var(0)
guardflag = M
pausetime = 0,30
sparkno = -1
sparkxy = 0,0
hitsound   = S0,21
guardsound = 6,0
ground.type = Trip
ground.slidetime = 12
ground.hittime  = 13
guard.velocity = -30
ground.velocity = -1,-100
air.velocity = -1,-100
fall = 1
fall.recover = 0
numhits = 666
yaccel = 2
envshake.time = 60
envshake.freq = 255
envshake.ampl = -24
p2facing = -1
fall.animtype = hard
getpower = 0,var(1)
affectteam = B

[State 0, ParentVarAdd]
type = ParentVarAdd
trigger1 = movehit = 1
var(25) = -666
ignorehitpause = 1


[State 210, 5]
type = DestroySelf
triggerall = Time >= 200
trigger1 = frontedgedist < -80
trigger1 = vel x > 0
trigger2 = backedgedist < -80
trigger2 = vel x < 0

;---------------------------------------------------------------------------
; BLAM
[Statedef 3252]
type = S
ctrl = 0
anim = 3251
velset = 0,0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 1
movecamera = 1,1

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic

[State 0, SuperPause]
type = SuperPause
trigger1 = time = 0
time = 100
anim = -1
sound = -1
movetime = 100
darken = 0
unhittable = 1
pausebg = 1
ignorehitpause = 1

[State 191, 2] ;Assert this until you want "round 1, fight" to begin
type = AssertSpecial
trigger1 = 1
flag = nomusic

[State 0, ]
type = PlaySnd
trigger1 = AnimElem = 6
value = S2,50
channel = 0
volume = 255

[State BLAM]
type = Helper
trigger1 = animelem = 12
helpertype = normal
name = "BLAM"
ID = 4550
stateno = 4550
pos = 0,0
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
ignorehitpause = 1

[State 191, 3] ;Change to stand state when done
type = ChangeState
trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Shun Goku Satsu
[Statedef 3900]
type    = S
movetype= A
physics = S
velset = 0,0
anim = 3900
ctrl = 0
sprpriority = 2

[State 0, VelAdd]
type = VelAdd
trigger1 = animelem = 4
trigger2 = animelem = 5
trigger3 = animelem = 6
x = 3

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S2,ifelse(random<500,23,24)
volume = 255
channel = 0

[State 3000, Super A]
type = SuperPause
trigger1 = Time = 0
pos = 25, -57
movetime = 15
anim = 100
sound = 20, 0
poweradd = -3000

[State 3050, 2]
type = HitDef
trigger1 = Time = 0
attr = S, HA
animtype  = diagUp
damage    = 666, 0
getpower  = 0
priority  = 7
guardflag =
pausetime = 30,30
sparkno = 3
sparkxy = 0,-69
hitsound   = S0,21
guardsound = 6,0
ground.type = Low
ground.slidetime = 26
ground.hittime  = 26
ground.velocity = -11,-3
guard.velocity = -11
air.velocity = -11,-3
airguard.velocity = -4.5,-5
envshake.time = 40
envshake.ampl = 13
envshake.freq = 255
fall = 1
fall.recover = 0
fall.damage = 50
fall.kill = 0

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nokoslow
ignorehitpause = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 7
value = S6,0
[State 0, PlaySnd]
type = PlaySnd
trigger1 = animelem = 7
value = F5,0
freqmul = 0.9

[State 0, Explod]
type = Explod
trigger1 = animelem = 7
anim = F0
pos = 27,-72
postype = p1  ;p2,front,back,left,right
;supermovetime = 65535
;pausemovetime = 65535
scale = 2,2
sprpriority = 8
ontop = 1
ownpal = 1
ignorehitpause = 1
[State 0, Explod]
type = Explod
trigger1 = movehit
anim = F3
pos = 27,-72
postype = p1  ;p2,front,back,left,right
;supermovetime = 65535
;pausemovetime = 65535
scale = 2,2
sprpriority = 10
ontop = 1
ownpal = 1
ignorehitpause = 1
persistent = 0
[State 0, Explod]
type = Explod
trigger1 = movehit
anim = F100
pos = 27,-72
postype = p1  ;p2,front,back,left,right
;supermovetime = 65535
;pausemovetime = 65535
scale = 3,3
sprpriority = -10
ontop = 1
ownpal = 1
ignorehitpause = 1
persistent = 0
[State 0, Explod]
type = Explod
trigger1 = movehit
anim = F3
pos = 27,-72
postype = p1  ;p2,front,back,left,right
;supermovetime = 65535
;pausemovetime = 65535
scale = 4,4
sprpriority = -12
ontop = 1
ownpal = 1
ignorehitpause = 1
persistent = 0
[State 0, Explod]
type = Explod
trigger1 = movehit
anim = F2
pos = 27,-72
postype = p1  ;p2,front,back,left,right
;supermovetime = 65535
;pausemovetime = 65535
scale = 5,5
sprpriority = 13
ontop = 1
ownpal = 1
ignorehitpause = 1
persistent = 0

[State 0, PlaySnd]
type = PlaySnd
trigger1 = movehit
value = F5,4
freqmul = 0.75
ignorehitpause = 1
persistent = 0
[State 0, PlaySnd]
type = PlaySnd
trigger1 = movehit
value = F5,4
freqmul = 0.5
ignorehitpause = 1
persistent = 0
[State 0, PlaySnd]
type = PlaySnd
trigger1 = movehit
value = F7,2
freqmul = 0.5
ignorehitpause = 1
persistent = 0
[State 0, PlaySnd]
type = PlaySnd
trigger1 = movehit
value = F5,2
freqmul = 0.4
ignorehitpause = 1
persistent = 0


[State 0, Helper]
type = Helper
trigger1 = movehit
trigger1 = win
trigger1 = !numhelper(3930)
helpertype = normal
name = "AWESOME"
ID = 3930
stateno = 3930
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
ignorehitpause = 1

[State 3000, 7]
type = ChangeState
trigger1 = animtime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; BONK
[Statedef 3930]
type    = S
movetype= I
physics = N
velset = 0,0
anim = 9741
ctrl = 0

[State 0, EnvShake]
type = EnvShake
trigger1 = time = 0
time = 120
freq = 255
ampl = -15
[State 0, SuperPause]
type = SuperPause
trigger1 = time = 0
time = 100
anim = -1
sound = -1
movetime = 100
darken = 0
pausebg = 1

[State 0, Explod]
type = Explod
trigger1 = time = 0
anim = 3930
ID = 3930
pos = 160,120
postype = left
bindtime = 1
random = 0,0
removetime = 120
supermovetime = 120
pausemovetime = 120
scale = 1,1
sprpriority = 999
ontop = 1
;ownpal = 0
ignorehitpause = 1
[State PFX R]
type = VarRandom
trigger1 = numexplod(3930)
v = 0
range = 2,300
[State PFX G]
type = VarRandom
trigger1 = numexplod(3930)
v = 1
range = 2,300
[State PFX B]
type = VarRandom
trigger1 = numexplod(3930)
v = 2
range = 2,300
[State PFX C]
type = VarRandom
trigger1 = numexplod(3930)
v = 3
range = 2,250
[State PFX C]
type = VarRandom
trigger1 = numexplod(3930)
v = 4
range = -100,100
[State PFX C]
type = VarRandom
trigger1 = numexplod(3930)
v = 5
range = -100,100
[State 0, VarSet]
type = VarSet
trigger1 = numexplod(3930)
fvar(4) = var(4)
[State 0, VarSet]
type = VarSet
trigger1 = numexplod(3930)
fvar(5) = var(5)
[State 0, AllPalFX]
type = AllPalFX
trigger1 = numexplod(3930)
time = 2
mul = var(0),var(1),var(2)
invertall = ifelse(random<500,0,1)
color = var(3)
[State 0, Explod]
type = ModifyExplod
trigger1 = numexplod(3930)
ID = 3930
pos = 160,120
postype = left
bindtime = 1
random = 30,30
supermovetime = 120
pausemovetime = 120
scale = fvar(4)/100,fvar(5)/100
ignorehitpause = 1


[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,27

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nokoslow
ignorehitpause = 1


;---------------------------------------------------------------------------
; Shun Goku Satsu p1
[Statedef 3901]
type    = S
movetype= A
physics = S
velset = 0,0
anim = 3901
ctrl = 0
sprpriority = 2

[State 810, Grab Sound]
type = PlaySnd
triggerall = Time = 0
trigger1 = enemynear, name = "Wory"
trigger2 = enemynear, name = "Gulie"
trigger3 = enemynear, name = "Thanos"
trigger4 = enemynear, name = "Devo"
trigger5 = enemynear, name = "Avdol"
trigger6 = enemynear, name = "Ryu"
trigger7 = enemynear, name = "Evil Ryu"
trigger8 = enemynear, name = "CvsEvilRyu"
trigger9 = enemynear, name = "Zangief"
trigger10 = enemynear, name = "Hulk"
trigger11 = enemynear, name = "Rugal"
trigger12 = enemynear, name = "CvsRugal"
trigger13 = enemynear, name = "CvsGeese"
trigger14 = enemynear, name = "Kouryu"
trigger15 = enemynear, name = "M. Bison"
trigger16 = enemynear, name = "Tin G_rugal"
trigger17 = enemynear, name = "Sodom with Samurai Sword"
trigger18 = enemynear, name = "Johann"
trigger19 = enemynear, name = "Juggernaut by Splode"
trigger20 = enemynear, name = "Akuma"
trigger21 = enemynear, name = "Gouki"
trigger22 = enemynear, name = "Ogre"
trigger23 = enemynear, name = "Nero"
trigger24 = enemynear, name = "Homero J Simpson"
trigger25 = enemynear, name = "Kung Fu Man"
value = S2, 12
volume = 255
channel = 0

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
trigger1 = random < 500
value = S2,ifelse(random<500,10,11)
channel = 0
volume = 255

[State 0, ]
type = TargetBind
trigger1 = Time = 0
time = 1
pos = 62,-66
ignorehitpause = 1

[State 0, ]
type = VarRandom
trigger1 = 1
v = 0
range = 0,3

[State 0, ]
type = VarRandom
trigger1 = 1
v = 1
range = -20,20

[State 0, ]
type = VarRandom
trigger1 = 1
v = 2
range = -20,20

[State 810, Grab Sound]
type = PlaySnd
trigger1 = Time = 32
trigger2 = Time = 35
trigger3 = Time = 36
trigger4 = Time = 40
trigger5 = Time = 41
trigger6 = Time = 42
trigger7 = Time = 45
trigger8 = Time = 47
trigger9 = Time = 49
trigger10 = Time = 51
trigger11 = Time = 57
trigger12 = Time = 59
trigger13 = Time = 60
trigger14 = Time = 65
value = F5,3

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = Time = 32
trigger2 = Time = 35
trigger3 = Time = 36
trigger4 = Time = 40
trigger5 = Time = 41
trigger6 = Time = 42
trigger7 = Time = 45
trigger8 = Time = 47
trigger9 = Time = 49
trigger10 = Time = 51
trigger11 = Time = 57
trigger12 = Time = 59
trigger13 = Time = 60
value = -40
absolute = 1
kill = 0

[State 810, Hurt 11]
type = TargetLifeAdd
trigger1 = Time = 65
value = -50
absolute = 1

[State 0, ]
type = HitAdd
trigger1 = Time = 32
trigger2 = Time = 35
trigger3 = Time = 36
trigger4 = Time = 40
trigger5 = Time = 41
trigger6 = Time = 42
trigger7 = Time = 45
trigger8 = Time = 47
trigger9 = Time = 49
trigger10 = Time = 51
trigger11 = Time = 57
trigger12 = Time = 59
trigger13 = Time = 60
trigger14 = Time = 65
value = 1

[State 0, ]
type = Explod
trigger1 = Time = 32
trigger2 = Time = 35
trigger3 = Time = 36
trigger4 = Time = 40
trigger5 = Time = 41
trigger6 = Time = 42
trigger7 = Time = 45
trigger8 = Time = 47
trigger9 = Time = 49
trigger10 = Time = 51
trigger11 = Time = 57
trigger12 = Time = 59
trigger13 = Time = 60
trigger14 = Time = 65
anim = F var(0)
pos = var(1),var(2)
postype = p2
facing = 1
vfacing = 1
bindtime = -1
ontop = 1
ownpal = 1
ignorehitpause = 1
persistent = 1

[State 810, Throw 11]
type = PowerSet
trigger1 = 1
value = 0

[State 810, Throw 11]
type = TargetState
trigger1 = Time = 80
value = 3909

[State 0, ]
type = EnvColor
trigger1 = Time = [30,82]
value = 0,0,0
time = 1
ignorehitpause = 1
persistent = 1

[State 810, State End]
type = ChangeState
trigger1 = Time >= 83
value = 195
ctrl = 0

[Statedef 3908]
type    = A
movetype= H
physics = N
velset = 0,0

[State 0, ScreenBound]
type = ScreenBound
trigger1 = 1
value = 0
movecamera = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 3908

[State 0, ]
type = SelfState
trigger1 = Time >= 200
value = 5000

[Statedef 3909]
type    = A
movetype= H
physics = N
velset = 0,0

[State 0, ]
type = PosSet
trigger1 = pos y != 0
y = 0

[State 0, ]
type = SelfState
trigger1 = 1
value = 5110

;---------------------------------------------------------------------------
;Kung Fu Throw - Attempt
; CNS difficulty: medium-advanced
; Description: Throws are not difficult to make, although then can be
;     tedious at times. Throw attempt states have a HitDef of a
;     special format. The key parameters in a throw are p1stateno
;     and p2stateno. If the HitDef successfully connects, then
;     the attacker will change to the state number specified by
;     p1stateno, and the opponent will be change to the state
;     number assigned to p2stateno. The special thing about p2stateno
;     is that the opponent will be temporarily brought into the
;     attacker's state file. In this case, no matter who the
;     opponent is, he will be taken to state 820 of this file (kfm.cns)
;     and remain here until the end of the throw (look at his debug
;     information when he is being thrown; the text changes to yellow
;     to mean that he is in another player's state file).
[Statedef 4000]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 4000
sprpriority = 2

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S0,23
channel = 0

[State 0, ]
type = VarSet
trigger1 = time = 0
v = 31
value = 1

[State 0, ]
type = EnvColor
trigger1 = Time = 0
value = 255,0,0
time = 60
under = 1

[State 0, ]
type = SuperPause
trigger1 = Time = 0
time = 60
anim = -1
darken = 0


; Notes: The '-' symbol in the hitflag field means that it only affects
;   players who are not in a hit state. This prevents KFM from combo-ing
;   into the throw. The priority should be set to a low number, such as
;   1 or 2, so that the throw does not take precedence over normal attacks.
;   The type of priority must always be set to "Miss" or "Dodge" for throws,
;   otherwise strange behavior can result.
[State 800, 1]
type = HitDef
Trigger1 = Time = 0
attr = S, HT          ;Attributes: Standing, Normal Throw
hitflag = M-          ;Affect only ground people who are not being hit
priority = 1, Miss    ;Throw has low priority, must be miss or dodge type.
sparkno = -1          ;No spark
sprpriority = 1       ;Draw in front of p2
p1facing = 1
p2facing = 1          ;Force p2 to face KFM
p1stateno = 4010       ;On success, KFM changes to state 810
p2stateno = 4020       ;If hit, p2 changes to state 820 in KFM's cns
guard.dist = 0        ;This prevents p2 from going into a guard state if close
fall = 1              ;Force p2 into falling down

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Kung Fu Throw - Throwing the opponent
; Description: In this state, KFM throws the opponent by binding him to
;     various offsets based on his current frame of animation. For
;     example, [State 810, Bind 1] binds the opponent to an offset of
;     28 pixels in front of KFM. That puts him around where KFM's hand
;     is at. Is is important to keep the opponent bound using a
;     TargetBind controller at all times, until you let him go. This
;     is especially important if your player has a Clsn2 box that
;     allows him to get hit while throwing someone. Each time a player
;     gets hit, all his bound targets will be set to a fall state. If
;     the opponent is not bound, then he may get stuck in his thrown
;     state when his attacker is knocked out of the throw halfway.
; Notes: There is a TargetLifeAdd controller to decrease the opponent's
;     life, and a TargetState controller to change his state to a
;     falling state when KFM lets go of him.
[Statedef 4010]
type    = S
movetype= A
physics = N
anim = 4010
poweradd = 60

[State 0, ]
type = null;SuperPause
trigger1 = Time = 0
time = 360
anim = -1
movetime = 360
darken = 0

[State 0, ]
type = null;AllPalFX
trigger1 = time = [0,235]
trigger2 = time = [240,360]
time = 1
mul = 0,0,0

[State 0, ]
type = ChangeAnim
trigger1 = time = 150
value = 4011

[State 0, ]
type = ChangeAnim
trigger1 = time = 175
value = 4012

[State 0, ]
type = ChangeAnim
trigger1 = time = 210
value = 4013

[State 0, ]
type = Explod
trigger1 = Time = 235
anim = 9998
pos = 160,120
postype = left
bindtime = -1
ontop = 1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535

[State 0, ]
type = EnvColor
trigger1 = time = [150,155]
trigger2 = time = [175,180]
trigger3 = time = [210,215]
value = 255,255,255
time = 1
under = 1

[State 0, ]
type = EnvColor
trigger1 = time = [235,240]
value = 255,255,255
time = 1
under = 0

[State 0, ]
type = EnvColor
trigger1 = time = [0,150]
trigger2 = time = [155,175]
trigger3 = time = [180,210]
trigger4 = time = [215,235]
trigger5 = time = [240,360]
value = 0,0,0
time = 1
under = 0

[State 0, ]
type = TargetLifeAdd
trigger1 = time = 245
value = -9999
kill = 1
absolute = 1

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S0,24
channel = 0

[State with voice]
type = PlaySnd
trigger1 = Time = 0
value = S0,25

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = nomusic
flag2 = nobardisplay
flag3 = noFG

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = nokoslow

[State 0, ]
type = TargetState
trigger1 = time = 350
value = 4021
ignorehitpause = 1

[State 810, State End]
type = ChangeState
trigger1 = time >= 360
value = 4011
ctrl = 0

;---------------------------------------------------------------------------
; Finished
[Statedef 4011]
type    = S
movetype= A
physics = S
juggle  = 0
velset = 0,0
ctrl = 0
anim = 4019
sprpriority = 2

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = nokosnd
flag2 = nokoslow
flag3 = nomusic
ignorehitpause = 1

[State 0, ]
type = AssertSpecial
trigger1 = 1
flag = nobardisplay
flag2 = timerfreeze
ignorehitpause = 1

[State 0, ]
type = VarSet
trigger1 = Time = 0
v = 0
value = 0

[State 0, ]
type = VarAdd
trigger1 = 1
v = 0
value = 10

[State 0, ]
type = AllPalFX
trigger1 = var(0) < 255
time = 2
mul = var(0),var(0),var(0)

[State 800, 2]
type = ChangeState
Trigger1 = AnimTime = 0
value = 0
ctrl = 1

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw
; (a custom gethit state)
; Description: This is the state that the opponent changes to after being
;     hit by KFM's throw HitDef. The important thing here is to use a
;     ChangeAnim2 controller. The difference between ChangeAnim2 and
;     ChangeAnim is that ChangeAnim2 changes the player's animation to
;     an action in the AIR file of the attacker (in this case, kfm.air),
;     whereas ChangeAnim always changes the player to an action in his
;     own AIR file. Look at Action 820 in kfm.air for some extra
;     comments.
[Statedef 4020]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim2
Trigger1 = Time = 0
value = 225

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = time>666;!gethitvar(isbound);
value = 5050

;---------------------------------------------------------------------------
;Thrown by Kung Fu Throw
; (a custom gethit state)
; Description: This is the state that the opponent changes to after being
;     hit by KFM's throw HitDef. The important thing here is to use a
;     ChangeAnim2 controller. The difference between ChangeAnim2 and
;     ChangeAnim is that ChangeAnim2 changes the player's animation to
;     an action in the AIR file of the attacker (in this case, kfm.air),
;     whereas ChangeAnim always changes the player to an action in his
;     own AIR file. Look at Action 820 in kfm.air for some extra
;     comments.
[Statedef 4021]
type    = A
movetype= H
physics = N
velset = 0,0

[State 820, 1]
type = ChangeAnim
Trigger1 = Time = 0
value = ifelse(selfanimexist(5140),5140,5110)

[State 0, ]
type = LifeSet
trigger1 = 1
value = 0
ignorehitpause = 1

;In case attacker loses binding on player for any reason, this controller
;guarantees that the player will never get stuck in this thrown state.
[State 820, 2]
type = SelfState
trigger1 = time >= 2
value = 5150


; (Credit to ANMC, Bagaliao, and FlowaGirl for the basic helper method concept.)
;
;------------------
; AI Activation Helper State - Primary Version
; (Credit to YongMing for the basic HitPause bugfix concept.)
;
; var(1) - First tick button activation prevention.
; var(2) - Used for pause/superpause and custom state check, basically.
; var(3) - (Super/)Pause & custom state-triggered dir detection disabler.
; var(4) - Persistent direction command detection enabler (due to 2002.04.14).
; var(9) - AutoTurn bug fixer.
; parent's var(58) - Parent's GameTime var, for pause and custom state check.
; parent's var(59) - Parent's primary AI variable.
;
; The code in this state is mostly simply copy/pasteable.
; But if you're using different indices for the parent's variables,
; or if you change your character's basic commands' names, you'll
; of course need to change the code in this state accordingly.

[StateDef 9741]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9741, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 0

[State 9741, PauseCheck]
type = VarSet
trigger1 = (GameTime>(Parent,var(58)))
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)
trigger4 = Parent,var(59)
trigger5 = (var(3):=0)
var(2) = (var(3):=1)+(var(4):=0)

[State 9741, Facing]
type = Turn
trigger1 = (var(9):=(Facing != Parent,Facing))

[State 9741, DirTurnOnAI]
type = ParentVarSet
triggerall = !var(3)
triggerall = !var(9)
trigger1 = (Parent,command = "holdfwd")
trigger2 = (Parent,command = "holdback")
trigger3 = (Parent,command = "holdup")
trigger4 = (Parent,command = "holddown")
trigger5 = !(var(4):=1)
var(59) = var(4)

[State 9741, DirTurnOffAI]
type = ParentVarSet
triggerall = !var(3)
triggerall = Parent,var(59)
trigger1 = (command = "holdfwd")
trigger1 = (Parent,command = "holdfwd")
trigger2 = (command = "holdback")
trigger2 = (Parent,command = "holdback")
trigger3 = (command = "holdup")
trigger3 = (Parent,command = "holdup")
trigger4 = (command = "holddown")
trigger4 = (Parent,command = "holddown")
var(59) = (var(4):=0)

[State 9741, ButtonTurnOnAI]
type = ParentVarSet
triggerall = var(1)
triggerall = !var(2)
trigger1 = (Parent,command = "a")
trigger2 = (Parent,command = "b")
trigger3 = (Parent,command = "c")
trigger4 = (Parent,command = "x")
trigger5 = (Parent,command = "y")
trigger6 = (Parent,command = "z")
trigger7 = (Parent,command = "start")
var(59) = 1

[State 9741, ButtonTurnOffAI]
type = ParentVarSet
triggerall = !var(2)
trigger1 = (command = "a")
trigger1 = (Parent,command = "a")
trigger2 = (command = "b")
trigger2 = (Parent,command = "b")
trigger3 = (command = "c")
trigger3 = (Parent,command = "c")
trigger4 = (command = "x")
trigger4 = (Parent,command = "x")
trigger5 = (command = "y")
trigger5 = (Parent,command = "y")
trigger6 = (command = "z")
trigger6 = (Parent,command = "z")
trigger7 = (command = "start")
trigger7 = (Parent,command = "start")
var(59) = -1

[State 9741, UnPauseCheck]
type = VarSet
triggerall = var(2)
trigger1 = (Parent,command = "a")
trigger2 = (Parent,command = "b")
trigger3 = (Parent,command = "c")
trigger4 = (Parent,command = "x")
trigger5 = (Parent,command = "y")
trigger6 = (Parent,command = "z")
trigger7 = (Parent,command = "start")
trigger8 = (var(2) = 2)
trigger8 = (var(2):=0)
var(2) = 2

[State 9741, Goodbye]
type = DestroySelf
triggerall = (var(1):=1)
trigger1 = Parent,var(59)
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)

[State 9741, DTC]
type = DisplayToClipboard
trigger1 = 1
text = "var(2) = %d, parentvar(58) = %d, GameTime = %d, var(3) = %d"
params = var(2), (parent,var(58)), GameTime, var(3)

;------------------
; AI Activation Helper State - Compatibly Partnered Version
;
; var(1) - First tick dir activation prevention
; var(2) - Used for pause/superpause and custom state check, basically.
; var(3) - (Super/)Pause & custom state-triggered dir detection disabler.
; var(4) - Hitpause check.
; var(5) - No button on previous tick.
; var(6) - Any dir on this tick.
; var(7) - Any button on this tick.
; var(8) - Matching partner button detected.
; var(9) - AutoTurn bug fixer.
; parent's var(58) - Parent's GameTime var, for pause and custom state check.
; parent's var(59) - Parent's primary AI variable.
;
; The code in this state is mostly simply copy/pasteable.
; But if you're using different indices for the parent's variables,
; or if you change your character's basic commands' names, you'll
; of course need to change the code in this state accordingly.

[StateDef 9742]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 9742, Safety]; Just in case your opponent is very poorly coded.
type = SelfState
trigger1 = !IsHelper
value = 0

[State 9742, PauseCheck]
type = VarSet
trigger1 = (GameTime>Parent,var(58))
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)
trigger4 = Parent,var(59)
trigger5 = (var(3):=0)
var(2) = (var(3):=1)

[State 9742, Facing]
type = Turn
trigger1 = (var(9):=(Facing != Parent,Facing))

[State 9742, ParentDirCheck]
type = VarSet
trigger1 = (Parent,command = "holdfwd")
trigger2 = (Parent,command = "holdback")
trigger3 = (Parent,command = "holdup")
trigger4 = (Parent,command = "holddown")
trigger5 = (var(6):=0)
var(6) = 1

[State 9742, ParentButtonCheck]
type = VarSet
trigger1 = (Parent,command = "a")
trigger2 = (Parent,command = "b")
trigger3 = (Parent,command = "c")
trigger4 = (Parent,command = "x")
trigger5 = (Parent,command = "y")
trigger6 = (Parent,command = "z")
trigger7 = (Parent,command = "start")
trigger8 = (var(7):=0)
var(7) = 1

[State 9742, SameButtonCheck]
type = VarSet
triggerall = var(7)
triggerall = !var(2)
trigger1 = (Parent,command = "a")
trigger1 = (Partner,command = "a")
trigger2 = (Parent,command = "b")
trigger2 = (Partner,command = "b")
trigger3 = (Parent,command = "c")
trigger3 = (Partner,command = "c")
trigger4 = (Parent,command = "x")
trigger4 = (Partner,command = "x")
trigger5 = (Parent,command = "y")
trigger5 = (Partner,command = "y")
trigger6 = (Parent,command = "z")
trigger6 = (Partner,command = "z")
trigger7 = (Parent,command = "start")
trigger7 = (Partner,command = "start")
trigger8 = (var(8):=0)
var(8) = 1;Partner,AnimExist(9741)

[State 9742, DirTurnOnAI]
type = ParentVarSet
trigger1 = var(1)
trigger1 = var(6)
trigger1 = !var(3)
trigger1 = !var(4)
trigger1 = !var(9)
var(59) = 1

[State 9742, DirTurnOffAI]
type = ParentVarSet
triggerall = var(6)
triggerall = !var(3)
triggerall = Parent,var(59)
trigger1 = (command = "holdfwd")
trigger1 = (Parent,command = "holdfwd")
trigger2 = (command = "holdback")
trigger2 = (Parent,command = "holdback")
trigger3 = (command = "holdup")
trigger3 = (Parent,command = "holdup")
trigger4 = (command = "holddown")
trigger4 = (Parent,command = "holddown")
var(59) = 0

[State 9742, ButtonTurnOnAI]
type = ParentVarSet
trigger1 = var(5)
trigger1 = var(7)
trigger1 = !var(2)
trigger1 = !var(8)
var(59) = 1

[State 9742, ButtonTurnOffAI]
type = ParentVarSet
triggerall = var(7)
triggerall = !var(2)
triggerall = !var(8)
trigger1 = (command = "a")
trigger1 = (Parent,command = "a")
trigger2 = (command = "b")
trigger2 = (Parent,command = "b")
trigger3 = (command = "c")
trigger3 = (Parent,command = "c")
trigger4 = (command = "x")
trigger4 = (Parent,command = "x")
trigger5 = (command = "y")
trigger5 = (Parent,command = "y")
trigger6 = (command = "z")
trigger6 = (Parent,command = "z")
trigger7 = (command = "start")
trigger7 = (Parent,command = "start")
var(59) = -1

[State 9742, UnPauseCheck]
type = VarSet
triggerall = var(2)
triggerall = !var(4)
trigger1 = var(7)
trigger2 = (var(2) = 2)
trigger2 = (var(2):=0)
var(2) = 2

[State 9742, Goodbye]
type = DestroySelf
trigger1 = Parent,var(59)
trigger2 = !(Parent,Alive)
trigger3 = (RoundState != 2)

[State 9742, HitPauseCheck]
type = VarSet
trigger1 = var(6)
trigger2 = var(7)
trigger3 = !(Parent,HitPauseTime)
var(4) = Parent,HitPauseTime

[State 9742, Delay]
type = VarSet
trigger1 = (var(1):=1)
var(5) = !var(7)

[State 9742, DTC]
type = DisplayToClipboard
trigger1 = 1
text = "var(2) = %d, parentvar(58) = %d, GameTime = %d, var(3) = %d"
params = var(2), (parent,var(58)), GameTime, var(3)

;---------------------------------------------------------------------------
; Override common states (use same number to override) :
;---------------------------------------------------------------------------


; WinKo effect
[StateDef 666]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 0, ]
type = EnvShake
trigger1 = Time = 0
trigger1 = parent,stateno != 3900
time = 40
freq = 255
ampl = -30
ignorehitpause = 1

[State 0, ]
type = PlaySnd
trigger1 = Time = 0
value = S0,21
abspan = 0

[State 0, ]
type = PlaySnd
trigger1 = parent,life = lifemax
trigger1 = Time = 6
value = S0,28
abspan = 0
volume = 255

;[State 0, ]
;type = PlaySnd
;trigger1 = parent,stateno != 3900
;trigger1 = Time = 40
;value = S2,11
;volume = 255

;[State 0, ]
;type = PlaySnd
;trigger1 = parent,stateno != 3900
;trigger1 = Time = 40
;value = S2,11
;volume = 255

[State BLAM]
type = Helper
trigger1 = time = 40
trigger1 = parent,life = 0
trigger1 = p2life = 0
helpertype = normal
name = "BLAM"
ID = 4550
stateno = 4550
pos = 0,0
postype = p1
ownpal = 1
supermovetime = 65535
pausemovetime = 65535
ignorehitpause = 1

; Combo announcer count
[StateDef 69]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

;[State 0, VarSet]
;type = VarSet
;trigger1 = time = 0
;var(0) = 0
;ignorehitpause = 1
;[State 0, VarSet]
;type = VarAdd
;trigger1 = parent,uniqhitcount = 0
;trigger2 = p2movetype != H
;var(0) = var(1)
;ignorehitpause = 1
;[State 0, VarSet]
;type = VarSet
;trigger1 = 1
;var(1) = parent,uniqhitcount
;ignorehitpause = 1
;[State 0, VarSet]
;type = VarSet
;trigger1 = parent,uniqhitcount = 0
;var(1) = 0
;ignorehitpause = 1

[State 0, VarSet]
type = VarSet
trigger1 = 1
var(1) = parent,var(26)
ignorehitpause = 1
[State 0, VarSet]
type = VarSet
trigger1 = enemynear,gethitvar(hitcount)
var(0) = (enemynear,gethitvar(hitcount)) - var(1)
ignorehitpause = 1

[State 0, DisplayToClipboard]
type = DisplayToClipboard
trigger1 = 1
text = "var(0) = %d"
params = var(0)
ignorehitpause = 1

[State 0, ChangeState]
type = ChangeState
trigger1 = time > 1
trigger1 = p2movetype != H
trigger2 = roundstate = 4
value = 68
ignorehitpause = 1

; Combo announcer
[StateDef 68]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State COULD BE HIGHER]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = 5
value = S30,0
channel = 0
ignorehitpause = 1
[State THAT SHOULD WORK]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = 6
value = S30,1
channel = 0
ignorehitpause = 1
[State NICE]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [7,8]
value = S30,2
channel = 0
ignorehitpause = 1
[State FASCINATING]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [9,10]
value = S30,3
channel = 0
ignorehitpause = 1
[State IMPRESSIVE]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [11,12]
value = S30,4
channel = 0
ignorehitpause = 1
[State FANTASTIC]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [13,15]
value = S30,5
channel = 0
ignorehitpause = 1
[State WHAT A TOUGH]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [16,18]
value = S30,6
channel = 0
ignorehitpause = 1
[State STONE COLD CRAZY]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [19,21]
value = S30,7
channel = 0
ignorehitpause = 1
[State even Spoony is confused]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [22,29]
value = S30,8
channel = 0
ignorehitpause = 1
[State HOLY FUCKING SHIT]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) = [30,99]
value = S30,9
channel = 0
ignorehitpause = 1
[State a Snarky comment coutresy of Moltar]
type = PlaySnd
trigger1 = time = 0
trigger1 = var(0) >= 100
value = S30,10
channel = 0
ignorehitpause = 1

;[State 0, ChangeState]
;type = ChangeState
;triggerall = time >= 30
;trigger1 = enemynear,gethitvar(hitcount) >= 5
;trigger1 = p2movetype = H
;value = 69
;ctrl = 0
;ignorehitpause = 1

[State 0, DestroySelf]
type = DestroySelf
trigger1 = roundstate < 4
trigger1 = time >= 5
;triggerall = time >= 30
;trigger1 = enemynear,gethitvar(hitcount) < 5
;trigger2 = p2movetype != H
ignorehitpause = 1

;---------------------------------------------------------------------------
; BLAM
[StateDef 4550]
type = S
movetype = I
physics = N
anim = 9741
ctrl = 0

[State 0, VarSet]
type = VarSet
trigger1 = time = 0
var(9) = (roundstate<2)

[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = 1
flag = nomusic
[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = var(9)
flag = nobardisplay
[State 0, AssertSpecial]
type = AssertSpecial
trigger1 = var(9)
trigger1 = time < 100
flag = intro

[State 0, PlaySnd]
type = PlaySnd
trigger1 = time = 0
value = S0,33
volume = 255

[State LeftKingGator]
type = Explod
trigger1 = time = 0
anim = 4550
ID = 4550
pos = 55,202
postype = left
facing = 1
bindtime = -1
removetime = -1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(1),fvar(1)
sprpriority = 900
ontop = 1
ownpal = 1
[State RightKingGator]
type = Explod
trigger1 = time = 0
anim = 4550
ID = 4550
pos = 265,202
postype = left
facing = -1
bindtime = -1
removetime = -1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(1),fvar(1)
sprpriority = 900
ontop = 1
ownpal = 1
[State TXT]
type = Explod
trigger1 = time = 0
anim = 4551
ID = 4551
pos = 160,215
postype = left
facing = 1
bindtime = -1
removetime = -1
supermovetime = 65535
pausemovetime = 65535
scale = fvar(0),fvar(0)
sprpriority = 950
ontop = 1
ownpal = 1

[State 0, VarAdd]
type = VarAdd
trigger1 = time < 180
trigger1 = fvar(0) < 0.5
fvar(0) = 0.016
[State 0, VarAdd]
type = VarAdd
trigger1 = time < 180
trigger1 = fvar(1) < 0.5
fvar(1) = 0.019
[State 0, VarSet]
type = VarSet
trigger1 = fvar(0) > 0.5
fvar(0) = 0.5
[State 0, VarSet]
type = VarSet
trigger1 = fvar(1) > 0.5
fvar(1) = 0.5
[State 0, VarAdd]
type = VarAdd
trigger1 = time >= 180
fvar(0) = -0.05
[State 0, VarAdd]
type = VarAdd
trigger1 = time >= 180
fvar(1) = -0.08

[State TXT]
type = ModifyExplod
trigger1 = numexplod(4551)
ID = 4551
scale = fvar(0),fvar(0)
[State LeftKingGator]
type = ModifyExplod
trigger1 = numexplod(4550)
ID = 4550
scale = fvar(1),fvar(1)
[State RightKingGator]
type = ModifyExplod
trigger1 = numexplod(4550)
ID = 4550
scale = fvar(1),fvar(1)

[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = time >= 180
trigger1 = numexplod(4551)
trigger1 = fvar(0) <= 0
id = 4551
[State 0, RemoveExplod]
type = RemoveExplod
trigger1 = time >= 180
trigger1 = numexplod(4550)
trigger1 = fvar(1) <= 0
id = 4550

[State 0, DestroySelf]
type = DestroySelf
trigger1 = time >= 180
trigger1 = !numexplod(4550)
trigger1 = !numexplod(4551)


;---------------------------------------------------------------------------
; Dizzy State
[Statedef 5300]
type    = S
movetype= H
physics = N
velset = 0,0
ctrl = 0

[State 0, ]
type = VarSet
trigger1 = time = 0
var(0) = 0

[State 0, ]
type = VarSet
trigger1 = 1
var(3) = ifelse(random<500,0,1)

[State 0, ]
type = VarSet
trigger1 = 1
var(20) = -250

[State 0, ]
type = ChangeAnim
trigger1 = Time = 0
value = 5300

[State 0, ]
type = SelfState
trigger1 = Time >= 200
value = 5100

[State 0, PalFXWiz] ;Generated by MEE PalFX Editor
type = PalFX
triggerall = var(3) = 1
trigger1 = command = "anybutton" || command = "anydir"
time = 10
add = 0,0,0
mul = 256,256,256
sinadd = 96,96,96,4
[State 0, VarAdd]
type = VarAdd
triggerall = var(3) = 1
trigger1 = command = "anybutton" || command = "anydir"
var(0) = 1

[State 0, ]
type = ChangeState
trigger1 = var(0) > 3
value = 0
ctrl = 1

;---------------------------------------------------------------------------
; Jump Start
[Statedef 40]
type    = S
physics = S
anim = 40
ctrl = 0
sprpriority = 1

[State 40, 1]
type = VarSet
trigger1 = Time = 0
sysvar(1) = 0
[State 40, 1]
type = VarSet
trigger1 = Time = 0
sysvar(2) = 0

[State 40, 2]
type = VarSet
trigger1 = command = "holdfwd"
sysvar(1) = 1

[State 40, 3]
type = VarSet
trigger1 = command = "holdback"
sysvar(1) = -1
[State 40, 1]
type = VarSet
trigger1 = command = "SupahJump"
sysvar(2) = 1

[State 0, PlaySnd]
type = PlaySnd
trigger1 = sysvar(2)
trigger1 = animtime = 0
value = S0,15
[State 0, AfterImage]
type = AfterImage
trigger1 = sysvar(2)
trigger1 = animtime = 0
time = 42
length = 15
palcolor = 40
paladd = 10,10,10
palmul = .74,.74,.74
timegap = 1
framegap = 4
trans = add

[State 40, 4]
type = VelSet
trigger1 = AnimTime = 0
x = ifelse(sysvar(1)=0, const(velocity.jump.neu.x), ifelse(sysvar(1)=1, const(velocity.jump.fwd.x), const(velocity.jump.back.x))) * ifelse(sysvar(2),2.5,1)
y = const(velocity.jump.y) * ifelse(sysvar(2),1.1,1)

[State 40, 5]
type = VelSet
trigger1 = AnimTime = 0
trigger1 = prevstateno = 100 ;RUN_FWD
trigger1 = sysvar(1) = 1
x = const(velocity.runjump.fwd.x)

[State 40, 6]
type = ChangeState
trigger1 = AnimTime = 0
value = 50
ctrl = 1


